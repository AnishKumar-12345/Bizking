import{_ as k,o as c,c as u,g as a,b5 as M,b6 as I,w as l,i as p,j as T,k as w,l as b,s as x,a as o,F as g,q as f,t as m,m as S,b as _,v as y,e as C,r as U,f as N,u as P}from"./index.986c8b57.js";import{s as F}from"./Services.7881b1f6.js";import{V as A}from"./VForm.45c60dc8.js";import{V as B}from"./VAutocomplete.fe04c61c.js";import{V}from"./VTextField.78fcf9d0.js";import{V as L}from"./VTable.4ed8be04.js";import{V as z}from"./VCheckbox.024b2e29.js";import{V as D}from"./VPagination.51a41da9.js";import{V as Q}from"./VSnackbar.34661357.js";import{V as R,a as E,b as O,c as W}from"./VWindowItem.11d828b3.js";import"./index.2bd8ddc8.js";import"./VSelect.1c2f57cf.js";import"./VCheckboxBtn.11a37a8c.js";import"./VChip.10586e46.js";const q={mixins:[F],components:{},data(){return{selectedItems:[],postMerchant:{merchant_id:"",products:[{brand_product_id:"",margin:"",created_date:"",updated_date:"",status:"",selling_price:"",brand_id:""}]},marginrules:[t=>!!t||"Margin is required"],selectedMerchantId:"",selectAll:!1,loading:!0,searchQuery:"",page:1,pageSize:10,snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,marchantstocksdata:[],selectedmerchants:null,merchantName:[],stockUpdatedate:null,merchantBrand:[],headers:[{text:"Brand Name",value:"brand_name"},{text:"SKU",value:"sku_name"},{text:"UOM",value:"uom"},{text:"MRP",value:"mrp"},{text:"Margin",value:"margin"}]}},computed:{filteredMerchant(){const t=this.searchQuery.toLowerCase().trim();return this.marchantstocksdata.filter(e=>e.brand_name&&e.brand_name.toLowerCase().includes(t)||e.sku_name&&e.sku_name.toLowerCase().includes(t)||e.uom&&e.uom.toLowerCase().includes(t)||e.mrp&&e.mrp.toLowerCase().includes(t)||e.margin&&e.margin.toLowerCase().includes(t))},paginatedItems(){const t=(this.page-1)*this.pageSize,e=t+this.pageSize;return this.filteredMerchant.slice(t,e)},merchants(){return this.merchantName.map(t=>t.merchant_uid)},allFilteredItems(){return this.filteredMerchant}},mounted(){this.getMerchantdetails(),setTimeout(()=>{this.loading=!1},4e3)},methods:{computedmarginRules(){const t=e=>/^(0|([1-9]\d*))(?:\.\d+)?%$/.test(String(e));return[e=>!!e||"Margin is required",e=>e.startsWith("0%")?e==="0%"||"Give numerical value with percentage ":t(e)||"Give numerical value with percentage "]},updatemargin(t){t==="0%"||t==="0"?this.Addbrand.total_given_margin="0%":t.startsWith("0%")?t="0%":t=t},validateForm(){this.$refs.purchaseOrderForm.validate().then(t=>{t.valid==!0?this.saveMerchants():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="on-background")})},saveMerchants(){const t=this.filteredMerchant.filter(n=>n.selected).map(n=>({brand_product_id:n.brand_product_id,margin:`${n.margin}`,created_date:"",updated_date:"",status:"",selling_price:"",brand_id:n.brand_id})),e={merchant_id:this.selectedMerchantId,products:t};console.log("check brand da",e),this.postmerchantbrandproducts(e).then(n=>{console.log("Saved items:",n),n.data.status==1?(this.snackbarText=n.data.message,this.color="primary",this.snackbar=!0,setTimeout(()=>{window.location.reload(!0)},1300)):(this.snackbarText=n.data.message,this.color="on-background",this.snackbar=!0)}).catch(n=>{console.error("Error saving items:",n),this.snackbarText="Error saving items.",this.color="error",this.snackbar=!0})},toggleItemSelection(t){const e=this.selectedItems.indexOf(t.brand_product_id);e===-1?this.selectedItems.push(t.brand_product_id):this.selectedItems.splice(e,1)},handleMerchantSelection(){console.log("Selected Merchant:",this.selectedmerchants);const t=this.merchantName.find(e=>e.merchant_uid===this.selectedmerchants);console.log("Selected Brand Details:",t),t&&(this.selectedMerchantId=t.merchant_id,console.log("Selected Merchant ID:",this.selectedMerchantId),this.getmerchantbrandproducts(this.selectedMerchantId).then(e=>{console.log("Merchant Products:",e),e.data.status==1?(this.snackbarText=e.data.message,this.color="success",this.marchantstocksdata=e.data.data.map(n=>({...n,selected:n.checked==="checked"})),console.log("Merchant Products:",this.marchantstocksdata)):(this.marchantstocksdata=[],this.snackbar=!0,this.snackbarText=e.data.message,this.color="on-background")}).catch(e=>{console.error("Error fetching merchant products:",e)}))},getMerchantdetails(){this.getMerchants().then(t=>{this.merchantName=t.data.data,console.log("mer",this.merchantName)})}}},G={key:0,class:"loading-container"},j={style:{"max-width":"400px"}},K=o("th",{class:"text-center"},null,-1),H={class:"text-center"},J={class:"text-center"},X={class:"text-center"},Y={class:"text-center"},Z={class:"text-center"},$={class:"text-center"};function ee(t,e,n,v,r,i){return c(),u("div",null,[r.loading?(c(),u("div",G,[a(M,{height:"5",color:"primary",indeterminate:"",class:"custom-loader","full-width":""})])):I("",!0),a(b,null,{default:l(()=>[a(p,{cols:"12"},{default:l(()=>[a(T,{title:"Merchant vs Products Mapping",class:"mb-4"},{default:l(()=>[a(w,null,{default:l(()=>[a(A,{class:"mt-6",ref:"purchaseOrderForm"},{default:l(()=>[a(b,null,{default:l(()=>[a(p,{md:"6",cols:"12"},{default:l(()=>[a(B,{modelValue:r.selectedmerchants,"onUpdate:modelValue":[e[0]||(e[0]=s=>r.selectedmerchants=s),i.handleMerchantSelection],label:"Store or Merchant",items:i.merchants},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),a(x),a(p,{cols:"12"},{default:l(()=>[o("div",j,[a(V,{class:"mb-3",modelValue:r.searchQuery,"onUpdate:modelValue":e[1]||(e[1]=s=>r.searchQuery=s),density:"compact",variant:"solo",label:"Search","append-inner-icon":"mdi-magnify","single-line":"","hide-details":""},null,8,["modelValue"])]),a(L,{headers:r.headers,items:this.paginatedItems},{default:l(()=>[o("thead",null,[o("tr",null,[K,(c(!0),u(g,null,f(r.headers,s=>(c(),u("th",{class:"text-center",key:s},m(s.text),1))),128))])]),o("tbody",null,[(c(!0),u(g,null,f(this.paginatedItems,(s,d)=>(c(),u("tr",{key:d},[o("td",H,[a(z,{modelValue:s.selected,"onUpdate:modelValue":h=>s.selected=h,onChange:h=>i.toggleItemSelection(s)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),o("td",J,m(s.brand_name),1),o("td",X,m(s.sku_name),1),o("td",Y,m(s.uom),1),o("td",Z," \u20B9"+m(s.mrp),1),o("td",$,[a(V,{modelValue:s.margin,"onUpdate:modelValue":h=>s.margin=h,style:{"min-width":"80px"},rules:i.computedmarginRules(),onInput:e[2]||(e[2]=h=>i.updatemargin())},null,8,["modelValue","onUpdate:modelValue","rules"])])]))),128))])]),_:1},8,["headers","items"]),a(D,{modelValue:r.page,"onUpdate:modelValue":e[3]||(e[3]=s=>r.page=s),length:Math.ceil(i.filteredMerchant.length/r.pageSize),onInput:t.updatePagination},null,8,["modelValue","length","onInput"])]),_:1}),a(p,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:l(()=>[a(S,{onClick:e[4]||(e[4]=s=>i.validateForm())},{default:l(()=>[_("Save")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),a(Q,{modelValue:r.snackbar,"onUpdate:modelValue":e[5]||(e[5]=s=>r.snackbar=s),timeout:3500,color:r.color},{default:l(()=>[_(m(r.snackbarText),1)]),_:1},8,["modelValue","color"])])}const te=k(q,[["render",ee]]),ae={components:{Addmerchant:te},data(){return{currentroute:"",activeTab:"",tabs:[{title:"Add Merchant Products",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=y(),this.activeTab=C(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function se(t,e,n,v,r,i){const s=U("Addmerchant");return c(),u("div",null,[a(R,{modelValue:r.activeTab,"onUpdate:modelValue":e[0]||(e[0]=d=>r.activeTab=d),"show-arrows":""},{default:l(()=>[(c(!0),u(g,null,f(r.tabs,d=>(c(),N(W,{key:d.icon,value:d.tab},{default:l(()=>[a(P,{size:"20",start:"",icon:d.icon},null,8,["icon"]),_(" "+m(d.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),a(x),a(O,{modelValue:r.activeTab,"onUpdate:modelValue":e[1]||(e[1]=d=>r.activeTab=d),class:"mt-5 disable-tab-transition",touch:!1},{default:l(()=>[a(E,{value:"account"},{default:l(()=>[a(s)]),_:1})]),_:1},8,["modelValue"])])}const be=k(ae,[["render",se]]);export{be as default};
