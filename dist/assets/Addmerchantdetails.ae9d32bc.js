import{_ as k,o as d,c as i,g as a,b5 as M,b6 as T,w as l,i as p,j as w,k as y,l as _,s as x,a as o,F as g,q as f,t as m,m as I,b,v as S,e as C,r as U,f as N,u as P}from"./index.b9236813.js";import{s as F}from"./Services.b8c43c9d.js";import{V as A}from"./VForm.357f0661.js";import{V as B}from"./VAutocomplete.0e725e49.js";import{V}from"./VTextField.8ecb6399.js";import{V as L}from"./VTable.8079df80.js";import{V as z}from"./VCheckbox.03c9d018.js";import{V as D}from"./VPagination.34e7e61b.js";import{V as Q}from"./VSnackbar.6129cf47.js";import{V as R,a as E,b as W,c as q}from"./VWindowItem.2277bb31.js";import"./index.2bd8ddc8.js";import"./VSelect.41d697ac.js";import"./VCheckboxBtn.70d98d74.js";import"./VChip.c7cc526f.js";const O={mixins:[F],components:{},data(){return{selectedItems:[],postMerchant:{merchant_id:"",products:[{brand_product_id:"",margin:"",created_date:"",updated_date:"",status:"",selling_price:"",brand_id:""}]},marginrules:[t=>!!t||"Margin is required"],selectedMerchantId:"",selectAll:!1,loading:!0,searchQuery:"",page:1,pageSize:10,snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,marchantstocksdata:[],selectedmerchants:null,merchantName:[],stockUpdatedate:null,merchantBrand:[],headers:[{text:"Brand Name",value:"brand_name"},{text:"SKU",value:"sku_name"},{text:"UOM",value:"uom"},{text:"MRP",value:"mrp"},{text:"Margin",value:"margin"}]}},computed:{filteredMerchant(){const t=this.searchQuery.toLowerCase().trim();return this.marchantstocksdata.filter(e=>e.brand_name&&e.brand_name.toLowerCase().includes(t)||e.sku_name&&e.sku_name.toLowerCase().includes(t)||e.uom&&e.uom.toLowerCase().includes(t)||e.mrp&&e.mrp.toLowerCase().includes(t)||e.margin&&e.margin.toLowerCase().includes(t))},paginatedItems(){const t=(this.page-1)*this.pageSize,e=t+this.pageSize;return this.filteredMerchant.slice(t,e)},merchants(){return this.merchantName.map(t=>t.merchant_uid)},allFilteredItems(){return this.filteredMerchant}},mounted(){this.getMerchantdetails(),setTimeout(()=>{this.loading=!1},6e3)},methods:{computedmarginRules(){const t=e=>/^(0|([1-9]\d*))(?:\.\d+)?%$/.test(String(e));return[e=>!!e||"Margin is required",e=>e.startsWith("0%")?e==="0%"||"Give numerical value with percentage ":t(e)||"Give numerical value with percentage "]},updatemargin(t){t==="0%"||t==="0"?this.Addbrand.total_given_margin="0%":t.startsWith("0%")?t="0%":t=t},validateForm(){this.$refs.purchaseOrderForm.validate().then(t=>{t.valid==!0?this.saveMerchants():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="on-background")})},saveMerchants(){const t=this.marchantstocksdata.filter(n=>n.selected).map(n=>({brand_product_id:n.brand_product_id,margin:`${n.margin}`,created_date:"",updated_date:"",status:"",selling_price:"",brand_id:n.brand_id})),e={merchant_id:this.selectedMerchantId,products:t};console.log("check brand da",e),this.postmerchantbrandproducts(e).then(n=>{console.log("Saved items:",n),n.data.status==1?(this.snackbarText=n.data.message,this.color="primary",this.snackbar=!0,setTimeout(()=>{window.location.reload(!0)},1300)):(this.snackbarText=n.data.message,this.color="on-background",this.snackbar=!0)}).catch(n=>{console.error("Error saving items:",n),this.snackbarText="Error saving items.",this.color="error",this.snackbar=!0})},handleMerchantSelection(){console.log("Selected Merchant:",this.selectedmerchants);const t=this.merchantName.find(e=>e.merchant_uid===this.selectedmerchants);console.log("Selected Brand Details:",t),t&&(this.selectedMerchantId=t.merchant_id,console.log("Selected Merchant ID:",this.selectedMerchantId),this.getmerchantbrandproducts(this.selectedMerchantId).then(e=>{console.log("Merchant Products:",e),e.data.status==1?(this.snackbarText=e.data.message,this.color="success",this.marchantstocksdata=e.data.data.map(n=>({...n,selected:n.checked==="checked"})),console.log("Merchant Products:",this.marchantstocksdata)):(this.marchantstocksdata=[],this.snackbar=!0,this.snackbarText=e.data.message,this.color="on-background")}).catch(e=>{console.error("Error fetching merchant products:",e)}))},getMerchantdetails(){this.getMerchants().then(t=>{this.merchantName=t.data.data,console.log("mer",this.merchantName)})}}},G={key:0,class:"loading-container"},j={style:{"max-width":"400px"}},H=o("th",{class:"text-center"},null,-1),K={class:"text-center"},J={class:"text-center"},X={class:"text-center"},Y={class:"text-center"},Z={class:"text-center"},$={class:"text-center"};function ee(t,e,n,v,r,u){return d(),i("div",null,[r.loading?(d(),i("div",G,[a(M,{height:"5",color:"primary",indeterminate:"",class:"custom-loader","full-width":""})])):T("",!0),a(_,null,{default:l(()=>[a(p,{cols:"12"},{default:l(()=>[a(w,{title:"Merchant vs Products Mapping",class:"mb-4"},{default:l(()=>[a(y,null,{default:l(()=>[a(A,{class:"mt-6",ref:"purchaseOrderForm"},{default:l(()=>[a(_,null,{default:l(()=>[a(p,{md:"6",cols:"12"},{default:l(()=>[a(B,{modelValue:r.selectedmerchants,"onUpdate:modelValue":[e[0]||(e[0]=s=>r.selectedmerchants=s),u.handleMerchantSelection],label:"Store or Merchant",items:u.merchants,"menu-props":{maxHeight:200}},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),a(x),a(p,{cols:"12"},{default:l(()=>[o("div",j,[a(V,{class:"mb-3",modelValue:r.searchQuery,"onUpdate:modelValue":e[1]||(e[1]=s=>r.searchQuery=s),density:"compact",variant:"solo",label:"Search","append-inner-icon":"mdi-magnify","single-line":"","hide-details":""},null,8,["modelValue"])]),a(L,{headers:r.headers,items:this.paginatedItems},{default:l(()=>[o("thead",null,[o("tr",null,[H,(d(!0),i(g,null,f(r.headers,s=>(d(),i("th",{class:"text-center",key:s},m(s.text),1))),128))])]),o("tbody",null,[(d(!0),i(g,null,f(this.paginatedItems,(s,c)=>(d(),i("tr",{key:c},[o("td",K,[a(z,{modelValue:s.selected,"onUpdate:modelValue":h=>s.selected=h},null,8,["modelValue","onUpdate:modelValue"])]),o("td",J,m(s.brand_name),1),o("td",X,m(s.sku_name),1),o("td",Y,m(s.uom),1),o("td",Z," \u20B9"+m(s.mrp),1),o("td",$,[a(V,{modelValue:s.margin,"onUpdate:modelValue":h=>s.margin=h,style:{"min-width":"80px"},rules:u.computedmarginRules(),onInput:e[2]||(e[2]=h=>u.updatemargin())},null,8,["modelValue","onUpdate:modelValue","rules"])])]))),128))])]),_:1},8,["headers","items"]),a(D,{modelValue:r.page,"onUpdate:modelValue":e[3]||(e[3]=s=>r.page=s),length:Math.ceil(u.filteredMerchant.length/r.pageSize),onInput:t.updatePagination},null,8,["modelValue","length","onInput"])]),_:1}),a(p,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:l(()=>[a(I,{onClick:e[4]||(e[4]=s=>u.validateForm())},{default:l(()=>[b("Save")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),a(Q,{modelValue:r.snackbar,"onUpdate:modelValue":e[5]||(e[5]=s=>r.snackbar=s),timeout:3500,color:r.color},{default:l(()=>[b(m(r.snackbarText),1)]),_:1},8,["modelValue","color"])])}const te=k(O,[["render",ee]]),ae={components:{Addmerchant:te},data(){return{currentroute:"",activeTab:"",tabs:[{title:"Add Merchant Products",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=S(),this.activeTab=C(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function se(t,e,n,v,r,u){const s=U("Addmerchant");return d(),i("div",null,[a(R,{modelValue:r.activeTab,"onUpdate:modelValue":e[0]||(e[0]=c=>r.activeTab=c),"show-arrows":""},{default:l(()=>[(d(!0),i(g,null,f(r.tabs,c=>(d(),N(q,{key:c.icon,value:c.tab},{default:l(()=>[a(P,{size:"20",start:"",icon:c.icon},null,8,["icon"]),b(" "+m(c.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),a(x),a(W,{modelValue:r.activeTab,"onUpdate:modelValue":e[1]||(e[1]=c=>r.activeTab=c),class:"mt-5 disable-tab-transition",touch:!1},{default:l(()=>[a(E,{value:"account"},{default:l(()=>[a(s)]),_:1})]),_:1},8,["modelValue"])])}const _e=k(ae,[["render",se]]);export{_e as default};
