import{_ as D,o as _,c as g,g as s,b7 as w,b8 as x,w as d,i as h,j as T,k as V,l as y,s as k,a,F as S,q as v,t as i,b as m,m as p,u as P,bs as G,bo as N,v as I,e as q,r as U,f as O}from"./index.1d06f628.js";import{s as R}from"./Services.0ce99c92.js";import{V as C}from"./VForm.9ae70bc4.js";import{V as B}from"./VAutocomplete.918c1e98.js";import{V as f}from"./VTextField.8958c360.js";import{V as F}from"./VSelect.9e99a8b2.js";import{V as L}from"./VTable.a0f27cab.js";import{V as b}from"./VChip.e48f2227.js";import{V as M}from"./VSnackbar.1293bbed.js";import{V as Q}from"./VDialog.1a884002.js";import{V as z,a as E,b as H,c as Y}from"./VWindowItem.06fd8df9.js";import"./VCheckboxBtn.4d1d9c3a.js";const K={mixins:[R],components:{},data(){return{loading:!0,loading2:!1,searchQuery:"",BrandRules:[t=>!!t||"Brand is required"],dateRules:[t=>!!t||"Date is required"],Statusrules:[t=>!!t||"Status Is Required"],quantityrules:[t=>!!t||"Quantity Is Required"],locationrules2:[t=>!!t||"Location Is Required"],snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,cityLoaction:[],locationdata:"",formData:{brand_id:"",user_id:"",created_date:this.getFormattedDate(new Date),delivery_date:"",po_status:"",total_cgst:"",total_sgst:"",you_saved:"",total_quantity:"","sub_total(taxable_amount_total)":"",total_so_amount:"",products:[{brand_product_id:"",sku_name:"",hsn_code:"",mrp:"",quantity:"",uom:"",price_per_unit:"",taxable_amount:"",cgst:"",sgst:"",amount:"",total_give_margin:"",sgst_percentage:"",cgst_percentage:"",margin_amount:""}]},quantityInput:0,AllBrandproducts:[],createdBy:"",userIds:"",Brandname:[],totals:{Quantity:0,TaxableAmmount:0,CGST:0,SGST:0,Ammount:0},today:this.getFormattedDate(new Date),landscape:!1,noTitle:!1,selectedPurchaseOrder:null,dialog:!1,cityID:"",locationid:"",headers:[{text:"Product Name",value:"sku_name"},{text:"UOM",value:"uom"},{text:"HSN",value:"hsn_code"},{text:"MRP",value:"mrp"},{text:"Quantity",value:"quantity"},{text:"Price/Unit",value:"calculatedPricePerUnit"},{text:"TaxableAmount",value:"calculatedTaxableAmount"},{text:"CGST",value:"calculatedCGSTAmount"},{text:"SGST",value:"calculatedSGSTAmount"},{text:"Amount",value:"calculateTotalamount"},{text:"Actions",value:"action"}]}},watch:{selectedPurchaseOrder(t){this.handleBrandSelection()},locationdata(t){this.handleBrandSelection()}},computed:{filteredBrandProducts(){return this.AllBrandproducts.filter(t=>t.quantity!==void 0)},filteredPurchaseOrder(){const t=this.searchQuery.toLowerCase().trim();return console.log("log in",t),this.filteredBrandProducts.filter(e=>e.sku_name&&e.sku_name.toLowerCase().includes(t)||e.hsn_code&&e.hsn_code.toLowerCase().includes(t)||e.mrp&&e.mrp.toString().toLowerCase().includes(t)||e.quantity&&e.quantity.toString().toLowerCase().includes(t)||e.uom&&e.uom.toLowerCase().includes(t)||e.total_given_margin&&e.total_given_margin.toString().toLowerCase().includes(t)||e.cgst&&e.cgst.toString().toLowerCase().includes(t)||e.sgst&&e.sgst.toString().toLowerCase().includes(t))},totalIndividualAmount(){return this.AllBrandproducts.reduce((t,e)=>{const c=parseFloat(e.mrp),o=parseFloat(e.quantity);if(!isNaN(c)&&!isNaN(o)){const l=c*o;return t+l}return t},0)},savedamount(){const t=parseFloat(this.allAmmount),e=this.totalIndividualAmount-(isNaN(t)?0:t);return Math.max(0,e).toFixed(2)},allAmmount(){const t=this.calculateTotalamount.reduce((e,c)=>e+parseFloat(c),0);return parseFloat(t.toFixed(2))},allSGSTAmount(){const t=this.calculatedSGSTAmount.reduce((e,c)=>e+parseFloat(c),0);return parseFloat(t.toFixed(2))},allCGSTAmount(){const t=this.calculatedCGSTAmount.reduce((e,c)=>e+parseFloat(c),0);return parseFloat(t.toFixed(2))},allTaxableAmmount(){const t=this.calculatedTaxableAmount.reduce((e,c)=>e+parseFloat(c),0);return parseFloat(t.toFixed(2))},allQuantity(){const t=this.AllBrandproducts.reduce((e,c)=>{const o=parseFloat(c.quantity);return isNaN(o)?e:e+o},0);return isNaN(t)?0:t.toFixed(0)},calculateTotalamount(){return this.AllBrandproducts.map((t,e)=>{const c=parseFloat(this.calculatedTaxableAmount[e]),o=parseFloat(this.calculatedCGSTAmount[e]),l=parseFloat(this.calculatedSGSTAmount[e]),r=c+o+l;return isNaN(r)?0:r.toFixed(2)})},calculatedSGSTAmount(){return this.AllBrandproducts.map((t,e)=>{const c=parseFloat(this.calculatedTaxableAmount[e]),o=parseFloat(t.sgst.replace("%","")),l=c*o/100;return isNaN(l)?0:l.toFixed(2)})},calculatedCGSTAmount(){return this.AllBrandproducts.map((t,e)=>{const c=parseFloat(this.calculatedTaxableAmount[e]),o=parseFloat(t.cgst.replace("%","")),l=c*o/100;return isNaN(l)?0:l.toFixed(2)})},calculateMargin(){return this.AllBrandproducts.map((t,e)=>{const c=parseFloat(t.mrp),o=parseFloat(t.total_given_margin.replace("%","")),l=c*o/100;return isNaN(l)?0:l.toFixed(2)})},calculatedPricePerUnit(){return this.AllBrandproducts.map((t,e)=>{const c=parseFloat(t.mrp),o=parseFloat(this.calculateMargin[e]),l=c-o;return isNaN(l)?0:l.toFixed(2)})},calculatedTaxableAmount(){return this.AllBrandproducts.map((t,e)=>{const c=parseFloat(t.quantity),o=this.calculatedPricePerUnit[e],l=parseFloat(t.cgst.replace("%","")),r=parseFloat(t.sgst.replace("%","")),n=parseFloat(o);if(c===0||isNaN(c)||isNaN(n))return 0;const u=o/(100+(l+r))*100*c;return isNaN(u)?0:u.toFixed(2)})},brandNames(){return this.Brandname.map(t=>t.brand_name)}},mounted(){this.cityID=localStorage.getItem("city_id"),this.getlocation(),this.locationID=localStorage.getItem("location_id"),this.getBrandsdata().then(()=>{this.loading=!1}).catch(t=>{console.error("Error fetching merchants:",t)}),this.createdBy=localStorage.getItem("createdby"),this.userIds=localStorage.getItem("userId")},methods:{getlocation(){this.getCitylocation(this.cityID).then(t=>{this.cityLoaction=t.data.data.map(e=>({value:e.location_id,text:e.location}))})},validateNumericInput(t){const e=t.target.value.replace(/[^0-9]/g,"");this.item.quantity=e},getFormattedDate(t){const e=t.getFullYear(),c=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${e}-${c}-${o}`},resetdetails(){this.AllBrandproducts.map(t=>t.quantity="")},validateForm(){this.$refs.purchaseOrderForm.validate().then(t=>{t.valid==!0?this.allQuantity>=1?this.saveData():(this.snackbar=!0,this.snackbarText="Please give Quantities",this.color="primary"):(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="on-background")})},preventPaste(t){const c=(t.clipboardData||window.clipboardData).getData("text");/^[0-9]+$/.test(c)||t.preventDefault()},preventDecimal(t){(t.key==="."||t.key===","||t.key==="+"||t.key==="-"||t.keyCode===189||t.keyCode===109)&&t.preventDefault()},saveData(){const t={Draft:1,Created:2,Shared:3,Acknowledged:4,Received:5};console.log("check the ammounts",this.AllBrandproducts.map((o,l)=>({taxable_amount:`${this.calculatedTaxableAmount[l]}`,price_per_unit:`${this.calculatedPricePerUnit[l]}`,csgt:`${this.calculatedCGSTAmount[l]}`,sgst:`${this.calculatedSGSTAmount[l]}`,amount:`${this.calculateTotalamount[l]}`,total_give_margin:o.total_given_margin})));const e=this.AllBrandproducts.filter(o=>o.quantity>0);console.log("t",e);const c={city_id:this.cityID,location_id:this.locationdata,brand_id:this.selectedBrandId,user_id:this.userIds,created_date:this.formData.created_date,delivery_date:this.formData.delivery_date,po_status:t[this.formData.po_status],total_cgst:`${this.allCGSTAmount}`,total_sgst:`${this.allSGSTAmount}`,you_saved:`${this.savedamount}`,sub_total:`${this.allTaxableAmmount}`,total_po_amount:`${this.allAmmount}`,total_quantity:`${this.allQuantity}`,products:e.map((o,l)=>{const r=this.AllBrandproducts.findIndex(n=>n===o);return{brand_product_id:o.brand_product_id,sku_name:o.sku_name,hsn_code:o.hsn_code,mrp:o.mrp,quantity:`${o.quantity}`,uom:`${o.uom}`,sgst_percentage:o.sgst.includes("%")?`${o.sgst}`:`${o.sgst}%`,cgst_percentage:o.cgst.includes("%")?`${o.cgst}`:`${o.cgst}%`,price_per_unit:`${this.calculatedPricePerUnit[r]}`,taxable_amount:`${this.calculatedTaxableAmount[r]}`,csgt:`${this.calculatedCGSTAmount[r]}`,sgst:`${this.calculatedSGSTAmount[r]}`,amount:`${this.calculateTotalamount[r]}`,total_give_margin:o.total_given_margin}})};console.log("check the post data",c),this.postPurchaseorder(c).then(o=>{console.log("check the response",o),o.status==1?(this.snackbar=!0,this.color="primary",this.formData={},this.snackbarText=o.message,setTimeout(()=>{window.location.reload(!0)},1300)):(this.snackbar=!0,this.color="on-background")})},colorTGMmargin(t){return t?{color:"success"}:{color:"error"}},colorSGSTmargin(t){return t?{color:"success"}:{color:"error"}},colorCGSTmargin(t){return t?{color:"success"}:{color:"error"}},handleBrandSelection(){const t=this.Brandname.find(e=>e.brand_name===this.selectedPurchaseOrder);t&&(this.selectedBrandId=t.brand_id,this.loading2=!0,this.getBrandproducts(this.selectedBrandId,this.locationdata).then(e=>{this.AllBrandproducts=e.data,this.loading2=!1,console.log("BrandID",this.AllBrandproducts)}))},getBrandsdata(){return new Promise((t,e)=>{this.getBrands(this.cityID,this.locationID).then(c=>{this.Brandname=c.data,t()}).catch(c=>{console.error("Error fetching merchants:",c),e(c)})})},onDateChange(){},deleteRow(t){const e=this.AllBrandproducts.indexOf(t);e!==-1&&this.AllBrandproducts.splice(e,1)},openproductdialog(){this.dialog=!0},closeDialog(){this.dialog=!1}}},W={key:0,class:"loading-container"},j={key:0,id:"app"},J=a("div",{id:"loading-bg"},[a("div",{class:"loading-logo"},[a("img",{src:N,height:"60",width:"68",alt:"Logo"})]),a("div",{class:"loading"},[a("div",{class:"effect-1 effects"}),a("div",{class:"effect-2 effects"}),a("div",{class:"effect-3 effects"})])],-1),X=[J],Z={style:{"max-width":"400px"}},$={key:0},tt=a("td",{colspan:"16",class:"text-center"},[a("h1",null,"No data found !")],-1),et=[tt],at={class:"text-center"},lt={class:"text-center"},st={class:"text-center"},ot={class:"text-center"},rt={class:"text-center"},nt={class:"text-center"},ct=a("br",null,null,-1),dt={class:"text-center"},it={class:"text-center"},ut=a("br",null,null,-1),mt={class:"text-center"},ht=a("br",null,null,-1),_t={class:"text-center"},gt=a("td",{class:"text-center"},"Total",-1),pt=a("td",null,null,-1),ft=a("td",null,null,-1),xt=a("td",null,null,-1),yt={class:"text-center"},bt=a("td",null,null,-1),St={class:"text-center"},vt={class:"text-center"},At={class:"text-center"},Tt={class:"text-center"},Vt=a("td",null,null,-1),Ct=a("tr",null,[a("td",{class:"text-left",style:{"font-weight":"Bold"}},"Tax Details:"),a("td",{colspan:"4",class:"text-right"}),a("td",{colspan:"4",class:"text-left",style:{"font-weight":"Bold"}},"Amounts:"),a("td",{colspan:"4",class:"text-center"})],-1),Bt=a("td",{class:"text-left"},"CGST",-1),Ft={colspan:"4",class:"text-right"},Dt=a("td",{colspan:"4",class:"text-left"},"SubTotal",-1),kt={colspan:"4",class:"text-center"},Pt=a("td",{class:"text-left"},"SGST",-1),wt={colspan:"4",class:"text-right"},Gt=a("td",{colspan:"4",class:"text-left"},"Total",-1),Nt={colspan:"4",class:"text-center"},It=a("td",{class:"text-left"},null,-1),qt=a("td",{colspan:"4",class:"text-right"},null,-1),Ut=a("td",{colspan:"4",class:"text-left"},"Advance",-1),Ot={colspan:"4",class:"text-center"},Rt=a("td",{class:"text-left"},null,-1),Lt=a("td",{colspan:"4",class:"text-right"},null,-1),Mt=a("td",{colspan:"4",class:"text-left"},"Balance",-1),Qt={colspan:"4",class:"text-center"},zt=a("td",{class:"text-left"},null,-1),Et=a("td",{colspan:"4",class:"text-right"},null,-1),Ht=a("td",{colspan:"4",class:"text-left"},"You Saved",-1),Yt={colspan:"4",class:"text-center"};function Kt(t,e,c,o,l,r){return _(),g("div",null,[l.loading?(_(),g("div",W,[s(w,{height:"5",color:"primary",indeterminate:"",class:"custom-loader","full-width":""})])):x("",!0),s(y,null,{default:d(()=>[s(h,{cols:"12"},{default:d(()=>[s(T,{title:"Purchase Order",class:"mb-4"},{default:d(()=>[s(V,null,{default:d(()=>[s(C,{class:"mt-6",ref:"purchaseOrderForm"},{default:d(()=>[s(y,null,{default:d(()=>[s(h,{md:"6",cols:"12"},{default:d(()=>[s(B,{modelValue:l.selectedPurchaseOrder,"onUpdate:modelValue":e[0]||(e[0]=n=>l.selectedPurchaseOrder=n),label:"Brand or Manufacturer",items:r.brandNames,rules:l.BrandRules,"menu-props":{maxHeight:200}},null,8,["modelValue","items","rules"])]),_:1}),s(h,{md:"6",cols:"12"},{default:d(()=>[s(B,{modelValue:l.locationdata,"onUpdate:modelValue":e[1]||(e[1]=n=>l.locationdata=n),label:"Purchase Order From",items:this.cityLoaction,"item-value":"value","item-title":"text",rules:l.locationrules2,"menu-props":{maxHeight:200}},null,8,["modelValue","items","rules"])]),_:1}),s(h,{cols:"12",md:"6"},{default:d(()=>[s(f,{modelValue:l.createdBy,"onUpdate:modelValue":e[2]||(e[2]=n=>l.createdBy=n),label:"Created By",readonly:""},null,8,["modelValue"])]),_:1}),s(h,{cols:"12",md:"6"},{default:d(()=>[s(f,{modelValue:l.formData.created_date,"onUpdate:modelValue":e[3]||(e[3]=n=>l.formData.created_date=n),type:"date",label:"Order Date",min:l.today,rules:l.dateRules,readonly:""},null,8,["modelValue","min","rules"])]),_:1}),s(h,{md:"6",cols:"12"},{default:d(()=>[s(F,{modelValue:l.formData.po_status,"onUpdate:modelValue":e[4]||(e[4]=n=>l.formData.po_status=n),label:"PO Status",items:["Draft","Created","Shared","Acknowledged"],rules:l.Statusrules},null,8,["modelValue","rules"])]),_:1}),s(h,{md:"6",cols:"12"},{default:d(()=>[s(f,{modelValue:l.formData.delivery_date,"onUpdate:modelValue":e[5]||(e[5]=n=>l.formData.delivery_date=n),type:"date",label:"Delivery Date",min:l.today,rules:l.dateRules},null,8,["modelValue","min","rules"])]),_:1}),s(k),l.loading2?(_(),g("div",j,X)):x("",!0),s(h,{cols:"12"},{default:d(()=>[a("div",Z,[s(f,{class:"mb-3",modelValue:l.searchQuery,"onUpdate:modelValue":e[6]||(e[6]=n=>l.searchQuery=n),density:"compact",variant:"solo",label:"Search","append-inner-icon":"mdi-magnify","single-line":"","hide-details":""},null,8,["modelValue"])]),s(L,{headers:l.headers,items:r.filteredBrandProducts},{default:d(()=>[a("thead",null,[a("tr",null,[(_(!0),g(S,null,v(l.headers,n=>(_(),g("th",{class:"text-center",key:n},i(n.text),1))),128))])]),a("tbody",null,[r.filteredPurchaseOrder.length===0?(_(),g("tr",$,et)):x("",!0),(_(!0),g(S,null,v(r.filteredPurchaseOrder,(n,u)=>(_(),g("tr",{key:u},[a("td",at,i(n.sku_name),1),a("td",lt,i(n.uom),1),a("td",st,i(n.hsn_code),1),a("td",ot," \u20B9"+i(n.mrp),1),a("td",rt,[s(f,{onKeydown:r.preventDecimal,onPaste:r.preventPaste,modelValue:n.quantity,"onUpdate:modelValue":A=>n.quantity=A,type:"number",min:"0",style:{"min-width":"80px"}},null,8,["onKeydown","onPaste","modelValue","onUpdate:modelValue"])]),a("td",nt,[m(" \u20B9 "+i(r.calculatedPricePerUnit[u])+" ",1),ct,s(b,{color:r.colorTGMmargin(n.total_given_margin).color,class:"font-weight-medium",size:"small"},{default:d(()=>[m(" ("+i(n.total_given_margin)+") ",1)]),_:2},1032,["color"])]),a("td",dt," \u20B9"+i(r.calculatedTaxableAmount[u]),1),a("td",it,[m(" \u20B9"+i(r.calculatedCGSTAmount[u])+" ",1),ut,s(b,{color:r.colorCGSTmargin(n.cgst).color,class:"font-weight-medium",size:"small"},{default:d(()=>[m(" ("+i(n.cgst)+") ",1)]),_:2},1032,["color"])]),a("td",mt,[m(" \u20B9"+i(r.calculatedSGSTAmount[u])+" ",1),ht,s(b,{color:r.colorSGSTmargin(n.sgst).color,class:"font-weight-medium",size:"small"},{default:d(()=>[m(" ("+i(n.sgst)+") ",1)]),_:2},1032,["color"])]),a("td",_t," \u20B9"+i(r.calculateTotalamount[u]),1),a("td",null,[s(p,{icon:"",variant:"text",color:"error",class:"me-2",size:"small",onClick:A=>r.deleteRow(n)},{default:d(()=>[s(P,{icon:"mdi-minus-circle-outline",size:"24"})]),_:2},1032,["onClick"])])]))),128))]),a("tfoot",null,[a("tr",null,[gt,pt,ft,xt,a("td",yt,i(r.allQuantity),1),bt,a("td",St," \u20B9"+i(r.allTaxableAmmount),1),a("td",vt," \u20B9"+i(r.allCGSTAmount),1),a("td",At," \u20B9"+i(r.allSGSTAmount),1),a("td",Tt," \u20B9"+i(r.allAmmount),1),Vt]),Ct,a("tr",null,[Bt,a("td",Ft,"\u20B9"+i(r.allCGSTAmount),1),Dt,a("td",kt,"\u20B9"+i(r.allAmmount),1)]),a("tr",null,[Pt,a("td",wt,"\u20B9"+i(r.allSGSTAmount),1),Gt,a("td",Nt,"\u20B9"+i(r.allAmmount),1)]),a("tr",null,[It,qt,Ut,a("td",Ot,"\u20B9"+i(l.totals.Quantity),1)]),a("tr",null,[Rt,Lt,Mt,a("td",Qt,"\u20B9"+i(r.allAmmount),1)]),a("tr",null,[zt,Et,Ht,a("td",Yt,"\u20B9"+i(r.savedamount),1)])])]),_:1},8,["headers","items"])]),_:1}),s(h,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:d(()=>[s(p,{onClick:r.validateForm},{default:d(()=>[m("Save")]),_:1},8,["onClick"]),s(p,{color:"secondary",variant:"tonal",onClick:e[7]||(e[7]=n=>r.resetdetails())},{default:d(()=>[m(" Reset ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),s(M,{modelValue:l.snackbar,"onUpdate:modelValue":e[8]||(e[8]=n=>l.snackbar=n),timeout:3500,color:l.color},{default:d(()=>[m(i(l.snackbarText),1)]),_:1},8,["modelValue","color"]),s(Q,{modelValue:l.dialog,"onUpdate:modelValue":e[9]||(e[9]=n=>l.dialog=n),"max-width":"600"},{default:d(()=>[s(T,{title:"Add Your Product"},{default:d(()=>[s(V,null,{default:d(()=>[s(C,{class:"mt-6"},{default:d(()=>[s(y,null,{default:d(()=>[s(h,{md:"6",cols:"12"},{default:d(()=>[s(F,{label:"Products",items:["Normal Eggs","Premium Eggs","Poori","Methi Chapathi","Ragi Chapathi"]})]),_:1}),s(h,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:d(()=>[s(p,null,{default:d(()=>[m("Add")]),_:1}),s(p,{color:"secondary",variant:"tonal",type:"reset",onClick:r.closeDialog},{default:d(()=>[m(" Close ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1}),s(G)]),_:1})]),_:1},8,["modelValue"])])}const Wt=D(K,[["render",Kt]]),jt={components:{Addpurchaseorders:Wt},data(){return{currentroute:"",activeTab:"",tabs:[{title:"Create Purchase Order",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=I(),this.activeTab=q(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function Jt(t,e,c,o,l,r){const n=U("Addpurchaseorders");return _(),g("div",null,[s(z,{modelValue:l.activeTab,"onUpdate:modelValue":e[0]||(e[0]=u=>l.activeTab=u),"show-arrows":""},{default:d(()=>[(_(!0),g(S,null,v(l.tabs,u=>(_(),O(Y,{key:u.icon,value:u.tab},{default:d(()=>[s(P,{size:"20",start:"",icon:u.icon},null,8,["icon"]),m(" "+i(u.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),s(k),s(H,{modelValue:l.activeTab,"onUpdate:modelValue":e[1]||(e[1]=u=>l.activeTab=u),class:"mt-5 disable-tab-transition",touch:!1},{default:d(()=>[s(E,{value:"account"},{default:d(()=>[s(n)]),_:1})]),_:1},8,["modelValue"])])}const de=D(jt,[["render",Jt]]);export{de as default};
