import{_ as v,o as c,c as h,g as r,b7 as D,b8 as p,w as n,i as g,j as k,k as w,l as S,a as o,F as b,q as y,t as m,m as C,b as V,a4 as T,b9 as P,ac as O,bo as L,v as q,e as M,s as I,r as U,f as B,u as F}from"./index.fe0f4396.js";import{s as N}from"./Services.9c2b0029.js";import{V as R}from"./VForm.e88938f6.js";import{V as x}from"./VAutocomplete.c3fd70c4.js";import{V as f}from"./VTextField.a9260b85.js";import{V as E}from"./VTable.5251caba.js";import{V as K}from"./VSnackbar.0de1d98b.js";import{V as Q,a as H,b as A,c as W}from"./VWindowItem.29924bf5.js";import"./VSelect.53493482.js";import"./VCheckboxBtn.7877dafe.js";import"./VChip.d98fb3cc.js";const z={mixins:[N],data(){return{snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,selectedSalesOrder:"",Merchants:[],loading:!0,cityID:null,merchantProducts:[],searchQuery:"",loading2:!1,soData:[],selectSodata:"",soDetailsd:[],Locationids:"",CreatedDate:"",today:this.getFormattedDate(new Date),merchantrules:[e=>!!e||"Merchnat is required"],sorules:[e=>!!e||"SOData is required"],dateRules:[e=>!!e||"Date is required"],userIds:"",selectedDate:"",selectedDateTime:"",dateRules:[e=>!!e||"Date is required"],headers:[{text:"Product Name",value:"sku_name"},{text:"Brand Name",value:"brand_name"},{text:"UOM",value:"uom"},{text:"HSN",value:"hsn_code"},{text:"MRP",value:"mrp"},{text:"Quantity",value:"quantity"},{text:"Return",value:"return"},{text:"Exchange",value:"exchange"}]}},computed:{filteredmerchantProducts(){return this.merchantProducts.filter(e=>e.quantity!==void 0)},filteredSalesOrder(){const e=this.searchQuery.toLowerCase().trim();return this.filteredmerchantProducts.filter(t=>t.brand_name&&t.brand_name.toLowerCase().includes(e)||t.hsn_code&&t.hsn_code.toLowerCase().includes(e)||t.mrp&&t.mrp.toString().toLowerCase().includes(e)||t.quantity&&t.quantity.toString().toLowerCase().includes(e)||t.uom&&t.uom.toLowerCase().includes(e)||t.total_given_margin&&t.total_given_margin.toString().toLowerCase().includes(e)||t.cgst&&t.cgst.toString().toLowerCase().includes(e)||t.sgst&&t.sgst.toString().toLowerCase().includes(e)||t.return&&t.return.toString().toLowerCase().includes(e)||t.sku_name&&t.sku_name.toLowerCase().includes(e)||t.exchange&&t.exchange.toLowerCase().includes(e))},merchantsdata(){return this.Merchants.map(e=>({value:e.merchant_id,text:e.merchant_uid}))}},mounted(){this.userIds=localStorage.getItem("userId"),this.cityID=localStorage.getItem("city_id");const e=localStorage.getItem("sodetails");if(e)try{this.soData=JSON.parse(e),this.soDetailsd=this.soData.map(t=>({value:t.entity_id,text:t.name})),Array.isArray(this.soData)||(this.soData=[])}catch(t){console.error("Error parsing sodetails from localStorage:",t),this.soData=[]}this.getMerchantdetails().then(()=>{this.loading=!1}).catch(t=>{})},watch:{selectedSalesOrder(e){this.handleBrandSelection(e),this.handlestockSelection(e)}},methods:{handlestockSelection(e){this.getStcksdata(e).then(t=>{console.log("fret",t),this.merchantProducts.forEach(i=>{const a=t.data.products.find(s=>s.merchant_product_id===i.brand_product_id);a&&(i.closing=a.closing)})})},updateDateTime(){if(this.selectedDate){const e=new Date,t=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0"),a=String(e.getSeconds()).padStart(2,"0");this.selectedDateTime=`${this.selectedDate} ${t}:${i}:${a}`}},getFormattedDate(e){const t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),d=String(e.getMinutes()).padStart(2,"0"),l=String(e.getSeconds()).padStart(2,"0");return`${t}-${i}-${a} ${s}:${d}:${l}`},validateform(){this.$refs.purchaseOrderForm.validate().then(e=>{e.valid==!0?this.SaveSO():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="on-background")})},SaveSO(){let e=!0;if(this.merchantProducts.forEach(a=>{(a.return>a.closing||a.exchange>a.closing)&&(e=!1)}),!e){this.snackbar=!0,this.snackbarText="The return or exchange quantity for some products exceeds the closing stock. Please correct the quantities.",this.color="error";return}const t=this.merchantProducts.filter(a=>a.quantity>0||a.return>0||a.exchange>0),i={merchant_id:this.selectedSalesOrder,user_id:this.userIds,entity_id:this.selectSodata,city_id:this.cityID,location_id:this.Locationids,so_status:3,created_date:this.selectedDateTime,device:"CRM-WEB",products:t.map(a=>({merchant_product_id:a.brand_product_id,brand_name:a.brand_name,sku_name:a.sku_name,uom:a.uom,mrp:a.mrp,hsn_code:a.hsn_code,quantity:`${a.quantity}`,return:`${a.return}`,rtv_reason:"",exchange:`${a.exchange}`}))};console.log({postData:i}),this.saveSorder(i).then(a=>{console.log({response:a}),a.data.status==1?(this.snackbar=!0,this.snackbarText=a.data.message,this.color="primary",window.location.reload()):(this.snackbar=!0,this.snackbarText=a.data.message,this.color="on-background")})},preventDecimal(e){(e.key==="."||e.key===","||e.key==="+"||e.key==="-"||e.keyCode===189||e.keyCode===109)&&e.preventDefault()},preventPaste(e){const i=(e.clipboardData||window.clipboardData).getData("text");/^[0-9]+$/.test(i)||e.preventDefault()},handleBrandSelection(e){this.loading2=!0,this.salesMerchantProducts(e).then(t=>{console.log("check the response",t),t.data.status==1?(this.merchantProducts=t.data.merchant_product_details.products,this.snackbar=!0,this.snackbarText=t.data.message,this.color="primary",this.loading2=!1):(this.snackbar=!0,this.snackbarText=t.data.message,this.color="primary",this.loading2=!1)})},getMerchantdetails(){return new Promise((e,t)=>{this.getMerchants(this.cityID).then(i=>{this.Merchants=i.data.data,this.Locationids=this.Merchants[0].location_id,e()}).catch(i=>{t(i)})})}}},j={key:0,class:"loading-container"},J={key:0,id:"app"},Y=o("div",{id:"loading-bg"},[o("div",{class:"loading-logo"},[o("img",{src:L,height:"60",width:"68",alt:"Logo"})]),o("div",{class:"loading"},[o("div",{class:"effect-1 effects"}),o("div",{class:"effect-2 effects"}),o("div",{class:"effect-3 effects"})])],-1),G=[Y],X={style:{"max-width":"400px"}},Z={key:0},$=o("td",{colspan:"16",class:"text-center"},[o("h1",null,"No data found !")],-1),ee=[$],te={class:"text-center"},ae={class:"text-center"},se={class:"text-center"},re={class:"text-center"},le={class:"text-center"},oe={class:"text-center"},ne={class:"text-center"},ie={class:"text-center"};function de(e,t,i,a,s,d){return c(),h("div",null,[s.loading?(c(),h("div",j,[r(D,{height:"5",color:"primary",indeterminate:"",class:"custom-loader","full-width":""})])):p("",!0),r(S,null,{default:n(()=>[r(g,{cols:"12"},{default:n(()=>[r(k,{title:"Sales Order",class:"mb-4"},{default:n(()=>[r(w,null,{default:n(()=>[r(R,{class:"mt-6",ref:"purchaseOrderForm"},{default:n(()=>[r(S,null,{default:n(()=>[r(g,{md:"6",cols:"12"},{default:n(()=>[r(x,{modelValue:s.selectedSalesOrder,"onUpdate:modelValue":t[0]||(t[0]=l=>s.selectedSalesOrder=l),label:"Merchants",items:d.merchantsdata,"item-value":"value","item-title":"text",rules:s.merchantrules,"menu-props":{maxHeight:200}},null,8,["modelValue","items","rules"])]),_:1}),r(g,{md:"6",cols:"12"},{default:n(()=>[r(x,{modelValue:s.selectSodata,"onUpdate:modelValue":t[1]||(t[1]=l=>s.selectSodata=l),label:"SO Details",items:this.soDetailsd,"item-value":"value","item-title":"text",rules:s.sorules,"menu-props":{maxHeight:200}},null,8,["modelValue","items","rules"])]),_:1}),r(g,{cols:"12",md:"6"},{default:n(()=>[r(f,{modelValue:s.selectedDate,"onUpdate:modelValue":t[2]||(t[2]=l=>s.selectedDate=l),type:"date",label:"Select Date",onInput:d.updateDateTime,rules:s.dateRules},null,8,["modelValue","onInput","rules"])]),_:1}),r(g,{cols:"12",md:"6"},{default:n(()=>[r(f,{modelValue:s.selectedDateTime,"onUpdate:modelValue":t[3]||(t[3]=l=>s.selectedDateTime=l),label:"Selected Date and Time"},null,8,["modelValue"])]),_:1}),r(g,{cols:"12"},{default:n(()=>[s.loading2?(c(),h("div",J,G)):p("",!0),o("div",X,[r(f,{class:"mb-3",modelValue:s.searchQuery,"onUpdate:modelValue":t[4]||(t[4]=l=>s.searchQuery=l),density:"compact",variant:"solo",label:"Search","append-inner-icon":"mdi-magnify","single-line":"","hide-details":""},null,8,["modelValue"])]),r(E,{headers:s.headers,items:d.filteredSalesOrder},{default:n(()=>[o("thead",null,[o("tr",null,[(c(!0),h(b,null,y(s.headers,l=>(c(),h("th",{class:"text-center",key:l},m(l.text),1))),128))])]),o("tbody",null,[d.filteredSalesOrder.length===0?(c(),h("tr",Z,ee)):p("",!0),(c(!0),h(b,null,y(d.filteredSalesOrder,(l,u)=>(c(),h("tr",{key:u},[o("td",te,m(l.sku_name),1),o("td",ae,m(l.brand_name),1),o("td",se,m(l.uom),1),o("td",re,m(l.hsn_code),1),o("td",le,m(l.mrp),1),o("td",oe,[r(f,{onKeydown:d.preventDecimal,onPaste:d.preventPaste,modelValue:l.quantity,"onUpdate:modelValue":_=>l.quantity=_,type:"number",min:"0",style:{"min-width":"80px"}},null,8,["onKeydown","onPaste","modelValue","onUpdate:modelValue"])]),o("td",ne,[r(f,{onKeydown:d.preventDecimal,onPaste:d.preventPaste,modelValue:l.return,"onUpdate:modelValue":_=>l.return=_,type:"number",min:"0",style:{"min-width":"80px"}},null,8,["onKeydown","onPaste","modelValue","onUpdate:modelValue"])]),o("td",ie,[r(f,{onKeydown:d.preventDecimal,onPaste:d.preventPaste,modelValue:l.exchange,"onUpdate:modelValue":_=>l.exchange=_,type:"number",min:"0",style:{"min-width":"80px"}},null,8,["onKeydown","onPaste","modelValue","onUpdate:modelValue"])])]))),128))])]),_:1},8,["headers","items"])]),_:1}),r(g,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:n(()=>[r(C,{onClick:d.validateform},{default:n(()=>[V("Save")]),_:1},8,["onClick"]),T(r(P,{size:50,color:"primary",indeterminate:""},null,512),[[O,e.isProgress]])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),r(K,{modelValue:s.snackbar,"onUpdate:modelValue":t[5]||(t[5]=l=>s.snackbar=l),timeout:3500,color:s.color},{default:n(()=>[V(m(s.snackbarText),1)]),_:1},8,["modelValue","color"])])}const ce=v(z,[["render",de]]),ue={components:{Createsales:ce},data(){return{currentroute:"",activeTab:"",tabs:[{title:"Create Sales Order",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=q(),this.activeTab=M(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function he(e,t,i,a,s,d){const l=U("Createsales");return c(),h("div",null,[r(Q,{modelValue:s.activeTab,"onUpdate:modelValue":t[0]||(t[0]=u=>s.activeTab=u),"show-arrows":""},{default:n(()=>[(c(!0),h(b,null,y(s.tabs,u=>(c(),B(W,{key:u.icon,value:u.tab},{default:n(()=>[r(F,{size:"20",start:"",icon:u.icon},null,8,["icon"]),V(" "+m(u.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),r(I),r(A,{modelValue:s.activeTab,"onUpdate:modelValue":t[1]||(t[1]=u=>s.activeTab=u),class:"mt-5 disable-tab-transition",touch:!1},{default:n(()=>[r(H,{value:"account"},{default:n(()=>[r(l)]),_:1})]),_:1},8,["modelValue"])])}const De=v(ue,[["render",he]]);export{De as default};
