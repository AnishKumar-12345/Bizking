import{_ as v,o as c,c as h,g as r,b7 as D,b8 as p,w as o,i as m,j as k,k as w,l as S,a as n,F as b,q as V,t as _,m as P,b as y,a5 as C,b9 as T,ac as O,bq as q,v as L,e as U,r as M,f as N,u as I,s as B}from"./index.08705643.js";import{s as F}from"./Services.f9e4372b.js";import{V as A}from"./VForm.eec84c64.js";import{V as x}from"./VAutocomplete.457394fd.js";import{V as g}from"./VTextField.0584a3e6.js";import{V as R}from"./VTable.eda8fa83.js";import{V as E}from"./VSnackbar.89c018e7.js";import{V as K,a as Q,b as H,c as W}from"./VWindowItem.2d182e11.js";import"./VCounter.d136124c.js";import"./VSelect.00b3ff1f.js";import"./VCheckboxBtn.770726d6.js";import"./VChip.cd0ade04.js";const z={mixins:[F],data(){return{snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,selectedSalesOrder:"",Merchants:[],loading:!0,cityID:null,merchantProducts:[],searchQuery:"",loading2:!1,soData:[],selectSodata:"",soDetailsd:[],Locationids:"",useriddata:"",cityiddata:"",CreatedDate:"",today:this.getFormattedDate(new Date),merchantrules:[t=>!!t||"Merchnat is required"],sorules:[t=>!!t||"SOData is required"],dateRules:[t=>!!t||"Date is required"],userIds:"",PONumber:"",billingaddress:"",storeAddress:"",selectedDate:"",selectedDateTime:"",dateRules:[t=>!!t||"Date is required"],headers:[{text:"Product Name",value:"sku_name"},{text:"Brand Name",value:"brand_name"},{text:"UOM",value:"uom"},{text:"HSN",value:"hsn_code"},{text:"MRP",value:"mrp"},{text:"Quantity",value:"quantity"},{text:"Return",value:"return"},{text:"Exchange",value:"exchange"}]}},computed:{minDate(){const t=new Date,e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${i}`},filteredmerchantProducts(){return this.merchantProducts.filter(t=>t.quantity!==void 0)},filteredSalesOrder(){const t=this.searchQuery.toLowerCase().trim();return this.filteredmerchantProducts.filter(e=>e.brand_name&&e.brand_name.toLowerCase().includes(t)||e.hsn_code&&e.hsn_code.toLowerCase().includes(t)||e.mrp&&e.mrp.toString().toLowerCase().includes(t)||e.quantity&&e.quantity.toString().toLowerCase().includes(t)||e.uom&&e.uom.toLowerCase().includes(t)||e.total_given_margin&&e.total_given_margin.toString().toLowerCase().includes(t)||e.cgst&&e.cgst.toString().toLowerCase().includes(t)||e.sgst&&e.sgst.toString().toLowerCase().includes(t)||e.return&&e.return.toString().toLowerCase().includes(t)||e.sku_name&&e.sku_name.toLowerCase().includes(t)||e.exchange&&e.exchange.toLowerCase().includes(t))},merchantsdata(){return this.Merchants.map(t=>({value:t.merchant_id,text:t.merchant_uid}))}},watch:{selectedSalesOrder(t){this.handleBrandSelection(t),this.handlestockSelection(t)}},mounted(){this.userIds=localStorage.getItem("userId"),this.cityID=localStorage.getItem("city_id");const t=localStorage.getItem("sodetails");if(t)try{this.soData=JSON.parse(t),this.soDetailsd=this.soData.map(e=>({value:e.entity_id,text:e.name})),Array.isArray(this.soData)||(this.soData=[])}catch(e){console.error("Error parsing sodetails from localStorage:",e),this.soData=[]}this.getMerchantdetails().then(()=>{this.loading=!1}).catch(e=>{})},methods:{handlestockSelection(t){this.getStcksdata(t).then(e=>{console.log("fret",e),this.merchantProducts.forEach(a=>{const i=e.data.products.find(s=>s.merchant_product_id===a.brand_product_id);i&&(a.closing=i.closing)})})},updateDateTime(){if(this.selectedDate){const t=new Date,e=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0"),i=String(t.getSeconds()).padStart(2,"0");this.selectedDateTime=`${this.selectedDate} ${e}:${a}:${i}`}},getFormattedDate(t){const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),s=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0"),l=String(t.getSeconds()).padStart(2,"0");return`${e}-${a}-${i} ${s}:${d}:${l}`},validateform(){this.$refs.purchaseOrderForm.validate().then(t=>{t.valid?this.merchantProducts.some(a=>a.quantity>0||a.return>0||a.exchange>0)?this.SaveSO():(this.snackbar=!0,this.snackbarText="Please provide quantities for quantity, return, or exchange.",this.color="on-background"):(this.snackbar=!0,this.snackbarText="Please fill all mandatory fields.",this.color="on-background")})},SaveSO(){let t=!0;if(this.merchantProducts.forEach(a=>{(a.return>a.closing||a.exchange>a.closing)&&(t=!1)}),!t){this.snackbar=!0,this.snackbarText="The return or exchange quantity for some products exceeds the closing stock. Please correct the quantities.",this.color="error";return}const e={merchant_id:this.selectedSalesOrder,user_id:this.useriddata,entity_id:this.selectSodata,city_id:this.cityiddata,location_id:this.Locationids,so_status:3,po_number:this.PONumber,created_date:this.selectedDateTime,device:"CRM-WEB",products:this.merchantProducts.map(a=>({merchant_product_id:a.brand_product_id,brand_name:a.brand_name,sku_name:a.sku_name,uom:a.uom,mrp:a.mrp,hsn_code:a.hsn_code,quantity:`${a.quantity}`,return:`${a.return}`,rtv_reason:"",exchange:`${a.exchange}`}))};console.log({postData:e}),this.saveSorder(e).then(a=>{console.log({response:a}),a.data.status==1?(this.snackbar=!0,this.snackbarText=a.data.message,this.color="primary",window.location.reload()):(this.snackbar=!0,this.snackbarText=a.data.message,this.color="on-background")})},preventDecimal(t){(t.key==="."||t.key===","||t.key==="+"||t.key==="-"||t.keyCode===189||t.keyCode===109)&&t.preventDefault()},preventPaste(t){const a=(t.clipboardData||window.clipboardData).getData("text");/^[0-9]+$/.test(a)||t.preventDefault()},handleBrandSelection(t){this.loading2=!0,this.salesMerchantProducts(t).then(e=>{e.data.status==1?(this.merchantProducts=e.data.merchant_product_details.products,this.billingaddress=e.data.merchant_product_details.billing_address,this.storeAddress=e.data.merchant_product_details.store_address,this.Locationids=e.data.merchant_product_details.location_id,this.useriddata=e.data.merchant_product_details.user_id,this.cityiddata=e.data.merchant_product_details.city_id,this.snackbar=!0,this.snackbarText=e.data.message,this.color="primary",this.loading2=!1):(this.snackbar=!0,this.snackbarText=e.data.message,this.color="primary",this.loading2=!1)})},getMerchantdetails(){return new Promise((t,e)=>{this.getMerchants(this.cityID).then(a=>{console.log("check the resp",a),this.Merchants=a.data.data,t()}).catch(a=>{e(a)})})}}},Y={key:0,class:"loading-container"},j={key:0,id:"app"},J=n("div",{id:"loading-bg"},[n("div",{class:"loading-logo"},[n("img",{src:q,height:"60",width:"68",alt:"Logo"})]),n("div",{class:"loading"},[n("div",{class:"effect-1 effects"}),n("div",{class:"effect-2 effects"}),n("div",{class:"effect-3 effects"})])],-1),G=[J],X={style:{"max-width":"400px"}},Z={key:0},$=n("td",{colspan:"16",class:"text-center"},[n("h1",null,"No data found !")],-1),ee=[$],te={class:"text-center"},ae={class:"text-center"},se={class:"text-center"},re={class:"text-center"},le={class:"text-center"},oe={class:"text-center"},ne={class:"text-center"},de={class:"text-center"};function ie(t,e,a,i,s,d){return c(),h("div",null,[s.loading?(c(),h("div",Y,[r(D,{height:"5",color:"primary",indeterminate:"",class:"custom-loader","full-width":""})])):p("",!0),r(S,null,{default:o(()=>[r(m,{cols:"12"},{default:o(()=>[r(k,{title:"Sales Order",class:"mb-4"},{default:o(()=>[r(w,null,{default:o(()=>[r(A,{ref:"purchaseOrderForm",class:"mt-6"},{default:o(()=>[r(S,null,{default:o(()=>[r(m,{md:"6",cols:"12"},{default:o(()=>[r(x,{modelValue:s.selectedSalesOrder,"onUpdate:modelValue":e[0]||(e[0]=l=>s.selectedSalesOrder=l),label:"Merchants",items:d.merchantsdata,"item-value":"value","item-title":"text",rules:s.merchantrules,"menu-props":{maxHeight:200}},null,8,["modelValue","items","rules"])]),_:1}),r(m,{md:"6",cols:"12"},{default:o(()=>[r(x,{modelValue:s.selectSodata,"onUpdate:modelValue":e[1]||(e[1]=l=>s.selectSodata=l),label:"SO Details",items:s.soDetailsd,"item-value":"value","item-title":"text",rules:s.sorules,"menu-props":{maxHeight:200}},null,8,["modelValue","items","rules"])]),_:1}),r(m,{cols:"12",md:"6"},{default:o(()=>[r(g,{modelValue:s.selectedDate,"onUpdate:modelValue":e[2]||(e[2]=l=>s.selectedDate=l),type:"date",label:"So Created Date",rules:s.dateRules,min:d.minDate,onInput:d.updateDateTime},null,8,["modelValue","rules","min","onInput"])]),_:1}),r(m,{cols:"12",md:"6"},{default:o(()=>[r(g,{modelValue:s.selectedDateTime,"onUpdate:modelValue":e[3]||(e[3]=l=>s.selectedDateTime=l),label:"So Created Date and Time",readonly:""},null,8,["modelValue"])]),_:1}),r(m,{cols:"12",md:"6"},{default:o(()=>[r(g,{modelValue:s.billingaddress,"onUpdate:modelValue":e[4]||(e[4]=l=>s.billingaddress=l),label:"Billing Address",readonly:""},null,8,["modelValue"])]),_:1}),r(m,{cols:"12",md:"6"},{default:o(()=>[r(g,{modelValue:s.storeAddress,"onUpdate:modelValue":e[5]||(e[5]=l=>s.storeAddress=l),label:"Store Address",readonly:""},null,8,["modelValue"])]),_:1}),r(m,{cols:"12",md:"6"},{default:o(()=>[r(g,{modelValue:s.PONumber,"onUpdate:modelValue":e[6]||(e[6]=l=>s.PONumber=l),label:"PO Number"},null,8,["modelValue"])]),_:1}),r(m,{cols:"12"},{default:o(()=>[s.loading2?(c(),h("div",j,G)):p("",!0),n("div",X,[r(g,{modelValue:s.searchQuery,"onUpdate:modelValue":e[7]||(e[7]=l=>s.searchQuery=l),class:"mb-3",density:"compact",variant:"solo",label:"Search","append-inner-icon":"mdi-magnify","single-line":"","hide-details":""},null,8,["modelValue"])]),r(R,{headers:s.headers,items:d.filteredSalesOrder},{default:o(()=>[n("thead",null,[n("tr",null,[(c(!0),h(b,null,V(s.headers,l=>(c(),h("th",{key:l,class:"text-center"},_(l.text),1))),128))])]),n("tbody",null,[d.filteredSalesOrder.length===0?(c(),h("tr",Z,ee)):p("",!0),(c(!0),h(b,null,V(d.filteredSalesOrder,(l,u)=>(c(),h("tr",{key:u},[n("td",te,_(l.sku_name),1),n("td",ae,_(l.brand_name),1),n("td",se,_(l.uom),1),n("td",re,_(l.hsn_code),1),n("td",le,_(l.mrp),1),n("td",oe,[r(g,{modelValue:l.quantity,"onUpdate:modelValue":f=>l.quantity=f,type:"number",min:"0",style:{"min-width":"80px"},onKeydown:d.preventDecimal,onPaste:d.preventPaste},null,8,["modelValue","onUpdate:modelValue","onKeydown","onPaste"])]),n("td",ne,[r(g,{modelValue:l.return,"onUpdate:modelValue":f=>l.return=f,type:"number",min:"0",style:{"min-width":"80px"},onKeydown:d.preventDecimal,onPaste:d.preventPaste},null,8,["modelValue","onUpdate:modelValue","onKeydown","onPaste"])]),n("td",de,[r(g,{modelValue:l.exchange,"onUpdate:modelValue":f=>l.exchange=f,type:"number",min:"0",style:{"min-width":"80px"},onKeydown:d.preventDecimal,onPaste:d.preventPaste},null,8,["modelValue","onUpdate:modelValue","onKeydown","onPaste"])])]))),128))])]),_:1},8,["headers","items"])]),_:1}),r(m,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:o(()=>[r(P,{onClick:d.validateform},{default:o(()=>[y(" Save ")]),_:1},8,["onClick"]),C(r(T,{size:50,color:"primary",indeterminate:""},null,512),[[O,t.isProgress]])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),r(E,{modelValue:s.snackbar,"onUpdate:modelValue":e[8]||(e[8]=l=>s.snackbar=l),timeout:3500,color:s.color},{default:o(()=>[y(_(s.snackbarText),1)]),_:1},8,["modelValue","color"])])}const ce=v(z,[["render",ie]]),ue={components:{Createsales:ce},data(){return{currentroute:"",activeTab:"",tabs:[{title:"Create Sales Order",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=L(),this.activeTab=U(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function me(t,e,a,i,s,d){const l=M("Createsales");return c(),h("div",null,[r(Q,{modelValue:s.activeTab,"onUpdate:modelValue":e[0]||(e[0]=u=>s.activeTab=u),"show-arrows":""},{default:o(()=>[(c(!0),h(b,null,V(s.tabs,u=>(c(),N(K,{key:u.icon,value:u.tab},{default:o(()=>[r(I,{size:"20",start:"",icon:u.icon},null,8,["icon"]),y(" "+_(u.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),r(B),r(W,{modelValue:s.activeTab,"onUpdate:modelValue":e[1]||(e[1]=u=>s.activeTab=u),class:"mt-5 disable-tab-transition",touch:!1},{default:o(()=>[r(H,{value:"account"},{default:o(()=>[r(l)]),_:1})]),_:1},8,["modelValue"])])}const ke=v(ue,[["render",me]]);export{ke as default};
