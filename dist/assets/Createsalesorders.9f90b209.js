import{_ as v,o as c,c as h,g as s,b7 as D,b8 as p,w as o,i as m,j as k,k as w,l as S,a as n,F as b,q as V,t as f,m as P,b as y,a4 as C,b9 as T,ac as O,bo as M,v as q,e as L,s as U,r as N,f as I,u as B}from"./index.42f55023.js";import{s as F}from"./Services.f692740f.js";import{V as A}from"./VForm.777a4687.js";import{V as x}from"./VAutocomplete.65639584.js";import{V as g}from"./VTextField.e1a88779.js";import{V as R}from"./VTable.d1a955dc.js";import{V as E}from"./VSnackbar.91cdaf81.js";import{V as K,a as Q,b as H,c as W}from"./VWindowItem.4c69d9f4.js";import"./VSelect.63c3a47b.js";import"./VCheckboxBtn.99960a28.js";import"./VChip.19dc4ade.js";const z={mixins:[F],data(){return{snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,selectedSalesOrder:"",Merchants:[],loading:!0,cityID:null,merchantProducts:[],searchQuery:"",loading2:!1,soData:[],selectSodata:"",soDetailsd:[],Locationids:"",useriddata:"",cityiddata:"",CreatedDate:"",today:this.getFormattedDate(new Date),merchantrules:[t=>!!t||"Merchnat is required"],sorules:[t=>!!t||"SOData is required"],dateRules:[t=>!!t||"Date is required"],userIds:"",PONumber:"",billingaddress:"",storeAddress:"",selectedDate:"",selectedDateTime:"",dateRules:[t=>!!t||"Date is required"],headers:[{text:"Product Name",value:"sku_name"},{text:"Brand Name",value:"brand_name"},{text:"UOM",value:"uom"},{text:"HSN",value:"hsn_code"},{text:"MRP",value:"mrp"},{text:"Quantity",value:"quantity"},{text:"Return",value:"return"},{text:"Exchange",value:"exchange"}]}},computed:{minDate(){const t=new Date,e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${e}-${a}-${i}`},filteredmerchantProducts(){return this.merchantProducts.filter(t=>t.quantity!==void 0)},filteredSalesOrder(){const t=this.searchQuery.toLowerCase().trim();return this.filteredmerchantProducts.filter(e=>e.brand_name&&e.brand_name.toLowerCase().includes(t)||e.hsn_code&&e.hsn_code.toLowerCase().includes(t)||e.mrp&&e.mrp.toString().toLowerCase().includes(t)||e.quantity&&e.quantity.toString().toLowerCase().includes(t)||e.uom&&e.uom.toLowerCase().includes(t)||e.total_given_margin&&e.total_given_margin.toString().toLowerCase().includes(t)||e.cgst&&e.cgst.toString().toLowerCase().includes(t)||e.sgst&&e.sgst.toString().toLowerCase().includes(t)||e.return&&e.return.toString().toLowerCase().includes(t)||e.sku_name&&e.sku_name.toLowerCase().includes(t)||e.exchange&&e.exchange.toLowerCase().includes(t))},merchantsdata(){return this.Merchants.map(t=>({value:t.merchant_id,text:t.merchant_uid}))}},mounted(){this.userIds=localStorage.getItem("userId"),this.cityID=localStorage.getItem("city_id");const t=localStorage.getItem("sodetails");if(t)try{this.soData=JSON.parse(t),this.soDetailsd=this.soData.map(e=>({value:e.entity_id,text:e.name})),Array.isArray(this.soData)||(this.soData=[])}catch(e){console.error("Error parsing sodetails from localStorage:",e),this.soData=[]}this.getMerchantdetails().then(()=>{this.loading=!1}).catch(e=>{})},watch:{selectedSalesOrder(t){this.handleBrandSelection(t),this.handlestockSelection(t)}},methods:{handlestockSelection(t){this.getStcksdata(t).then(e=>{console.log("fret",e),this.merchantProducts.forEach(a=>{const i=e.data.products.find(l=>l.merchant_product_id===a.brand_product_id);i&&(a.closing=i.closing)})})},updateDateTime(){if(this.selectedDate){const t=new Date,e=String(t.getHours()).padStart(2,"0"),a=String(t.getMinutes()).padStart(2,"0"),i=String(t.getSeconds()).padStart(2,"0");this.selectedDateTime=`${this.selectedDate} ${e}:${a}:${i}`}},getFormattedDate(t){const e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),l=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0"),r=String(t.getSeconds()).padStart(2,"0");return`${e}-${a}-${i} ${l}:${d}:${r}`},validateform(){this.$refs.purchaseOrderForm.validate().then(t=>{t.valid?this.merchantProducts.some(a=>a.quantity>0||a.return>0||a.exchange>0)?this.SaveSO():(this.snackbar=!0,this.snackbarText="Please provide quantities for quantity, return, or exchange.",this.color="on-background"):(this.snackbar=!0,this.snackbarText="Please fill all mandatory fields.",this.color="on-background")})},SaveSO(){let t=!0;if(this.merchantProducts.forEach(a=>{(a.return>a.closing||a.exchange>a.closing)&&(t=!1)}),!t){this.snackbar=!0,this.snackbarText="The return or exchange quantity for some products exceeds the closing stock. Please correct the quantities.",this.color="error";return}const e={merchant_id:this.selectedSalesOrder,user_id:this.useriddata,entity_id:this.selectSodata,city_id:this.cityiddata,location_id:this.Locationids,so_status:3,po_number:this.PONumber,created_date:this.selectedDateTime,device:"CRM-WEB",products:this.merchantProducts.map(a=>({merchant_product_id:a.brand_product_id,brand_name:a.brand_name,sku_name:a.sku_name,uom:a.uom,mrp:a.mrp,hsn_code:a.hsn_code,quantity:`${a.quantity}`,return:`${a.return}`,rtv_reason:"",exchange:`${a.exchange}`}))};console.log({postData:e}),this.saveSorder(e).then(a=>{console.log({response:a}),a.data.status==1?(this.snackbar=!0,this.snackbarText=a.data.message,this.color="primary",window.location.reload()):(this.snackbar=!0,this.snackbarText=a.data.message,this.color="on-background")})},preventDecimal(t){(t.key==="."||t.key===","||t.key==="+"||t.key==="-"||t.keyCode===189||t.keyCode===109)&&t.preventDefault()},preventPaste(t){const a=(t.clipboardData||window.clipboardData).getData("text");/^[0-9]+$/.test(a)||t.preventDefault()},handleBrandSelection(t){this.loading2=!0,this.salesMerchantProducts(t).then(e=>{console.log("check the response",e),e.data.status==1?(this.merchantProducts=e.data.merchant_product_details.products,this.billingaddress=e.data.merchant_product_details.billing_address,this.storeAddress=e.data.merchant_product_details.store_address,this.snackbar=!0,this.snackbarText=e.data.message,this.color="primary",this.loading2=!1):(this.snackbar=!0,this.snackbarText=e.data.message,this.color="primary",this.loading2=!1)})},getMerchantdetails(){return new Promise((t,e)=>{this.getMerchants(this.cityID).then(a=>{console.log("check the resp",a),this.Merchants=a.data.data,this.Locationids=this.Merchants[0].location_id,this.useriddata=this.Merchants[0].user_id,this.cityiddata=this.Merchants[0].city_id,t()}).catch(a=>{e(a)})})}}},Y={key:0,class:"loading-container"},j={key:0,id:"app"},J=n("div",{id:"loading-bg"},[n("div",{class:"loading-logo"},[n("img",{src:M,height:"60",width:"68",alt:"Logo"})]),n("div",{class:"loading"},[n("div",{class:"effect-1 effects"}),n("div",{class:"effect-2 effects"}),n("div",{class:"effect-3 effects"})])],-1),G=[J],X={style:{"max-width":"400px"}},Z={key:0},$=n("td",{colspan:"16",class:"text-center"},[n("h1",null,"No data found !")],-1),ee=[$],te={class:"text-center"},ae={class:"text-center"},se={class:"text-center"},re={class:"text-center"},le={class:"text-center"},oe={class:"text-center"},ne={class:"text-center"},de={class:"text-center"};function ie(t,e,a,i,l,d){return c(),h("div",null,[l.loading?(c(),h("div",Y,[s(D,{height:"5",color:"primary",indeterminate:"",class:"custom-loader","full-width":""})])):p("",!0),s(S,null,{default:o(()=>[s(m,{cols:"12"},{default:o(()=>[s(k,{title:"Sales Order",class:"mb-4"},{default:o(()=>[s(w,null,{default:o(()=>[s(A,{class:"mt-6",ref:"purchaseOrderForm"},{default:o(()=>[s(S,null,{default:o(()=>[s(m,{md:"6",cols:"12"},{default:o(()=>[s(x,{modelValue:l.selectedSalesOrder,"onUpdate:modelValue":e[0]||(e[0]=r=>l.selectedSalesOrder=r),label:"Merchants",items:d.merchantsdata,"item-value":"value","item-title":"text",rules:l.merchantrules,"menu-props":{maxHeight:200}},null,8,["modelValue","items","rules"])]),_:1}),s(m,{md:"6",cols:"12"},{default:o(()=>[s(x,{modelValue:l.selectSodata,"onUpdate:modelValue":e[1]||(e[1]=r=>l.selectSodata=r),label:"SO Details",items:this.soDetailsd,"item-value":"value","item-title":"text",rules:l.sorules,"menu-props":{maxHeight:200}},null,8,["modelValue","items","rules"])]),_:1}),s(m,{cols:"12",md:"6"},{default:o(()=>[s(g,{modelValue:l.selectedDate,"onUpdate:modelValue":e[2]||(e[2]=r=>l.selectedDate=r),type:"date",label:"So Created Date",onInput:d.updateDateTime,rules:l.dateRules,min:d.minDate},null,8,["modelValue","onInput","rules","min"])]),_:1}),s(m,{cols:"12",md:"6"},{default:o(()=>[s(g,{modelValue:l.selectedDateTime,"onUpdate:modelValue":e[3]||(e[3]=r=>l.selectedDateTime=r),label:"So Created Date and Time",readonly:""},null,8,["modelValue"])]),_:1}),s(m,{cols:"12",md:"6"},{default:o(()=>[s(g,{modelValue:l.billingaddress,"onUpdate:modelValue":e[4]||(e[4]=r=>l.billingaddress=r),label:"Billing Address",readonly:""},null,8,["modelValue"])]),_:1}),s(m,{cols:"12",md:"6"},{default:o(()=>[s(g,{modelValue:l.storeAddress,"onUpdate:modelValue":e[5]||(e[5]=r=>l.storeAddress=r),label:"Store Address",readonly:""},null,8,["modelValue"])]),_:1}),s(m,{cols:"12",md:"6"},{default:o(()=>[s(g,{modelValue:this.PONumber,"onUpdate:modelValue":e[6]||(e[6]=r=>this.PONumber=r),label:"PO Number"},null,8,["modelValue"])]),_:1}),s(m,{cols:"12"},{default:o(()=>[l.loading2?(c(),h("div",j,G)):p("",!0),n("div",X,[s(g,{class:"mb-3",modelValue:l.searchQuery,"onUpdate:modelValue":e[7]||(e[7]=r=>l.searchQuery=r),density:"compact",variant:"solo",label:"Search","append-inner-icon":"mdi-magnify","single-line":"","hide-details":""},null,8,["modelValue"])]),s(R,{headers:l.headers,items:d.filteredSalesOrder},{default:o(()=>[n("thead",null,[n("tr",null,[(c(!0),h(b,null,V(l.headers,r=>(c(),h("th",{class:"text-center",key:r},f(r.text),1))),128))])]),n("tbody",null,[d.filteredSalesOrder.length===0?(c(),h("tr",Z,ee)):p("",!0),(c(!0),h(b,null,V(d.filteredSalesOrder,(r,u)=>(c(),h("tr",{key:u},[n("td",te,f(r.sku_name),1),n("td",ae,f(r.brand_name),1),n("td",se,f(r.uom),1),n("td",re,f(r.hsn_code),1),n("td",le,f(r.mrp),1),n("td",oe,[s(g,{onKeydown:d.preventDecimal,onPaste:d.preventPaste,modelValue:r.quantity,"onUpdate:modelValue":_=>r.quantity=_,type:"number",min:"0",style:{"min-width":"80px"}},null,8,["onKeydown","onPaste","modelValue","onUpdate:modelValue"])]),n("td",ne,[s(g,{onKeydown:d.preventDecimal,onPaste:d.preventPaste,modelValue:r.return,"onUpdate:modelValue":_=>r.return=_,type:"number",min:"0",style:{"min-width":"80px"}},null,8,["onKeydown","onPaste","modelValue","onUpdate:modelValue"])]),n("td",de,[s(g,{onKeydown:d.preventDecimal,onPaste:d.preventPaste,modelValue:r.exchange,"onUpdate:modelValue":_=>r.exchange=_,type:"number",min:"0",style:{"min-width":"80px"}},null,8,["onKeydown","onPaste","modelValue","onUpdate:modelValue"])])]))),128))])]),_:1},8,["headers","items"])]),_:1}),s(m,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:o(()=>[s(P,{onClick:d.validateform},{default:o(()=>[y("Save")]),_:1},8,["onClick"]),C(s(T,{size:50,color:"primary",indeterminate:""},null,512),[[O,t.isProgress]])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),s(E,{modelValue:l.snackbar,"onUpdate:modelValue":e[8]||(e[8]=r=>l.snackbar=r),timeout:3500,color:l.color},{default:o(()=>[y(f(l.snackbarText),1)]),_:1},8,["modelValue","color"])])}const ce=v(z,[["render",ie]]),ue={components:{Createsales:ce},data(){return{currentroute:"",activeTab:"",tabs:[{title:"Create Sales Order",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=q(),this.activeTab=L(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function me(t,e,a,i,l,d){const r=N("Createsales");return c(),h("div",null,[s(K,{modelValue:l.activeTab,"onUpdate:modelValue":e[0]||(e[0]=u=>l.activeTab=u),"show-arrows":""},{default:o(()=>[(c(!0),h(b,null,V(l.tabs,u=>(c(),I(W,{key:u.icon,value:u.tab},{default:o(()=>[s(B,{size:"20",start:"",icon:u.icon},null,8,["icon"]),y(" "+f(u.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),s(U),s(H,{modelValue:l.activeTab,"onUpdate:modelValue":e[1]||(e[1]=u=>l.activeTab=u),class:"mt-5 disable-tab-transition",touch:!1},{default:o(()=>[s(Q,{value:"account"},{default:o(()=>[s(r)]),_:1})]),_:1},8,["modelValue"])])}const De=v(ue,[["render",me]]);export{De as default};
