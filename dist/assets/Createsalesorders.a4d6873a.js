import{_ as v,o as c,c as h,g as r,b7 as D,b8 as p,w as n,i as g,j as k,k as w,l as V,a as l,F as y,q as b,t as m,m as C,b as S,a4 as P,b9 as T,ac as M,bo as O,v as q,e as L,s as U,r as I,f as F,u as B}from"./index.86ec6d93.js";import{s as N}from"./Services.48d37ae5.js";import{V as R}from"./VForm.bac64f8a.js";import{V as x}from"./VAutocomplete.ddfb404e.js";import{V as f}from"./VTextField.91fbfc91.js";import{V as E}from"./VTable.5dce5bbd.js";import{V as K}from"./VSnackbar.ed5b3df0.js";import{V as Q,a as H,b as A,c as W}from"./VWindowItem.e3a45e3d.js";import"./VSelect.2808f033.js";import"./VCheckboxBtn.e014f252.js";import"./VChip.197e942a.js";const z={mixins:[N],data(){return{snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,selectedSalesOrder:"",Merchants:[],loading:!0,cityID:null,merchantProducts:[],searchQuery:"",loading2:!1,soData:[],selectSodata:"",soDetailsd:[],Locationids:"",useriddata:"",cityiddata:"",CreatedDate:"",today:this.getFormattedDate(new Date),merchantrules:[e=>!!e||"Merchnat is required"],sorules:[e=>!!e||"SOData is required"],dateRules:[e=>!!e||"Date is required"],userIds:"",selectedDate:"",selectedDateTime:"",dateRules:[e=>!!e||"Date is required"],headers:[{text:"Product Name",value:"sku_name"},{text:"Brand Name",value:"brand_name"},{text:"UOM",value:"uom"},{text:"HSN",value:"hsn_code"},{text:"MRP",value:"mrp"},{text:"Quantity",value:"quantity"},{text:"Return",value:"return"},{text:"Exchange",value:"exchange"}]}},computed:{minDate(){const e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),d=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${d}`},filteredmerchantProducts(){return this.merchantProducts.filter(e=>e.quantity!==void 0)},filteredSalesOrder(){const e=this.searchQuery.toLowerCase().trim();return this.filteredmerchantProducts.filter(t=>t.brand_name&&t.brand_name.toLowerCase().includes(e)||t.hsn_code&&t.hsn_code.toLowerCase().includes(e)||t.mrp&&t.mrp.toString().toLowerCase().includes(e)||t.quantity&&t.quantity.toString().toLowerCase().includes(e)||t.uom&&t.uom.toLowerCase().includes(e)||t.total_given_margin&&t.total_given_margin.toString().toLowerCase().includes(e)||t.cgst&&t.cgst.toString().toLowerCase().includes(e)||t.sgst&&t.sgst.toString().toLowerCase().includes(e)||t.return&&t.return.toString().toLowerCase().includes(e)||t.sku_name&&t.sku_name.toLowerCase().includes(e)||t.exchange&&t.exchange.toLowerCase().includes(e))},merchantsdata(){return this.Merchants.map(e=>({value:e.merchant_id,text:e.merchant_uid}))}},mounted(){this.userIds=localStorage.getItem("userId"),this.cityID=localStorage.getItem("city_id");const e=localStorage.getItem("sodetails");if(e)try{this.soData=JSON.parse(e),this.soDetailsd=this.soData.map(t=>({value:t.entity_id,text:t.name})),Array.isArray(this.soData)||(this.soData=[])}catch(t){console.error("Error parsing sodetails from localStorage:",t),this.soData=[]}this.getMerchantdetails().then(()=>{this.loading=!1}).catch(t=>{})},watch:{selectedSalesOrder(e){this.handleBrandSelection(e),this.handlestockSelection(e)}},methods:{handlestockSelection(e){this.getStcksdata(e).then(t=>{console.log("fret",t),this.merchantProducts.forEach(a=>{const d=t.data.products.find(s=>s.merchant_product_id===a.brand_product_id);d&&(a.closing=d.closing)})})},updateDateTime(){if(this.selectedDate){const e=new Date,t=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0"),d=String(e.getSeconds()).padStart(2,"0");this.selectedDateTime=`${this.selectedDate} ${t}:${a}:${d}`}},getFormattedDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),d=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0"),o=String(e.getSeconds()).padStart(2,"0");return`${t}-${a}-${d} ${s}:${i}:${o}`},validateform(){this.$refs.purchaseOrderForm.validate().then(e=>{e.valid?this.merchantProducts.some(a=>a.quantity>0||a.return>0||a.exchange>0)?this.SaveSO():(this.snackbar=!0,this.snackbarText="Please provide quantities for quantity, return, or exchange.",this.color="on-background"):(this.snackbar=!0,this.snackbarText="Please fill all mandatory fields.",this.color="on-background")})},SaveSO(){let e=!0;if(this.merchantProducts.forEach(a=>{(a.return>a.closing||a.exchange>a.closing)&&(e=!1)}),!e){this.snackbar=!0,this.snackbarText="The return or exchange quantity for some products exceeds the closing stock. Please correct the quantities.",this.color="error";return}const t={merchant_id:this.selectedSalesOrder,user_id:this.useriddata,entity_id:this.selectSodata,city_id:this.cityiddata,location_id:this.Locationids,so_status:3,created_date:this.selectedDateTime,device:"CRM-WEB",products:this.merchantProducts.map(a=>({merchant_product_id:a.brand_product_id,brand_name:a.brand_name,sku_name:a.sku_name,uom:a.uom,mrp:a.mrp,hsn_code:a.hsn_code,quantity:`${a.quantity}`,return:`${a.return}`,rtv_reason:"",exchange:`${a.exchange}`}))};console.log({postData:t}),this.saveSorder(t).then(a=>{console.log({response:a}),a.data.status==1?(this.snackbar=!0,this.snackbarText=a.data.message,this.color="primary"):(this.snackbar=!0,this.snackbarText=a.data.message,this.color="on-background")})},preventDecimal(e){(e.key==="."||e.key===","||e.key==="+"||e.key==="-"||e.keyCode===189||e.keyCode===109)&&e.preventDefault()},preventPaste(e){const a=(e.clipboardData||window.clipboardData).getData("text");/^[0-9]+$/.test(a)||e.preventDefault()},handleBrandSelection(e){this.loading2=!0,this.salesMerchantProducts(e).then(t=>{console.log("check the response",t),t.data.status==1?(this.merchantProducts=t.data.merchant_product_details.products,this.snackbar=!0,this.snackbarText=t.data.message,this.color="primary",this.loading2=!1):(this.snackbar=!0,this.snackbarText=t.data.message,this.color="primary",this.loading2=!1)})},getMerchantdetails(){return new Promise((e,t)=>{this.getMerchants(this.cityID).then(a=>{console.log("check the resp",a),this.Merchants=a.data.data,this.Locationids=this.Merchants[0].location_id,this.useriddata=this.Merchants[0].user_id,this.cityiddata=this.Merchants[0].city_id,e()}).catch(a=>{t(a)})})}}},Y={key:0,class:"loading-container"},j={key:0,id:"app"},J=l("div",{id:"loading-bg"},[l("div",{class:"loading-logo"},[l("img",{src:O,height:"60",width:"68",alt:"Logo"})]),l("div",{class:"loading"},[l("div",{class:"effect-1 effects"}),l("div",{class:"effect-2 effects"}),l("div",{class:"effect-3 effects"})])],-1),G=[J],X={style:{"max-width":"400px"}},Z={key:0},$=l("td",{colspan:"16",class:"text-center"},[l("h1",null,"No data found !")],-1),ee=[$],te={class:"text-center"},ae={class:"text-center"},se={class:"text-center"},re={class:"text-center"},oe={class:"text-center"},le={class:"text-center"},ne={class:"text-center"},ie={class:"text-center"};function de(e,t,a,d,s,i){return c(),h("div",null,[s.loading?(c(),h("div",Y,[r(D,{height:"5",color:"primary",indeterminate:"",class:"custom-loader","full-width":""})])):p("",!0),r(V,null,{default:n(()=>[r(g,{cols:"12"},{default:n(()=>[r(k,{title:"Sales Order",class:"mb-4"},{default:n(()=>[r(w,null,{default:n(()=>[r(R,{class:"mt-6",ref:"purchaseOrderForm"},{default:n(()=>[r(V,null,{default:n(()=>[r(g,{md:"6",cols:"12"},{default:n(()=>[r(x,{modelValue:s.selectedSalesOrder,"onUpdate:modelValue":t[0]||(t[0]=o=>s.selectedSalesOrder=o),label:"Merchants",items:i.merchantsdata,"item-value":"value","item-title":"text",rules:s.merchantrules,"menu-props":{maxHeight:200}},null,8,["modelValue","items","rules"])]),_:1}),r(g,{md:"6",cols:"12"},{default:n(()=>[r(x,{modelValue:s.selectSodata,"onUpdate:modelValue":t[1]||(t[1]=o=>s.selectSodata=o),label:"SO Details",items:this.soDetailsd,"item-value":"value","item-title":"text",rules:s.sorules,"menu-props":{maxHeight:200}},null,8,["modelValue","items","rules"])]),_:1}),r(g,{cols:"12",md:"6"},{default:n(()=>[r(f,{modelValue:s.selectedDate,"onUpdate:modelValue":t[2]||(t[2]=o=>s.selectedDate=o),type:"date",label:"Select Date",onInput:i.updateDateTime,rules:s.dateRules,min:i.minDate},null,8,["modelValue","onInput","rules","min"])]),_:1}),r(g,{cols:"12",md:"6"},{default:n(()=>[r(f,{modelValue:s.selectedDateTime,"onUpdate:modelValue":t[3]||(t[3]=o=>s.selectedDateTime=o),label:"Selected Date and Time",readonly:""},null,8,["modelValue"])]),_:1}),r(g,{cols:"12"},{default:n(()=>[s.loading2?(c(),h("div",j,G)):p("",!0),l("div",X,[r(f,{class:"mb-3",modelValue:s.searchQuery,"onUpdate:modelValue":t[4]||(t[4]=o=>s.searchQuery=o),density:"compact",variant:"solo",label:"Search","append-inner-icon":"mdi-magnify","single-line":"","hide-details":""},null,8,["modelValue"])]),r(E,{headers:s.headers,items:i.filteredSalesOrder},{default:n(()=>[l("thead",null,[l("tr",null,[(c(!0),h(y,null,b(s.headers,o=>(c(),h("th",{class:"text-center",key:o},m(o.text),1))),128))])]),l("tbody",null,[i.filteredSalesOrder.length===0?(c(),h("tr",Z,ee)):p("",!0),(c(!0),h(y,null,b(i.filteredSalesOrder,(o,u)=>(c(),h("tr",{key:u},[l("td",te,m(o.sku_name),1),l("td",ae,m(o.brand_name),1),l("td",se,m(o.uom),1),l("td",re,m(o.hsn_code),1),l("td",oe,m(o.mrp),1),l("td",le,[r(f,{onKeydown:i.preventDecimal,onPaste:i.preventPaste,modelValue:o.quantity,"onUpdate:modelValue":_=>o.quantity=_,type:"number",min:"0",style:{"min-width":"80px"}},null,8,["onKeydown","onPaste","modelValue","onUpdate:modelValue"])]),l("td",ne,[r(f,{onKeydown:i.preventDecimal,onPaste:i.preventPaste,modelValue:o.return,"onUpdate:modelValue":_=>o.return=_,type:"number",min:"0",style:{"min-width":"80px"}},null,8,["onKeydown","onPaste","modelValue","onUpdate:modelValue"])]),l("td",ie,[r(f,{onKeydown:i.preventDecimal,onPaste:i.preventPaste,modelValue:o.exchange,"onUpdate:modelValue":_=>o.exchange=_,type:"number",min:"0",style:{"min-width":"80px"}},null,8,["onKeydown","onPaste","modelValue","onUpdate:modelValue"])])]))),128))])]),_:1},8,["headers","items"])]),_:1}),r(g,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:n(()=>[r(C,{onClick:i.validateform},{default:n(()=>[S("Save")]),_:1},8,["onClick"]),P(r(T,{size:50,color:"primary",indeterminate:""},null,512),[[M,e.isProgress]])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),r(K,{modelValue:s.snackbar,"onUpdate:modelValue":t[5]||(t[5]=o=>s.snackbar=o),timeout:3500,color:s.color},{default:n(()=>[S(m(s.snackbarText),1)]),_:1},8,["modelValue","color"])])}const ce=v(z,[["render",de]]),ue={components:{Createsales:ce},data(){return{currentroute:"",activeTab:"",tabs:[{title:"Create Sales Order",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=q(),this.activeTab=L(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function he(e,t,a,d,s,i){const o=I("Createsales");return c(),h("div",null,[r(Q,{modelValue:s.activeTab,"onUpdate:modelValue":t[0]||(t[0]=u=>s.activeTab=u),"show-arrows":""},{default:n(()=>[(c(!0),h(y,null,b(s.tabs,u=>(c(),F(W,{key:u.icon,value:u.tab},{default:n(()=>[r(B,{size:"20",start:"",icon:u.icon},null,8,["icon"]),S(" "+m(u.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),r(U),r(A,{modelValue:s.activeTab,"onUpdate:modelValue":t[1]||(t[1]=u=>s.activeTab=u),class:"mt-5 disable-tab-transition",touch:!1},{default:n(()=>[r(H,{value:"account"},{default:n(()=>[r(o)]),_:1})]),_:1},8,["modelValue"])])}const De=v(ue,[["render",he]]);export{De as default};
