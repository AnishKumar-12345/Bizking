import{_ as V,o as m,c as p,g as s,w as i,i as l,j as g,k as S,l as v,a as c,F as b,q as f,t as k,b8 as x,m as q,b as y,a5 as D,b9 as I,ac as T,v as F,e as P,r as w,f as U,u as R,s as C}from"./index.08705643.js";import{s as N}from"./Services.f9e4372b.js";import{V as Q}from"./VForm.eec84c64.js";import{V as u}from"./VTextField.0584a3e6.js";import{V as O}from"./VTable.eda8fa83.js";import{V as E}from"./VSnackbar.89c018e7.js";import{V as M,a as B,b as K,c as z}from"./VWindowItem.2d182e11.js";import"./VCounter.d136124c.js";const A={mixins:[N],props:["po_id"],data(){return{receivedquantity:[t=>t===0||!!t&&`${t}`.trim()!==""||"Received Quantity Is Required"],rtm1:[t=>t===0||!!t&&`${t}`.trim()!==""||"Rtm Quantity Is Required"],snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,isProgress:!1,InvoiceNo:[t=>!!t||"Invoice Number is required"],invoicefile:[t=>!!t||"Invoice File is required"],today:this.getFormattedDate(new Date),inputStock:{brand_id:"",stock_updated_date:this.getFormattedDate(new Date),received_quantity:"",po_status:"",po_id:"",remarks:"",rtm:"",invoice_number:"",delivery_challan_file:"",invoice_file:"",products:[{brand_id:"",brand_product_id:"",received_quantity:"",rtm:"",remarks:""}]},PoId:"",InputStockDetails:[],selectedPurchaseOrder:null,dialog:!1,headers:[{text:"Product Name",value:"brand_name"},{text:"UOM",value:"uom"},{text:"Ordered Quantity",value:"quantity"},{text:"Received Quantity",value:"quantity"},{text:"RTM",value:"carbs"},{text:"Remarks",value:"protein"}]}},computed:{filteredDesserts(){return this.selectedPurchaseOrder,this.desserts.filter(t=>t.purchaseOrder===this.selectedPurchaseOrder)}},mounted(){this.PoId=this.$route.query.po_id,this.getInputstockdetails()},methods:{handleFileUpload(t,a){const _=a.target.files[0],e=new FileReader;e.onload=()=>{const r=e.result.split(",")[1];t==="invoiceFile"?this.inputStock.invoice_file=r:t==="regularFile"&&(this.inputStock.delivery_challan_file=r)},e.readAsDataURL(_)},isrtmQuantityExceeded(t,a,d){d>a&&(this.snackbar=!0,this.color="on-background",this.snackbarText="RTM quantity cannot exceed item quantity.")},isQuantityExceeded(t,a){t>a&&(this.snackbar=!0,this.color="on-background",this.snackbarText="Received quantity cannot exceed item quantity.")},preventPaste(t){const d=(t.clipboardData||window.clipboardData).getData("text");/^[0-9]+$/.test(d)||t.preventDefault()},preventDecimal(t){(t.key==="."||t.key===","||t.key==="+"||t.key==="-"||t.keyCode===189||t.keyCode===109)&&t.preventDefault()},validateForm(){this.$refs.purchaseOrderForm.validate().then(t=>{t.valid==!0?this.saveInputstock():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="on-background")})},saveInputstock(){this.isProgress=!0;const t={Draft:1,Created:2,Shared:3,Acknowledged:4,Received:5},a={brand_name:this.inputStock.brand_name,po_number:this.inputStock.po_number,brand_id:this.inputStock.brand_id,stock_updated_date:this.inputStock.stock_updated_date,recieved_date:this.inputStock.stock_updated_date,po_id:this.inputStock.po_id,po_status:t[this.inputStock.po_status],delivery_challan_file:this.inputStock.delivery_challan_file,invoice_file:this.inputStock.invoice_file,invoice_number:this.inputStock.invoice_number,products:this.inputStockproducts.map((e,r)=>({brand_product_id:e.brand_product_id,received_quantity:`${e.received_quantity}`,rtm:`${e.rtm}`,sku_name:e.sku_name,remarks:e.remarks,quantity:e.quantity,hsn_code:e.hsn_code,mrp:e.mrp,uom:e.uom,price_per_unit:e.price_per_unit,taxable_amount:e.taxable_amount,csgt:e.csgt,sgst:e.sgst,amount:e.amount,sgst_percentage:e.sgst_percentage,cgst_percentage:e.cgst_percentage,total_give_margin:e.total_give_margin}))};if(!a.products.some(e=>e.received_quantity>0||e.rtm>0)){this.snackbar=!0,this.color="on-background",this.snackbarText="Received Quantity or RTM must be greater than 0 for at least one product.";return}a.products.filter(e=>{const r=Number(e.received_quantity)+Number(e.rtm);return this.isQuantityExceeded(e.received_quantity,e.quantity)||e.received_quantity===0&&e.rtm>e.quantity||e.received_quantity===e.quantity&&e.rtm>e.quantity||r>e.quantity}).length===0?this.PostInputstock(a).then(e=>{e.status==1?(this.snackbar=!0,this.color="primary",this.formData={},this.snackbarText=e.message,this.isProgress=!1,setTimeout(()=>{this.$router.push({name:"Viewpurchasehistory"})},2e3)):(this.isProgress=!1,this.snackbar=!0,this.color="on-background")}):(this.snackbar=!0,this.color="on-background",this.snackbarText="your quantities are exceeded")},getFormattedDate(t){const a=t.getFullYear(),d=String(t.getMonth()+1).padStart(2,"0"),_=String(t.getDate()).padStart(2,"0");return`${a}-${d}-${_}`},getInputstockdetails(){this.getInputstock(this.PoId).then(t=>{this.InputStockDetails=t.data,this.InputStockDetails.forEach(a=>{this.inputStock.brand_id=a.brand_id,this.inputStock.po_id=a.po_id,this.inputStock.po_number=a.po_number,this.inputStock.brand_name=a.brand_name,this.inputStock.po_status="Received",this.inputStockproducts=a.products,this.inputStock.received_quantity=a.received_quantity,this.inputStock.remarks=a.remarks,this.inputStock.rtm=a.rtm})})}}},L={class:"text-center"},W={class:"text-center"},Z={class:"text-center"},j={class:"text-center"},Y={key:0},G={class:"text-center"},H={class:"text-center"};function J(t,a,d,_,e,r){return m(),p("div",null,[s(v,null,{default:i(()=>[s(l,{cols:"12"},{default:i(()=>[s(g,{title:"Input Stock",class:"mb-4"},{default:i(()=>[s(S,null,{default:i(()=>[s(Q,{ref:"purchaseOrderForm",class:"mt-6"},{default:i(()=>[s(v,null,{default:i(()=>[s(l,{md:"6",cols:"12"},{default:i(()=>[s(u,{modelValue:e.inputStock.po_number,"onUpdate:modelValue":a[0]||(a[0]=n=>e.inputStock.po_number=n),label:"Purchase Order",readonly:""},null,8,["modelValue"])]),_:1}),s(l,{cols:"12",md:"6"},{default:i(()=>[s(u,{modelValue:e.inputStock.brand_name,"onUpdate:modelValue":a[1]||(a[1]=n=>e.inputStock.brand_name=n),label:"Order To",readonly:""},null,8,["modelValue"])]),_:1}),s(l,{cols:"12",md:"6"},{default:i(()=>[s(u,{modelValue:e.inputStock.stock_updated_date,"onUpdate:modelValue":a[2]||(a[2]=n=>e.inputStock.stock_updated_date=n),type:"date",label:"Date",min:e.today,rules:t.dateRules,readonly:""},null,8,["modelValue","min","rules"])]),_:1}),s(l,{md:"6",cols:"12"},{default:i(()=>[s(u,{modelValue:e.inputStock.po_status,"onUpdate:modelValue":a[3]||(a[3]=n=>e.inputStock.po_status=n),label:"PO Status",readonly:""},null,8,["modelValue"])]),_:1}),s(l,{md:"6",cols:"12"},{default:i(()=>[s(u,{modelValue:e.inputStock.invoice_number,"onUpdate:modelValue":a[4]||(a[4]=n=>e.inputStock.invoice_number=n),label:"Invoice No",rules:e.InvoiceNo},null,8,["modelValue","rules"])]),_:1}),s(l,{md:"6",cols:"12"},{default:i(()=>[s(u,{label:"Invoice File",type:"file",rules:e.invoicefile,onChange:a[5]||(a[5]=n=>r.handleFileUpload("invoiceFile",n))},null,8,["rules"])]),_:1}),s(l,{md:"6",cols:"12"},{default:i(()=>[s(u,{label:"DC File",type:"file",onChange:a[6]||(a[6]=n=>r.handleFileUpload("regularFile",n))})]),_:1}),s(l,{cols:"12"},{default:i(()=>[s(O,{headers:e.headers,items:e.InputStockDetails},{default:i(()=>[c("thead",null,[c("tr",null,[(m(!0),p(b,null,f(e.headers,n=>(m(),p("th",{key:n,class:"text-center"},k(n.text),1))),128))])]),c("tbody",null,[(m(!0),p(b,null,f(t.inputStockproducts,(n,o)=>(m(),p("tr",{key:o},[c("td",L,k(n.sku_name),1),c("td",W,k(n.uom),1),c("td",Z,k(n.quantity),1),c("td",j,[s(u,{modelValue:n.received_quantity,"onUpdate:modelValue":h=>n.received_quantity=h,outlined:"",dense:"",type:"number",min:"0",max:n.quantity,rules:e.receivedquantity,onKeydown:r.preventDecimal,onPaste:r.preventPaste},null,8,["modelValue","onUpdate:modelValue","max","rules","onKeydown","onPaste"]),r.isQuantityExceeded(n.received_quantity,n.quantity)?(m(),p("span",Y)):x("",!0)]),c("td",G,[s(u,{modelValue:n.rtm,"onUpdate:modelValue":h=>n.rtm=h,type:"number",min:"0",max:"20000",outlined:"",dense:"",rules:e.rtm1,onKeydown:r.preventDecimal,onPaste:r.preventPaste},null,8,["modelValue","onUpdate:modelValue","rules","onKeydown","onPaste"])]),c("td",H,[s(u,{modelValue:n.remarks,"onUpdate:modelValue":h=>n.remarks=h,outlined:"",dense:"",required:""},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])]),_:1},8,["headers","items"])]),_:1}),s(l,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:i(()=>[s(q,{onClick:r.validateForm},{default:i(()=>[y(" Save ")]),_:1},8,["onClick"]),D(s(I,{size:50,color:"primary",indeterminate:""},null,512),[[T,e.isProgress]])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),s(E,{modelValue:e.snackbar,"onUpdate:modelValue":a[7]||(a[7]=n=>e.snackbar=n),timeout:3e3,color:e.color},{default:i(()=>[y(k(e.snackbarText),1)]),_:1},8,["modelValue","color"])])}const X=V(A,[["render",J]]),$={components:{Inputstock:X},data(){return{currentroute:"",activeTab:"",tabs:[{title:"Create Input Stock",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=F(),this.activeTab=P(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function ee(t,a,d,_,e,r){const n=w("Inputstock");return m(),p("div",null,[s(B,{modelValue:e.activeTab,"onUpdate:modelValue":a[0]||(a[0]=o=>e.activeTab=o),"show-arrows":""},{default:i(()=>[(m(!0),p(b,null,f(e.tabs,o=>(m(),U(M,{key:o.icon,value:o.tab},{default:i(()=>[s(R,{size:"20",start:"",icon:o.icon},null,8,["icon"]),y(" "+k(o.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),s(C),s(z,{modelValue:e.activeTab,"onUpdate:modelValue":a[1]||(a[1]=o=>e.activeTab=o),class:"mt-5 disable-tab-transition",touch:!1},{default:i(()=>[s(K,{value:"account"},{default:i(()=>[s(n)]),_:1})]),_:1},8,["modelValue"])])}const ue=V($,[["render",ee]]);export{ue as default};
