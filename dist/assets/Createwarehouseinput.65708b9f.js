import{_ as V,o as m,c as p,g as s,w as n,i as l,j as g,k as S,l as v,a as c,F as b,q as f,t as h,b8 as x,m as q,b as y,a4 as D,b9 as I,ac as T,v as F,e as P,s as w,r as U,f as R,u as C}from"./index.871767d0.js";import{s as N}from"./Services.d06bbe8b.js";import{V as Q}from"./VForm.33d3da31.js";import{V as u}from"./VTextField.aaf29b18.js";import{V as O}from"./VTable.cd435fce.js";import{V as E}from"./VSnackbar.2c6d9b4a.js";import{V as M,a as B,b as K,c as z}from"./VWindowItem.db87fc1a.js";const A={mixins:[N],props:["po_id"],data(){return{receivedquantity:[a=>a===0||!!a&&`${a}`.trim()!==""||"Received Quantity Is Required"],rtm1:[a=>a===0||!!a&&`${a}`.trim()!==""||"Rtm Quantity Is Required"],snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,isProgress:!1,InvoiceNo:[a=>!!a||"Invoice Number is required"],invoicefile:[a=>!!a||"Invoice File is required"],today:this.getFormattedDate(new Date),inputStock:{brand_id:"",stock_updated_date:this.getFormattedDate(new Date),received_quantity:"",po_status:"",po_id:"",remarks:"",rtm:"",invoice_number:"",delivery_challan_file:"",invoice_file:"",products:[{brand_id:"",brand_product_id:"",received_quantity:"",rtm:"",remarks:""}]},PoId:"",InputStockDetails:[],selectedPurchaseOrder:null,dialog:!1,headers:[{text:"Product Name",value:"brand_name"},{text:"UOM",value:"uom"},{text:"Ordered Quantity",value:"quantity"},{text:"Received Quantity",value:"quantity"},{text:"RTM",value:"carbs"},{text:"Remarks",value:"protein"}]}},computed:{filteredDesserts(){return this.selectedPurchaseOrder,this.desserts.filter(a=>a.purchaseOrder===this.selectedPurchaseOrder)}},mounted(){this.PoId=this.$route.query.po_id,this.getInputstockdetails()},methods:{handleFileUpload(a,t){const _=t.target.files[0],e=new FileReader;e.onload=()=>{const r=e.result.split(",")[1];a==="invoiceFile"?this.inputStock.invoice_file=r:a==="regularFile"&&(this.inputStock.delivery_challan_file=r)},e.readAsDataURL(_)},isrtmQuantityExceeded(a,t,d){d>t&&(this.snackbar=!0,this.color="on-background",this.snackbarText="RTM quantity cannot exceed item quantity.")},isQuantityExceeded(a,t){a>t&&(this.snackbar=!0,this.color="on-background",this.snackbarText="Received quantity cannot exceed item quantity.")},preventPaste(a){const d=(a.clipboardData||window.clipboardData).getData("text");/^[0-9]+$/.test(d)||a.preventDefault()},preventDecimal(a){(a.key==="."||a.key===","||a.key==="+"||a.key==="-"||a.keyCode===189||a.keyCode===109)&&a.preventDefault()},validateForm(){this.$refs.purchaseOrderForm.validate().then(a=>{a.valid==!0?this.saveInputstock():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="on-background")})},saveInputstock(){this.isProgress=!0;const a={Draft:1,Created:2,Shared:3,Acknowledged:4,Received:5},t={brand_name:this.inputStock.brand_name,po_number:this.inputStock.po_number,brand_id:this.inputStock.brand_id,stock_updated_date:this.inputStock.stock_updated_date,recieved_date:this.inputStock.stock_updated_date,po_id:this.inputStock.po_id,po_status:a[this.inputStock.po_status],delivery_challan_file:this.inputStock.delivery_challan_file,invoice_file:this.inputStock.invoice_file,invoice_number:this.inputStock.invoice_number,products:this.inputStockproducts.map((e,r)=>({brand_product_id:e.brand_product_id,received_quantity:`${e.received_quantity}`,rtm:`${e.rtm}`,sku_name:e.sku_name,remarks:e.remarks,quantity:e.quantity,hsn_code:e.hsn_code,mrp:e.mrp,uom:e.uom,price_per_unit:e.price_per_unit,taxable_amount:e.taxable_amount,csgt:e.csgt,sgst:e.sgst,amount:e.amount,sgst_percentage:e.sgst_percentage,cgst_percentage:e.cgst_percentage,total_give_margin:e.total_give_margin}))};if(!t.products.some(e=>e.received_quantity>0||e.rtm>0)){this.snackbar=!0,this.color="on-background",this.snackbarText="Received Quantity or RTM must be greater than 0 for at least one product.";return}t.products.filter(e=>{const r=Number(e.received_quantity)+Number(e.rtm);return this.isQuantityExceeded(e.received_quantity,e.quantity)||e.received_quantity===0&&e.rtm>e.quantity||e.received_quantity===e.quantity&&e.rtm>e.quantity||r>e.quantity}).length===0?this.PostInputstock(t).then(e=>{e.status==1?(this.snackbar=!0,this.color="primary",this.formData={},this.snackbarText=e.message,this.isProgress=!1,setTimeout(()=>{this.$router.push({name:"Viewpurchasehistory"})},2e3)):(this.isProgress=!1,this.snackbar=!0,this.color="on-background")}):(this.snackbar=!0,this.color="on-background",this.snackbarText="your quantities are exceeded")},getFormattedDate(a){const t=a.getFullYear(),d=String(a.getMonth()+1).padStart(2,"0"),_=String(a.getDate()).padStart(2,"0");return`${t}-${d}-${_}`},getInputstockdetails(){this.getInputstock(this.PoId).then(a=>{this.InputStockDetails=a.data,this.InputStockDetails.forEach(t=>{this.inputStock.brand_id=t.brand_id,this.inputStock.po_id=t.po_id,this.inputStock.po_number=t.po_number,this.inputStock.brand_name=t.brand_name,this.inputStock.po_status="Received",this.inputStockproducts=t.products,this.inputStock.received_quantity=t.received_quantity,this.inputStock.remarks=t.remarks,this.inputStock.rtm=t.rtm})})}}},L={class:"text-center"},W={class:"text-center"},Z={class:"text-center"},j={class:"text-center"},Y={key:0},G={class:"text-center"},H={class:"text-center"};function J(a,t,d,_,e,r){return m(),p("div",null,[s(v,null,{default:n(()=>[s(l,{cols:"12"},{default:n(()=>[s(g,{title:"Input Stock",class:"mb-4"},{default:n(()=>[s(S,null,{default:n(()=>[s(Q,{class:"mt-6",ref:"purchaseOrderForm"},{default:n(()=>[s(v,null,{default:n(()=>[s(l,{md:"6",cols:"12"},{default:n(()=>[s(u,{modelValue:this.inputStock.po_number,"onUpdate:modelValue":t[0]||(t[0]=i=>this.inputStock.po_number=i),label:"Purchase Order",readonly:""},null,8,["modelValue"])]),_:1}),s(l,{cols:"12",md:"6"},{default:n(()=>[s(u,{modelValue:this.inputStock.brand_name,"onUpdate:modelValue":t[1]||(t[1]=i=>this.inputStock.brand_name=i),label:"Order To",readonly:""},null,8,["modelValue"])]),_:1}),s(l,{cols:"12",md:"6"},{default:n(()=>[s(u,{modelValue:this.inputStock.stock_updated_date,"onUpdate:modelValue":t[2]||(t[2]=i=>this.inputStock.stock_updated_date=i),type:"date",label:"Date",min:e.today,rules:a.dateRules,readonly:""},null,8,["modelValue","min","rules"])]),_:1}),s(l,{md:"6",cols:"12"},{default:n(()=>[s(u,{modelValue:this.inputStock.po_status,"onUpdate:modelValue":t[3]||(t[3]=i=>this.inputStock.po_status=i),label:"PO Status",readonly:""},null,8,["modelValue"])]),_:1}),s(l,{md:"6",cols:"12"},{default:n(()=>[s(u,{modelValue:this.inputStock.invoice_number,"onUpdate:modelValue":t[4]||(t[4]=i=>this.inputStock.invoice_number=i),label:"Invoice No",rules:e.InvoiceNo},null,8,["modelValue","rules"])]),_:1}),s(l,{md:"6",cols:"12"},{default:n(()=>[s(u,{label:"Invoice File",type:"file",onChange:t[5]||(t[5]=i=>r.handleFileUpload("invoiceFile",i)),rules:e.invoicefile},null,8,["rules"])]),_:1}),s(l,{md:"6",cols:"12"},{default:n(()=>[s(u,{label:"DC File",type:"file",onChange:t[6]||(t[6]=i=>r.handleFileUpload("regularFile",i))})]),_:1}),s(l,{cols:"12"},{default:n(()=>[s(O,{headers:e.headers,items:e.InputStockDetails},{default:n(()=>[c("thead",null,[c("tr",null,[(m(!0),p(b,null,f(e.headers,i=>(m(),p("th",{class:"text-center",key:i},h(i.text),1))),128))])]),c("tbody",null,[(m(!0),p(b,null,f(this.inputStockproducts,(i,o)=>(m(),p("tr",{key:o},[c("td",L,h(i.sku_name),1),c("td",W,h(i.uom),1),c("td",Z,h(i.quantity),1),c("td",j,[s(u,{modelValue:i.received_quantity,"onUpdate:modelValue":k=>i.received_quantity=k,outlined:"",dense:"",onKeydown:r.preventDecimal,onPaste:r.preventPaste,type:"number",min:"0",max:i.quantity,rules:e.receivedquantity},null,8,["modelValue","onUpdate:modelValue","onKeydown","onPaste","max","rules"]),r.isQuantityExceeded(i.received_quantity,i.quantity)?(m(),p("span",Y)):x("",!0)]),c("td",G,[s(u,{onKeydown:r.preventDecimal,onPaste:r.preventPaste,type:"number",min:"0",max:"20000",modelValue:i.rtm,"onUpdate:modelValue":k=>i.rtm=k,outlined:"",dense:"",rules:e.rtm1},null,8,["onKeydown","onPaste","modelValue","onUpdate:modelValue","rules"])]),c("td",H,[s(u,{modelValue:i.remarks,"onUpdate:modelValue":k=>i.remarks=k,outlined:"",dense:"",required:""},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])]),_:1},8,["headers","items"])]),_:1}),s(l,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:n(()=>[s(q,{onClick:t[7]||(t[7]=i=>r.validateForm())},{default:n(()=>[y("Save")]),_:1}),D(s(I,{size:50,color:"primary",indeterminate:""},null,512),[[T,e.isProgress]])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),s(E,{modelValue:e.snackbar,"onUpdate:modelValue":t[8]||(t[8]=i=>e.snackbar=i),timeout:3e3,color:e.color},{default:n(()=>[y(h(e.snackbarText),1)]),_:1},8,["modelValue","color"])])}const X=V(A,[["render",J]]),$={components:{Inputstock:X},data(){return{currentroute:"",activeTab:"",tabs:[{title:"Create Input Stock",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=F(),this.activeTab=P(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function ee(a,t,d,_,e,r){const i=U("Inputstock");return m(),p("div",null,[s(M,{modelValue:e.activeTab,"onUpdate:modelValue":t[0]||(t[0]=o=>e.activeTab=o),"show-arrows":""},{default:n(()=>[(m(!0),p(b,null,f(e.tabs,o=>(m(),R(z,{key:o.icon,value:o.tab},{default:n(()=>[s(C,{size:"20",start:"",icon:o.icon},null,8,["icon"]),y(" "+h(o.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),s(w),s(K,{modelValue:e.activeTab,"onUpdate:modelValue":t[1]||(t[1]=o=>e.activeTab=o),class:"mt-5 disable-tab-transition",touch:!1},{default:n(()=>[s(B,{value:"account"},{default:n(()=>[s(i)]),_:1})]),_:1},8,["modelValue"])])}const le=V($,[["render",ee]]);export{le as default};
