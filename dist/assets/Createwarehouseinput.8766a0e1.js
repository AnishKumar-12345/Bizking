import{_ as g,o as d,c,g as s,w as n,i as p,j as S,k as x,l as V,m as _,a as u,F as y,s as f,t as h,b0 as q,n as v,b,x as D,e as I,u as T,r as w,f as P,v as C}from"./index.4ba6e09e.js";import{s as R}from"./Services.8ccc7918.js";import{V as U}from"./VForm.ce948013.js";import{V as F}from"./VSelect.ab378d35.js";import{V as O}from"./VTable.658b1e60.js";import{V as Q}from"./VSnackbar.c3a3331b.js";import{V as E,a as N,b as B,c as M}from"./VWindowItem.5917a1e6.js";import"./index.2bd8ddc8.js";import"./VCheckboxBtn.d8b7733e.js";import"./VChip.7e7c907c.js";const K={mixins:[R],props:["po_id"],data(){return{receivedquantity:[a=>a===0||!!a&&`${a}`.trim()!==""||"Received Quantity Is Required"],snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,today:this.getFormattedDate(new Date),inputStock:{brand_id:"",stock_updated_date:this.getFormattedDate(new Date),received_quantity:"",po_status:"",po_id:"",remarks:"",rtm:"",products:[{brand_id:"",brand_product_id:"",received_quantity:"",rtm:"",remarks:""}]},PoId:"",InputStockDetails:[],selectedPurchaseOrder:null,dialog:!1,headers:[{text:"Product Name",value:"brand_name"},{text:"UOM",value:"uom"},{text:"Ordered Quantity",value:"quantity"},{text:"Received Quantity",value:"quantity"},{text:"RTM",value:"carbs"},{text:"Remarks",value:"protein"}]}},computed:{filteredDesserts(){return this.selectedPurchaseOrder,this.desserts.filter(a=>a.purchaseOrder===this.selectedPurchaseOrder)}},mounted(){this.PoId=this.$route.query.po_id,console.log("Received po_id:",this.PoId),this.getInputstockdetails()},methods:{isrtmQuantityExceeded(a,e,i){console.log("check valids",e,i),i>e&&(this.snackbar=!0,this.color="error",this.snackbarText="RTM quantity cannot exceed item quantity.")},isQuantityExceeded(a,e){a>e&&(this.snackbar=!0,this.color="error",this.snackbarText="Received quantity cannot exceed item quantity.")},preventPaste(a){const i=(a.clipboardData||window.clipboardData).getData("text");/^[0-9]+$/.test(i)||a.preventDefault()},preventDecimal(a){(a.key==="."||a.key===","||a.key==="+"||a.key==="-"||a.keyCode===189||a.keyCode===109)&&a.preventDefault()},validateForm(){this.$refs.purchaseOrderForm.validate().then(a=>{console.log("form valid",a.valid),a.valid==!0?this.saveInputstock():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="error")})},saveInputstock(){const a={Draft:1,Created:2,Shared:3,Acknowledged:4,Received:5},e={brand_name:this.inputStock.brand_name,po_number:this.inputStock.po_number,brand_id:this.inputStock.brand_id,stock_updated_date:this.inputStock.stock_updated_date,recieved_date:this.inputStock.stock_updated_date,po_id:this.inputStock.po_id,po_status:a[this.inputStock.po_status],products:this.inputStockproducts.map((t,r)=>({brand_product_id:t.brand_product_id,received_quantity:`${t.received_quantity}`,rtm:`${t.rtm}`,sku_name:t.sku_name,remarks:t.remarks,quantity:t.quantity,hsn_code:t.hsn_code,mrp:t.mrp,uom:t.uom,price_per_unit:t.price_per_unit,taxable_amount:t.taxable_amount,csgt:t.csgt,sgst:t.sgst,amount:t.amount,sgst_percentage:t.sgst_percentage,cgst_percentage:t.cgst_percentage,total_give_margin:t.total_give_margin}))};console.log("check the post data",e);const i=e.products.filter(t=>{console.log("check the post data",t.rtm>t.quantity);const r=Number(t.received_quantity)+Number(t.rtm);return this.isQuantityExceeded(t.received_quantity,t.quantity)||t.received_quantity===0&&t.rtm>t.quantity||t.received_quantity===t.quantity&&t.rtm>t.quantity||r>t.quantity});console.log("valid errors",i),i.length===0?this.PostInputstock(e).then(t=>{console.log("check the response",t),console.log("check the response",t.status),t.status==1?(this.snackbar=!0,this.color="success",this.formData={},this.snackbarText=t.message,this.$router.push({name:"Viewpurchasehistory"})):(this.snackbar=!0,this.color="error")}):(this.snackbar=!0,this.color="error",this.snackbarText="your quantities are exceeded")},getFormattedDate(a){const e=a.getFullYear(),i=String(a.getMonth()+1).padStart(2,"0"),t=String(a.getDate()).padStart(2,"0");return`${e}-${i}-${t}`},getInputstockdetails(){this.getInputstock(this.PoId).then(a=>{this.InputStockDetails=a.data,console.log("check input dtock",this.InputStockDetails),this.InputStockDetails.forEach(e=>{this.inputStock.brand_id=e.brand_id,this.inputStock.po_id=e.po_id,this.inputStock.po_number=e.po_number,this.inputStock.brand_name=e.brand_name,this.inputStock.po_status=e.po_status,this.inputStockproducts=e.products,this.inputStock.received_quantity=e.received_quantity,this.inputStock.remarks=e.remarks,this.inputStock.rtm=e.rtm,console.log("inputStockproducts",this.inputStockproducts)})})}}},A={class:"text-center"},W={class:"text-center"},j={class:"text-center"},z={class:"text-center"},L={key:0},Y={class:"text-center"},$={class:"text-center"};function G(a,e,i,t,r,m){return d(),c("div",null,[s(V,null,{default:n(()=>[s(p,{cols:"12"},{default:n(()=>[s(S,{title:"Input Stock",class:"mb-4"},{default:n(()=>[s(x,null,{default:n(()=>[s(U,{class:"mt-6",ref:"purchaseOrderForm"},{default:n(()=>[s(V,null,{default:n(()=>[s(p,{md:"6",cols:"12"},{default:n(()=>[s(_,{modelValue:this.inputStock.po_number,"onUpdate:modelValue":e[0]||(e[0]=o=>this.inputStock.po_number=o),label:"Purchase Order",readonly:""},null,8,["modelValue"])]),_:1}),s(p,{cols:"12",md:"6"},{default:n(()=>[s(_,{modelValue:this.inputStock.brand_name,"onUpdate:modelValue":e[1]||(e[1]=o=>this.inputStock.brand_name=o),label:"Order To",readonly:""},null,8,["modelValue"])]),_:1}),s(p,{cols:"12",md:"6"},{default:n(()=>[s(_,{modelValue:this.inputStock.stock_updated_date,"onUpdate:modelValue":e[2]||(e[2]=o=>this.inputStock.stock_updated_date=o),type:"date",label:"Date",min:r.today,rules:a.dateRules,readonly:""},null,8,["modelValue","min","rules"])]),_:1}),s(p,{md:"6",cols:"12"},{default:n(()=>[s(F,{modelValue:this.inputStock.po_status,"onUpdate:modelValue":e[3]||(e[3]=o=>this.inputStock.po_status=o),label:"PO Status",items:["Draft","Created","Shared","Acknowledged","Received","Close"]},null,8,["modelValue"])]),_:1}),s(p,{cols:"12"},{default:n(()=>[s(O,{headers:r.headers,items:r.InputStockDetails},{default:n(()=>[u("thead",null,[u("tr",null,[(d(!0),c(y,null,f(r.headers,o=>(d(),c("th",{class:"text-center",key:o},h(o.text),1))),128))])]),u("tbody",null,[(d(!0),c(y,null,f(this.inputStockproducts,(o,l)=>(d(),c("tr",{key:l},[u("td",A,h(o.sku_name),1),u("td",W,h(o.uom),1),u("td",j,h(o.quantity),1),u("td",z,[s(_,{modelValue:o.received_quantity,"onUpdate:modelValue":k=>o.received_quantity=k,outlined:"",dense:"",onKeydown:m.preventDecimal,onPaste:m.preventPaste,type:"number",min:"0",max:o.quantity,rules:r.receivedquantity},null,8,["modelValue","onUpdate:modelValue","onKeydown","onPaste","max","rules"]),m.isQuantityExceeded(o.received_quantity,o.quantity)?(d(),c("span",L)):q("",!0)]),u("td",Y,[s(_,{onKeydown:m.preventDecimal,onPaste:m.preventPaste,type:"number",min:"0",max:"20000",modelValue:o.rtm,"onUpdate:modelValue":k=>o.rtm=k,outlined:"",dense:"",required:""},null,8,["onKeydown","onPaste","modelValue","onUpdate:modelValue"])]),u("td",$,[s(_,{modelValue:o.remarks,"onUpdate:modelValue":k=>o.remarks=k,outlined:"",dense:"",required:""},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])]),_:1},8,["headers","items"])]),_:1}),s(p,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:n(()=>[s(v,{onClick:e[4]||(e[4]=o=>m.validateForm())},{default:n(()=>[b("Save")]),_:1}),s(v,{color:"secondary",variant:"tonal",type:"reset"},{default:n(()=>[b(" Reset ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),s(Q,{modelValue:r.snackbar,"onUpdate:modelValue":e[5]||(e[5]=o=>r.snackbar=o),timeout:3e3,color:r.color},{default:n(()=>[b(h(r.snackbarText),1)]),_:1},8,["modelValue","color"])])}const H=g(K,[["render",G]]),J={components:{Inputstock:H},data(){return{currentroute:"",activeTab:"",tabs:[{title:"Create Input Stock",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=D(),this.activeTab=I(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function X(a,e,i,t,r,m){const o=w("Inputstock");return d(),c("div",null,[s(E,{modelValue:r.activeTab,"onUpdate:modelValue":e[0]||(e[0]=l=>r.activeTab=l),"show-arrows":""},{default:n(()=>[(d(!0),c(y,null,f(r.tabs,l=>(d(),P(M,{key:l.icon,value:l.tab},{default:n(()=>[s(C,{size:"20",start:"",icon:l.icon},null,8,["icon"]),b(" "+h(l.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),s(T),s(B,{modelValue:r.activeTab,"onUpdate:modelValue":e[1]||(e[1]=l=>r.activeTab=l),class:"mt-5 disable-tab-transition",touch:!1},{default:n(()=>[s(N,{value:"account"},{default:n(()=>[s(o)]),_:1})]),_:1},8,["modelValue"])])}const ut=g(J,[["render",X]]);export{ut as default};
