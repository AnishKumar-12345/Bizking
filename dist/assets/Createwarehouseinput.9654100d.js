import{_ as V,o as m,c as p,g as s,w as i,i as l,j as g,k as S,l as v,a as c,F as b,q as f,t as k,b8 as x,m as q,b as y,v as D,e as I,s as T,r as F,f as w,u as U}from"./index.6fab7df6.js";import{s as P}from"./Services.1c6b0dde.js";import{V as R}from"./VForm.6f4c5848.js";import{V as u}from"./VTextField.29332737.js";import{V as C}from"./VTable.a4e5168f.js";import{V as N}from"./VSnackbar.48fa8d81.js";import{V as Q,a as O,b as E,c as M}from"./VWindowItem.e8cea33b.js";const B={mixins:[P],props:["po_id"],data(){return{receivedquantity:[a=>a===0||!!a&&`${a}`.trim()!==""||"Received Quantity Is Required"],rtm1:[a=>a===0||!!a&&`${a}`.trim()!==""||"Rtm Quantity Is Required"],snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,InvoiceNo:[a=>!!a||"Invoice Number is required"],invoicefile:[a=>!!a||"Invoice File is required"],today:this.getFormattedDate(new Date),inputStock:{brand_id:"",stock_updated_date:this.getFormattedDate(new Date),received_quantity:"",po_status:"",po_id:"",remarks:"",rtm:"",invoice_number:"",delivery_challan_file:"",invoice_file:"",products:[{brand_id:"",brand_product_id:"",received_quantity:"",rtm:"",remarks:""}]},PoId:"",InputStockDetails:[],selectedPurchaseOrder:null,dialog:!1,headers:[{text:"Product Name",value:"brand_name"},{text:"UOM",value:"uom"},{text:"Ordered Quantity",value:"quantity"},{text:"Received Quantity",value:"quantity"},{text:"RTM",value:"carbs"},{text:"Remarks",value:"protein"}]}},computed:{filteredDesserts(){return this.selectedPurchaseOrder,this.desserts.filter(a=>a.purchaseOrder===this.selectedPurchaseOrder)}},mounted(){this.PoId=this.$route.query.po_id,this.getInputstockdetails()},methods:{handleFileUpload(a,t){const _=t.target.files[0],e=new FileReader;e.onload=()=>{const o=e.result.split(",")[1];a==="invoiceFile"?this.inputStock.invoice_file=o:a==="regularFile"&&(this.inputStock.delivery_challan_file=o)},e.readAsDataURL(_)},isrtmQuantityExceeded(a,t,d){d>t&&(this.snackbar=!0,this.color="on-background",this.snackbarText="RTM quantity cannot exceed item quantity.")},isQuantityExceeded(a,t){a>t&&(this.snackbar=!0,this.color="on-background",this.snackbarText="Received quantity cannot exceed item quantity.")},preventPaste(a){const d=(a.clipboardData||window.clipboardData).getData("text");/^[0-9]+$/.test(d)||a.preventDefault()},preventDecimal(a){(a.key==="."||a.key===","||a.key==="+"||a.key==="-"||a.keyCode===189||a.keyCode===109)&&a.preventDefault()},validateForm(){this.$refs.purchaseOrderForm.validate().then(a=>{a.valid==!0?this.saveInputstock():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="on-background")})},saveInputstock(){const a={Draft:1,Created:2,Shared:3,Acknowledged:4,Received:5},t={brand_name:this.inputStock.brand_name,po_number:this.inputStock.po_number,brand_id:this.inputStock.brand_id,stock_updated_date:this.inputStock.stock_updated_date,recieved_date:this.inputStock.stock_updated_date,po_id:this.inputStock.po_id,po_status:a[this.inputStock.po_status],delivery_challan_file:this.inputStock.delivery_challan_file,invoice_file:this.inputStock.invoice_file,invoice_number:this.inputStock.invoice_number,products:this.inputStockproducts.map((e,o)=>({brand_product_id:e.brand_product_id,received_quantity:`${e.received_quantity}`,rtm:`${e.rtm}`,sku_name:e.sku_name,remarks:e.remarks,quantity:e.quantity,hsn_code:e.hsn_code,mrp:e.mrp,uom:e.uom,price_per_unit:e.price_per_unit,taxable_amount:e.taxable_amount,csgt:e.csgt,sgst:e.sgst,amount:e.amount,sgst_percentage:e.sgst_percentage,cgst_percentage:e.cgst_percentage,total_give_margin:e.total_give_margin}))};if(!t.products.some(e=>e.received_quantity>0||e.rtm>0)){this.snackbar=!0,this.color="on-background",this.snackbarText="Received Quantity or RTM must be greater than 0 for at least one product.";return}t.products.filter(e=>{const o=Number(e.received_quantity)+Number(e.rtm);return this.isQuantityExceeded(e.received_quantity,e.quantity)||e.received_quantity===0&&e.rtm>e.quantity||e.received_quantity===e.quantity&&e.rtm>e.quantity||o>e.quantity}).length===0?this.PostInputstock(t).then(e=>{e.status==1?(this.snackbar=!0,this.color="primary",this.formData={},this.snackbarText=e.message,setTimeout(()=>{this.$router.push({name:"Viewpurchasehistory"})},2e3)):(this.snackbar=!0,this.color="on-background")}):(this.snackbar=!0,this.color="on-background",this.snackbarText="your quantities are exceeded")},getFormattedDate(a){const t=a.getFullYear(),d=String(a.getMonth()+1).padStart(2,"0"),_=String(a.getDate()).padStart(2,"0");return`${t}-${d}-${_}`},getInputstockdetails(){this.getInputstock(this.PoId).then(a=>{this.InputStockDetails=a.data,this.InputStockDetails.forEach(t=>{this.inputStock.brand_id=t.brand_id,this.inputStock.po_id=t.po_id,this.inputStock.po_number=t.po_number,this.inputStock.brand_name=t.brand_name,this.inputStock.po_status="Received",this.inputStockproducts=t.products,this.inputStock.received_quantity=t.received_quantity,this.inputStock.remarks=t.remarks,this.inputStock.rtm=t.rtm})})}}},K={class:"text-center"},A={class:"text-center"},L={class:"text-center"},W={class:"text-center"},Z={key:0},j={class:"text-center"},z={class:"text-center"};function Y(a,t,d,_,e,o){return m(),p("div",null,[s(v,null,{default:i(()=>[s(l,{cols:"12"},{default:i(()=>[s(g,{title:"Input Stock",class:"mb-4"},{default:i(()=>[s(S,null,{default:i(()=>[s(R,{class:"mt-6",ref:"purchaseOrderForm"},{default:i(()=>[s(v,null,{default:i(()=>[s(l,{md:"6",cols:"12"},{default:i(()=>[s(u,{modelValue:this.inputStock.po_number,"onUpdate:modelValue":t[0]||(t[0]=n=>this.inputStock.po_number=n),label:"Purchase Order",readonly:""},null,8,["modelValue"])]),_:1}),s(l,{cols:"12",md:"6"},{default:i(()=>[s(u,{modelValue:this.inputStock.brand_name,"onUpdate:modelValue":t[1]||(t[1]=n=>this.inputStock.brand_name=n),label:"Order To",readonly:""},null,8,["modelValue"])]),_:1}),s(l,{cols:"12",md:"6"},{default:i(()=>[s(u,{modelValue:this.inputStock.stock_updated_date,"onUpdate:modelValue":t[2]||(t[2]=n=>this.inputStock.stock_updated_date=n),type:"date",label:"Date",min:e.today,rules:a.dateRules,readonly:""},null,8,["modelValue","min","rules"])]),_:1}),s(l,{md:"6",cols:"12"},{default:i(()=>[s(u,{modelValue:this.inputStock.po_status,"onUpdate:modelValue":t[3]||(t[3]=n=>this.inputStock.po_status=n),label:"PO Status",readonly:""},null,8,["modelValue"])]),_:1}),s(l,{md:"6",cols:"12"},{default:i(()=>[s(u,{modelValue:this.inputStock.invoice_number,"onUpdate:modelValue":t[4]||(t[4]=n=>this.inputStock.invoice_number=n),label:"Invoice No",rules:e.InvoiceNo},null,8,["modelValue","rules"])]),_:1}),s(l,{md:"6",cols:"12"},{default:i(()=>[s(u,{label:"Invoice File",type:"file",onChange:t[5]||(t[5]=n=>o.handleFileUpload("invoiceFile",n)),rules:e.invoicefile},null,8,["rules"])]),_:1}),s(l,{md:"6",cols:"12"},{default:i(()=>[s(u,{label:"DC File",type:"file",onChange:t[6]||(t[6]=n=>o.handleFileUpload("regularFile",n))})]),_:1}),s(l,{cols:"12"},{default:i(()=>[s(C,{headers:e.headers,items:e.InputStockDetails},{default:i(()=>[c("thead",null,[c("tr",null,[(m(!0),p(b,null,f(e.headers,n=>(m(),p("th",{class:"text-center",key:n},k(n.text),1))),128))])]),c("tbody",null,[(m(!0),p(b,null,f(this.inputStockproducts,(n,r)=>(m(),p("tr",{key:r},[c("td",K,k(n.sku_name),1),c("td",A,k(n.uom),1),c("td",L,k(n.quantity),1),c("td",W,[s(u,{modelValue:n.received_quantity,"onUpdate:modelValue":h=>n.received_quantity=h,outlined:"",dense:"",onKeydown:o.preventDecimal,onPaste:o.preventPaste,type:"number",min:"0",max:n.quantity,rules:e.receivedquantity},null,8,["modelValue","onUpdate:modelValue","onKeydown","onPaste","max","rules"]),o.isQuantityExceeded(n.received_quantity,n.quantity)?(m(),p("span",Z)):x("",!0)]),c("td",j,[s(u,{onKeydown:o.preventDecimal,onPaste:o.preventPaste,type:"number",min:"0",max:"20000",modelValue:n.rtm,"onUpdate:modelValue":h=>n.rtm=h,outlined:"",dense:"",rules:e.rtm1},null,8,["onKeydown","onPaste","modelValue","onUpdate:modelValue","rules"])]),c("td",z,[s(u,{modelValue:n.remarks,"onUpdate:modelValue":h=>n.remarks=h,outlined:"",dense:"",required:""},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])]),_:1},8,["headers","items"])]),_:1}),s(l,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:i(()=>[s(q,{onClick:t[7]||(t[7]=n=>o.validateForm())},{default:i(()=>[y("Save")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),s(N,{modelValue:e.snackbar,"onUpdate:modelValue":t[8]||(t[8]=n=>e.snackbar=n),timeout:3e3,color:e.color},{default:i(()=>[y(k(e.snackbarText),1)]),_:1},8,["modelValue","color"])])}const G=V(B,[["render",Y]]),H={components:{Inputstock:G},data(){return{currentroute:"",activeTab:"",tabs:[{title:"Create Input Stock",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=D(),this.activeTab=I(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function J(a,t,d,_,e,o){const n=F("Inputstock");return m(),p("div",null,[s(Q,{modelValue:e.activeTab,"onUpdate:modelValue":t[0]||(t[0]=r=>e.activeTab=r),"show-arrows":""},{default:i(()=>[(m(!0),p(b,null,f(e.tabs,r=>(m(),w(M,{key:r.icon,value:r.tab},{default:i(()=>[s(U,{size:"20",start:"",icon:r.icon},null,8,["icon"]),y(" "+k(r.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),s(T),s(E,{modelValue:e.activeTab,"onUpdate:modelValue":t[1]||(t[1]=r=>e.activeTab=r),class:"mt-5 disable-tab-transition",touch:!1},{default:i(()=>[s(O,{value:"account"},{default:i(()=>[s(n)]),_:1})]),_:1},8,["modelValue"])])}const ie=V(H,[["render",J]]);export{ie as default};
