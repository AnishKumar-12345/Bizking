import{_ as v,o as l,c,g as n,w as r,i as m,j as g,k as x,l as V,a as u,F as b,q as y,t as _,b6 as S,m as q,b as f,v as D,e as T,s as I,r as w,f as P,u as R}from"./index.dc6d2f7d.js";import{s as U}from"./Services.987bac00.js";import{V as C}from"./VForm.58e20691.js";import{V as p}from"./VTextField.793ac199.js";import{V as F}from"./VTable.8a65c88e.js";import{V as Q}from"./VSnackbar.837b5db7.js";import{V as O,a as N,b as E,c as M}from"./VWindowItem.f3ad2692.js";import"./index.2bd8ddc8.js";const B={mixins:[U],props:["po_id"],data(){return{receivedquantity:[a=>a===0||!!a&&`${a}`.trim()!==""||"Received Quantity Is Required"],rtm1:[a=>a===0||!!a&&`${a}`.trim()!==""||"Rtm Quantity Is Required"],snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,today:this.getFormattedDate(new Date),inputStock:{brand_id:"",stock_updated_date:this.getFormattedDate(new Date),received_quantity:"",po_status:"",po_id:"",remarks:"",rtm:"",products:[{brand_id:"",brand_product_id:"",received_quantity:"",rtm:"",remarks:""}]},PoId:"",InputStockDetails:[],selectedPurchaseOrder:null,dialog:!1,headers:[{text:"Product Name",value:"brand_name"},{text:"UOM",value:"uom"},{text:"Ordered Quantity",value:"quantity"},{text:"Received Quantity",value:"quantity"},{text:"RTM",value:"carbs"},{text:"Remarks",value:"protein"}]}},computed:{filteredDesserts(){return this.selectedPurchaseOrder,this.desserts.filter(a=>a.purchaseOrder===this.selectedPurchaseOrder)}},mounted(){this.PoId=this.$route.query.po_id,this.getInputstockdetails()},methods:{isrtmQuantityExceeded(a,e,d){d>e&&(this.snackbar=!0,this.color="on-background",this.snackbarText="RTM quantity cannot exceed item quantity.")},isQuantityExceeded(a,e){a>e&&(this.snackbar=!0,this.color="on-background",this.snackbarText="Received quantity cannot exceed item quantity.")},preventPaste(a){const d=(a.clipboardData||window.clipboardData).getData("text");/^[0-9]+$/.test(d)||a.preventDefault()},preventDecimal(a){(a.key==="."||a.key===","||a.key==="+"||a.key==="-"||a.keyCode===189||a.keyCode===109)&&a.preventDefault()},validateForm(){this.$refs.purchaseOrderForm.validate().then(a=>{a.valid==!0?this.saveInputstock():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="on-background")})},saveInputstock(){const a={Draft:1,Created:2,Shared:3,Acknowledged:4,Received:5},e={brand_name:this.inputStock.brand_name,po_number:this.inputStock.po_number,brand_id:this.inputStock.brand_id,stock_updated_date:this.inputStock.stock_updated_date,recieved_date:this.inputStock.stock_updated_date,po_id:this.inputStock.po_id,po_status:a[this.inputStock.po_status],products:this.inputStockproducts.map((t,o)=>({brand_product_id:t.brand_product_id,received_quantity:`${t.received_quantity}`,rtm:`${t.rtm}`,sku_name:t.sku_name,remarks:t.remarks,quantity:t.quantity,hsn_code:t.hsn_code,mrp:t.mrp,uom:t.uom,price_per_unit:t.price_per_unit,taxable_amount:t.taxable_amount,csgt:t.csgt,sgst:t.sgst,amount:t.amount,sgst_percentage:t.sgst_percentage,cgst_percentage:t.cgst_percentage,total_give_margin:t.total_give_margin}))};if(!e.products.some(t=>t.received_quantity>0||t.rtm>0)){this.snackbar=!0,this.color="on-background",this.snackbarText="Received Quantity or RTM must be greater than 0 for at least one product.";return}e.products.filter(t=>{const o=Number(t.received_quantity)+Number(t.rtm);return this.isQuantityExceeded(t.received_quantity,t.quantity)||t.received_quantity===0&&t.rtm>t.quantity||t.received_quantity===t.quantity&&t.rtm>t.quantity||o>t.quantity}).length===0?this.PostInputstock(e).then(t=>{t.status==1?(this.snackbar=!0,this.color="primary",this.formData={},this.snackbarText=t.message,setTimeout(()=>{this.$router.push({name:"Viewpurchasehistory"})},2e3)):(this.snackbar=!0,this.color="on-background")}):(this.snackbar=!0,this.color="on-background",this.snackbarText="your quantities are exceeded")},getFormattedDate(a){const e=a.getFullYear(),d=String(a.getMonth()+1).padStart(2,"0"),k=String(a.getDate()).padStart(2,"0");return`${e}-${d}-${k}`},getInputstockdetails(){this.getInputstock(this.PoId).then(a=>{this.InputStockDetails=a.data,this.InputStockDetails.forEach(e=>{this.inputStock.brand_id=e.brand_id,this.inputStock.po_id=e.po_id,this.inputStock.po_number=e.po_number,this.inputStock.brand_name=e.brand_name,this.inputStock.po_status="Received",this.inputStockproducts=e.products,this.inputStock.received_quantity=e.received_quantity,this.inputStock.remarks=e.remarks,this.inputStock.rtm=e.rtm})})}}},K={class:"text-center"},W={class:"text-center"},Z={class:"text-center"},j={class:"text-center"},z={key:0},A={class:"text-center"},L={class:"text-center"};function Y(a,e,d,k,t,o){return l(),c("div",null,[n(V,null,{default:r(()=>[n(m,{cols:"12"},{default:r(()=>[n(g,{title:"Input Stock",class:"mb-4"},{default:r(()=>[n(x,null,{default:r(()=>[n(C,{class:"mt-6",ref:"purchaseOrderForm"},{default:r(()=>[n(V,null,{default:r(()=>[n(m,{md:"6",cols:"12"},{default:r(()=>[n(p,{modelValue:this.inputStock.po_number,"onUpdate:modelValue":e[0]||(e[0]=s=>this.inputStock.po_number=s),label:"Purchase Order",readonly:""},null,8,["modelValue"])]),_:1}),n(m,{cols:"12",md:"6"},{default:r(()=>[n(p,{modelValue:this.inputStock.brand_name,"onUpdate:modelValue":e[1]||(e[1]=s=>this.inputStock.brand_name=s),label:"Order To",readonly:""},null,8,["modelValue"])]),_:1}),n(m,{cols:"12",md:"6"},{default:r(()=>[n(p,{modelValue:this.inputStock.stock_updated_date,"onUpdate:modelValue":e[2]||(e[2]=s=>this.inputStock.stock_updated_date=s),type:"date",label:"Date",min:t.today,rules:a.dateRules,readonly:""},null,8,["modelValue","min","rules"])]),_:1}),n(m,{md:"6",cols:"12"},{default:r(()=>[n(p,{modelValue:this.inputStock.po_status,"onUpdate:modelValue":e[3]||(e[3]=s=>this.inputStock.po_status=s),label:"PO Status",readonly:""},null,8,["modelValue"])]),_:1}),n(m,{cols:"12"},{default:r(()=>[n(F,{headers:t.headers,items:t.InputStockDetails},{default:r(()=>[u("thead",null,[u("tr",null,[(l(!0),c(b,null,y(t.headers,s=>(l(),c("th",{class:"text-center",key:s},_(s.text),1))),128))])]),u("tbody",null,[(l(!0),c(b,null,y(this.inputStockproducts,(s,i)=>(l(),c("tr",{key:i},[u("td",K,_(s.sku_name),1),u("td",W,_(s.uom),1),u("td",Z,_(s.quantity),1),u("td",j,[n(p,{modelValue:s.received_quantity,"onUpdate:modelValue":h=>s.received_quantity=h,outlined:"",dense:"",onKeydown:o.preventDecimal,onPaste:o.preventPaste,type:"number",min:"0",max:s.quantity,rules:t.receivedquantity},null,8,["modelValue","onUpdate:modelValue","onKeydown","onPaste","max","rules"]),o.isQuantityExceeded(s.received_quantity,s.quantity)?(l(),c("span",z)):S("",!0)]),u("td",A,[n(p,{onKeydown:o.preventDecimal,onPaste:o.preventPaste,type:"number",min:"0",max:"20000",modelValue:s.rtm,"onUpdate:modelValue":h=>s.rtm=h,outlined:"",dense:"",rules:t.rtm1},null,8,["onKeydown","onPaste","modelValue","onUpdate:modelValue","rules"])]),u("td",L,[n(p,{modelValue:s.remarks,"onUpdate:modelValue":h=>s.remarks=h,outlined:"",dense:"",required:""},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])]),_:1},8,["headers","items"])]),_:1}),n(m,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:r(()=>[n(q,{onClick:e[4]||(e[4]=s=>o.validateForm())},{default:r(()=>[f("Save")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),n(Q,{modelValue:t.snackbar,"onUpdate:modelValue":e[5]||(e[5]=s=>t.snackbar=s),timeout:3e3,color:t.color},{default:r(()=>[f(_(t.snackbarText),1)]),_:1},8,["modelValue","color"])])}const $=v(B,[["render",Y]]),G={components:{Inputstock:$},data(){return{currentroute:"",activeTab:"",tabs:[{title:"Create Input Stock",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=D(),this.activeTab=T(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function H(a,e,d,k,t,o){const s=w("Inputstock");return l(),c("div",null,[n(O,{modelValue:t.activeTab,"onUpdate:modelValue":e[0]||(e[0]=i=>t.activeTab=i),"show-arrows":""},{default:r(()=>[(l(!0),c(b,null,y(t.tabs,i=>(l(),P(M,{key:i.icon,value:i.tab},{default:r(()=>[n(R,{size:"20",start:"",icon:i.icon},null,8,["icon"]),f(" "+_(i.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),n(I),n(E,{modelValue:t.activeTab,"onUpdate:modelValue":e[1]||(e[1]=i=>t.activeTab=i),class:"mt-5 disable-tab-transition",touch:!1},{default:r(()=>[n(N,{value:"account"},{default:r(()=>[n(s)]),_:1})]),_:1},8,["modelValue"])])}const ot=v(G,[["render",H]]);export{ot as default};
