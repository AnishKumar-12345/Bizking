import{_ as x,o as i,c as u,g as a,w as o,i as p,j as q,k as I,l as V,m as h,a as d,F as f,s as y,t as _,b0 as g,n as v,b,x as D,e as T,u as P,r as w,f as R,v as C}from"./index.2c6dfeb2.js";import{s as U}from"./Services.1028c5df.js";import{V as F}from"./VForm.e7c1a600.js";import{V as S}from"./VSelect.010b0c39.js";import{V as O}from"./VTable.201050f6.js";import{V as E}from"./VSnackbar.bfa73c12.js";import{V as Q,a as B,b as N,c as K}from"./VWindowItem.58476b0e.js";import"./index.2bd8ddc8.js";import"./VCheckboxBtn.cb7b65b5.js";import"./VChip.4cba9e46.js";const M={mixins:[U],props:["po_id"],data(){return{receivedquantity:[t=>!!t||"Received Quantity Is Required"],rtm:[t=>!!t||"RTM Is Required"],remarks:[t=>!!t||"remarks Is Required"],snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,today:this.getFormattedDate(new Date),inputStock:{brand_id:"",stock_updated_date:this.getFormattedDate(new Date),received_quantity:"",remarks:"",rtm:"",products:[{brand_id:"",brand_product_id:"",received_quantity:"",rtm:"",remarks:""}]},PoId:"",InputStockDetails:[],selectedPurchaseOrder:null,dialog:!1,headers:[{text:"Product Name",value:"brand_name"},{text:"Ordered Quantity",value:"quantity"},{text:"Received Quantity",value:"quantity"},{text:"RTM",value:"carbs"},{text:"Remarks",value:"protein"}]}},computed:{filteredDesserts(){return this.selectedPurchaseOrder,this.desserts.filter(t=>t.purchaseOrder===this.selectedPurchaseOrder)}},mounted(){this.PoId=this.$route.query.po_id,console.log("Received po_id:",this.PoId),this.getInputstockdetails()},methods:{isQuantityExceeded(t,e){t>e&&(this.snackbar=!0,this.color="error",this.snackbarText="Received quantity cannot exceed item quantity.")},preventPaste(t){const s=(t.clipboardData||window.clipboardData).getData("text");/^[0-9]+$/.test(s)||t.preventDefault()},preventDecimal(t){(t.key==="."||t.key===","||t.key==="+"||t.key==="-"||t.keyCode===189||t.keyCode===109)&&t.preventDefault()},validateForm(){this.$refs.purchaseOrderForm.validate().then(t=>{console.log("form valid",t.valid),t.valid==!0?this.saveInputstock():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="error")})},saveInputstock(){const t={brand_id:this.inputStock.brand_id,stock_updated_date:this.inputStock.stock_updated_date,products:this.inputStockproducts.filter(s=>s.received_quantity>0).map((s,m)=>({brand_id:this.inputStock.brand_id,brand_product_id:s.brand_product_id,received_quantity:s.received_quantity,rtm:s.rtm,remarks:s.remarks,quantity:s.quantity}))};console.log("check the post data",t),t.products.filter(s=>this.isQuantityExceeded(s.received_quantity,s.quantity)||parseInt(s.rtm)>parseInt(s.quantity)||parseInt(s.rtm)>=parseInt(s.received_quantity)||parseInt(s.received_quantity)===0&&parseInt(s.rtm)>parseInt(s.quantity)).length===0?this.PostInputstock(t).then(s=>{console.log("check the response",s),console.log("check the response",s.status),s.status==1?(this.snackbar=!0,this.color="success",this.formData={},this.snackbarText=s.message,this.getInputstockdetails()):(this.snackbar=!0,this.color="error")}):(this.snackbar=!0,this.color="error",this.snackbarText="your quantities are exceeded")},getFormattedDate(t){const e=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),m=String(t.getDate()).padStart(2,"0");return`${e}-${s}-${m}`},getInputstockdetails(){this.getInputstock(this.PoId).then(t=>{this.InputStockDetails=t.data,console.log("check input dtock",this.InputStockDetails),this.InputStockDetails.forEach(e=>{this.inputStock.brand_id=e.brand_id,this.inputStock.po_number=e.po_number,this.inputStock.brand_name=e.brand_name,this.inputStock.po_status=e.po_status,this.inputStockproducts=e.products,this.inputStock.received_quantity=e.received_quantity,this.inputStock.remarks=e.remarks,this.inputStock.rtm=e.rtm,console.log("inputStockproducts",this.inputStockproducts)})})}}},W={class:"text-center"},j={class:"text-center"},z={class:"text-center"},A={key:0},L={class:"text-center"},Y={class:"text-center"};function G(t,e,s,m,n,c){return i(),u("div",null,[a(V,null,{default:o(()=>[a(p,{cols:"12"},{default:o(()=>[a(q,{title:"Input Stock",class:"mb-4"},{default:o(()=>[a(I,null,{default:o(()=>[a(F,{class:"mt-6",ref:"purchaseOrderForm"},{default:o(()=>[a(V,null,{default:o(()=>[a(p,{md:"6",cols:"12"},{default:o(()=>[a(S,{modelValue:this.inputStock.po_number,"onUpdate:modelValue":e[0]||(e[0]=r=>this.inputStock.po_number=r),label:"Purchase Order"},null,8,["modelValue"])]),_:1}),a(p,{cols:"12",md:"6"},{default:o(()=>[a(h,{modelValue:this.inputStock.brand_name,"onUpdate:modelValue":e[1]||(e[1]=r=>this.inputStock.brand_name=r),label:"Order To"},null,8,["modelValue"])]),_:1}),a(p,{cols:"12",md:"6"},{default:o(()=>[a(h,{modelValue:this.inputStock.stock_updated_date,"onUpdate:modelValue":e[2]||(e[2]=r=>this.inputStock.stock_updated_date=r),type:"date",label:"Date",min:n.today,rules:t.dateRules,readonly:""},null,8,["modelValue","min","rules"])]),_:1}),a(p,{md:"6",cols:"12"},{default:o(()=>[a(S,{modelValue:this.inputStock.po_status,"onUpdate:modelValue":e[3]||(e[3]=r=>this.inputStock.po_status=r),label:"PO Status",items:["Draft","Created","Shared","Acknowledged","Received","Close"]},null,8,["modelValue"])]),_:1}),a(p,{cols:"12"},{default:o(()=>[a(O,{headers:n.headers,items:n.InputStockDetails},{default:o(()=>[d("thead",null,[d("tr",null,[(i(!0),u(f,null,y(n.headers,r=>(i(),u("th",{class:"text-center",key:r},_(r.text),1))),128))])]),d("tbody",null,[(i(!0),u(f,null,y(this.inputStockproducts,(r,l)=>(i(),u("tr",{key:l},[d("td",W,_(r.sku_name),1),d("td",j,_(r.quantity),1),d("td",z,[a(h,{modelValue:r.received_quantity,"onUpdate:modelValue":k=>r.received_quantity=k,outlined:"",dense:"",onKeydown:c.preventDecimal,onPaste:c.preventPaste,type:"number",min:"0",max:r.quantity,required:"",rules:n.receivedquantity},null,8,["modelValue","onUpdate:modelValue","onKeydown","onPaste","max","rules"]),c.isQuantityExceeded(r.received_quantity,r.quantity)?(i(),u("span",A)):g("",!0)]),d("td",L,[a(h,{onKeydown:c.preventDecimal,onPaste:c.preventPaste,type:"number",min:"0",max:"20000",modelValue:r.rtm,"onUpdate:modelValue":k=>r.rtm=k,outlined:"",dense:"",required:""},null,8,["onKeydown","onPaste","modelValue","onUpdate:modelValue"])]),d("td",Y,[a(h,{modelValue:r.remarks,"onUpdate:modelValue":k=>r.remarks=k,outlined:"",dense:"",required:""},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])]),_:1},8,["headers","items"])]),_:1}),a(p,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:o(()=>[a(v,{onClick:e[4]||(e[4]=r=>c.validateForm())},{default:o(()=>[b("Save")]),_:1}),a(v,{color:"secondary",variant:"tonal",type:"reset"},{default:o(()=>[b(" Reset ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),a(E,{modelValue:n.snackbar,"onUpdate:modelValue":e[5]||(e[5]=r=>n.snackbar=r),timeout:3e3,color:n.color},{default:o(()=>[b(_(n.snackbarText),1)]),_:1},8,["modelValue","color"])])}const H=x(M,[["render",G]]),J={components:{Inputstock:H},data(){return{currentroute:"",activeTab:"",tabs:[{title:"Create Input Stock",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=D(),this.activeTab=T(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function X(t,e,s,m,n,c){const r=w("Inputstock");return i(),u("div",null,[a(Q,{modelValue:n.activeTab,"onUpdate:modelValue":e[0]||(e[0]=l=>n.activeTab=l),"show-arrows":""},{default:o(()=>[(i(!0),u(f,null,y(n.tabs,l=>(i(),R(K,{key:l.icon,value:l.tab},{default:o(()=>[a(C,{size:"20",start:"",icon:l.icon},null,8,["icon"]),b(" "+_(l.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),a(P),a(N,{modelValue:n.activeTab,"onUpdate:modelValue":e[1]||(e[1]=l=>n.activeTab=l),class:"mt-5 disable-tab-transition",touch:!1},{default:o(()=>[a(B,{value:"account"},{default:o(()=>[a(r)]),_:1})]),_:1},8,["modelValue"])])}const it=x(J,[["render",X]]);export{it as default};
