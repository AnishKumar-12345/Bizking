import{_ as S,o as p,c as m,g as o,bj as V,bg as v,w as l,i as h,j as D,k as O,l as b,a as i,F as y,q as x,t as c,b as g,bk as f,m as q,v as w,e as P,s as T,r as U,f as F,u as C}from"./index.9e8238bc.js";import{s as E}from"./Services.a0afbe6c.js";import{V as Q,a as _}from"./VTextField.d627febb.js";import{V as R}from"./VSelect.c6616b42.js";import{V as B}from"./VTable.47b87660.js";import{V as N}from"./VChip.61664a67.js";import{V as K}from"./VSnackbar.e16afacf.js";import{V as I,a as M,b as z,c as L}from"./VWindowItem.c8530ca1.js";import"./index.2bd8ddc8.js";import"./VCheckboxBtn.b67094c8.js";const j={mixins:[E],props:["so_id"],data(){return{validquan:!1,PersonRules:[e=>!!e||"Delivery Person is required"],loading:!1,shippedexchange:[e=>e===0||!!e&&`${e}`.trim()!==""||"shippedexchange Quantity Is Required"],shippedquantity:[e=>e===0||!!e&&`${e}`.trim()!==""||"shipped Quantity Is Required"],snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,selectedPurchaseOrder:null,dialog:!1,Soid:"",OutputStockDetails:[],today:this.getFormattedDate(new Date),outputStock:{so_id:"",so_number:"",merchant_id:"",merchant_code:"",merchant_name:"",total_cgst:"",total_sgst:"",sub_total:"",total_margin:"",total_so_amount:"",total_quantity:"",created_date:"",shipped_date:this.getFormattedDate(new Date),so_status:"",products:[{merchant_product_id:"",sku_name:"",hsn_code:"",mrp:"",margin:"",ordered_quantity:"",warehouse_quantity:"",uom:"",price_per_unit:"",taxable_amount:"",cgst:"",sgst:"",amount:"",sgst_percentage:"",cgst_percentage:"",exchange:"",return:"",shipped_ordered:"",shipped_exchange:""}],delivery_user_details:[{delivery_person:"",name:""}]},outputStockproducts:[],headers:[{text:"Brand Name",value:"brand_name"},{text:"SKU Name",value:"sku_name"},{text:"UOM",value:"uom"},{text:"Exchange Quantity",value:"exchange_quantity"},{text:"Ordered Quantity",value:"ordered_quantity"},{text:"Available",value:"warehouse_quantity"},{text:"Shipped Ordered",value:"shipped_ordered"},{text:"Shipped Exchanged",value:"shipped_exchange"}],selectedDeliveryPerson:null,deliveryPersons:[],deliveryUserDetails:[]}},computed:{totalshippedorder(){return this.outputStockproducts.reduce((e,a)=>e+parseFloat(a.shipped_ordered||0),0)},totalshippedexchange(){return this.outputStockproducts.reduce((e,a)=>e+parseFloat(a.shipped_exchange||0),0)},filteredOutputstocks(){return this.outputStockproducts.filter(e=>e.exchange_quantity>0||e.ordered_quantity>0)}},mounted(){this.Soid=this.$route.query.so_id,console.log("Received po_id:",this.Soid),this.getOutputstockdetails(),setTimeout(()=>{this.loading=!1,console.log("deliveryPersons:",this.deliveryPersons)},2e3)},methods:{validateForm(){this.$refs.purchaseOrderForm.validate().then(e=>{console.log("form valid",e.valid),e.valid==!0?this.saveOutputstock():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="on-background")})},preventPaste(e){const n=(e.clipboardData||window.clipboardData).getData("text");/^[0-9]+$/.test(n)||e.preventDefault()},preventDecimal(e){(e.key==="."||e.key===","||e.key==="+"||e.key==="-"||e.keyCode===189||e.keyCode===109)&&e.preventDefault()},saveOutputstock(){const e={Draft:1,Created:2,Acknowledged:3,Shipped:4,Delivered:5},a={so_id:this.OutputStockDetails.so_id,so_number:this.outputStock.so_number,so_status:e[this.outputStock.so_status],merchant_id:this.OutputStockDetails.merchant_id,merchant_code:this.OutputStockDetails.merchant_code,merchant_name:this.outputStock.merchant_name,total_cgst:this.OutputStockDetails.total_cgst,total_sgst:this.OutputStockDetails.total_sgst,sub_total:this.OutputStockDetails.sub_total,total_margin:this.OutputStockDetails.total_margin,total_so_amount:this.OutputStockDetails.total_so_amount,total_quantity:this.OutputStockDetails.total_quantity,created_date:this.OutputStockDetails.created_date,shipped_date:this.outputStock.shipped_date,total_shipped_ordered:`${this.totalshippedorder}`,total_shipped_exchanged:`${this.totalshippedexchange}`,products:this.outputStockproducts.map((t,r)=>({merchant_product_id:t.merchant_product_id,sku_name:t.sku_name,hsn_code:t.hsn_code,mrp:t.mrp,margin:t.margin,margin_percentage:t.margin_percentage,brand_name:t.brand_name,quantity:t.ordered_quantity,uom:t.uom,price_per_unit:t.price_per_unit,taxable_amount:t.taxable_amount,cgst:t.cgst,sgst:t.sgst,amount:t.amount,sgst_percentage:t.sgst_percentage,cgst_percentage:t.cgst_percentage,exchange:t.exchange,return:t.return,shipped_ordered:`${t.shipped_ordered}`,shipped_exchange:`${t.shipped_exchange}`})),delivery_person:this.selectedDeliveryPerson};console.log("check the post data",a);const n=this.outputStockproducts.map(t=>this.isQuantityExceeded(t.shipped_ordered,t.ordered_quantity,t.warehouse_quantity)||this.isQuantityExceeded2(t.shipped_exchange,t.exchange));console.log("Validation Error Length:",n.filter(t=>t).length),n.filter(t=>t).length===0?(this.loading=!0,this.postOutputstock(a).then(t=>{console.log("check the response",t),t.status==1?(this.snackbar=!0,this.color="primary",this.formData={},this.snackbarText=t.message,setTimeout(()=>{this.$router.push({name:"Viewsaleshistory"})},1500)):(this.snackbar=!0,this.color="on-background")})):(this.snackbar=!0,this.color="on-background",this.snackbarText="your quantities are exceeded")},getFormattedDate(e){const a=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0");return`${a}-${n}-${t}`},getOutputstockdetails(){this.getOutputstock(this.Soid).then(e=>{this.OutputStockDetails=e.data,console.log("check output dtock",this.OutputStockDetails),this.outputStock.so_number=this.OutputStockDetails.so_number,this.outputStock.merchant_name=this.OutputStockDetails.merchant_name,this.outputStock.so_status="Shipped",this.outputStockproducts=this.OutputStockDetails.products,this.deliveryUserDetails=e.delivery_user_details,console.log("delivery detials",this.deliveryUserDetails),this.deliveryPersons=this.deliveryUserDetails.map(a=>({value:a.delivery_person,text:a.name}))})},resolveStatusVariant(e){return e.warehouse_quantity>=e.ordered_quantity?{color:"success"}:{color:"success"}},deleteRow(e){const a=this.desserts.indexOf(e);a!==-1&&this.desserts.splice(a,1)},openproductdialog(){console.log("check the dialog"),this.dialog=!0},closeDialog(){this.dialog=!1},isQuantityExceeded(e,a,n){const t=Math.min(a,n);return e>t&&e!==0?(this.snackbar=!0,this.color="on-background",this.snackbarText="Shipped quantity cannot exceed ordered or warehouse quantity",!0):!1},isQuantityExceeded2(e,a){return e!=="0"&&e>a?(this.snackbar=!0,this.color="on-background",this.snackbarText="Shipped quantity cannot exceed orderd quantity.",!0):!1}}},A={key:0,class:"loading-container"},W={class:"text-center"},Y={class:"text-center"},G={class:"text-center"},H={class:"text-center"},J={class:"text-center"},X={class:"text-center"};function Z(e,a,n,t,r,d){return p(),m("div",null,[r.loading?(p(),m("div",A,[o(V,{height:"5",color:"primary",indeterminate:"",class:"custom-loader","full-width":""})])):v("",!0),o(b,null,{default:l(()=>[o(h,{cols:"12"},{default:l(()=>[o(D,{title:"Output Stock",class:"mb-4"},{default:l(()=>[o(O,null,{default:l(()=>[o(Q,{class:"mt-6",ref:"purchaseOrderForm"},{default:l(()=>[o(b,null,{default:l(()=>[o(h,{md:"6",cols:"12"},{default:l(()=>[o(_,{modelValue:this.outputStock.so_number,"onUpdate:modelValue":a[0]||(a[0]=s=>this.outputStock.so_number=s),label:"Sales Order",readonly:""},null,8,["modelValue"])]),_:1}),o(h,{cols:"12",md:"6"},{default:l(()=>[o(_,{modelValue:this.outputStock.merchant_name,"onUpdate:modelValue":a[1]||(a[1]=s=>this.outputStock.merchant_name=s),label:"Order From",readonly:""},null,8,["modelValue"])]),_:1}),o(h,{cols:"12",md:"6"},{default:l(()=>[o(_,{modelValue:this.outputStock.shipped_date,"onUpdate:modelValue":a[2]||(a[2]=s=>this.outputStock.shipped_date=s),type:"date",label:"Date",min:r.today},null,8,["modelValue","min"])]),_:1}),o(h,{md:"6",cols:"12"},{default:l(()=>[o(_,{modelValue:this.outputStock.so_status,"onUpdate:modelValue":a[3]||(a[3]=s=>this.outputStock.so_status=s),label:"SO Status",readonly:""},null,8,["modelValue"])]),_:1}),o(h,{md:"6",cols:"12"},{default:l(()=>[o(R,{modelValue:r.selectedDeliveryPerson,"onUpdate:modelValue":a[4]||(a[4]=s=>r.selectedDeliveryPerson=s),label:"Select Delivery Person",items:this.deliveryPersons,"item-value":"value","item-title":"text",rules:r.PersonRules},null,8,["modelValue","items","rules"])]),_:1}),o(h,{cols:"12"},{default:l(()=>[o(B,{headers:r.headers,items:r.OutputStockDetails},{default:l(()=>[i("thead",null,[i("tr",null,[(p(!0),m(y,null,x(r.headers,s=>(p(),m("th",{class:"text-center",key:s},c(s.text),1))),128))])]),i("tbody",null,[(p(!0),m(y,null,x(this.outputStockproducts,(s,u)=>(p(),m("tr",{key:u},[i("td",W,c(s.brand_name),1),i("td",Y,c(s.sku_name),1),i("td",G,c(s.uom),1),i("td",H,c(s.exchange),1),i("td",J,c(s.ordered_quantity),1),i("td",X,[o(N,{color:d.resolveStatusVariant(s).color,class:"font-weight-medium",size:"small"},{default:l(()=>[g(c(s.warehouse_quantity),1)]),_:2},1032,["color"])]),i("td",{class:f(["text-center",{"has-error":d.isQuantityExceeded(s.shipped_ordered,s.ordered_quantity,s.warehouse_quantity)}])},[o(_,{onKeydown:d.preventDecimal,onPaste:d.preventPaste,type:"number",min:"0",max:"20000",rules:r.shippedquantity,modelValue:s.shipped_ordered,"onUpdate:modelValue":k=>s.shipped_ordered=k,outlined:"",dense:""},null,8,["onKeydown","onPaste","rules","modelValue","onUpdate:modelValue"])],2),i("td",{class:f(["text-center",{"has-error":d.isQuantityExceeded2(s.shipped_exchange,s.exchange)}])},[o(_,{onKeydown:d.preventDecimal,onPaste:d.preventPaste,type:"number",min:"0",max:"20000",rules:r.shippedexchange,modelValue:s.shipped_exchange,"onUpdate:modelValue":k=>s.shipped_exchange=k,outlined:"",dense:""},null,8,["onKeydown","onPaste","rules","modelValue","onUpdate:modelValue"])],2)]))),128))])]),_:1},8,["headers","items"])]),_:1}),o(h,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:l(()=>[o(q,{onClick:a[5]||(a[5]=s=>d.validateForm())},{default:l(()=>[g("Save")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),o(K,{modelValue:r.snackbar,"onUpdate:modelValue":a[6]||(a[6]=s=>r.snackbar=s),timeout:3e3,color:r.color},{default:l(()=>[g(c(r.snackbarText),1)]),_:1},8,["modelValue","color"])])}const $=S(j,[["render",Z]]),ee={components:{Outputstock:$},data(){return{currentroute:"",activeTab:"",tabs:[{title:"Create Output Stock",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=w(),this.activeTab=P(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function te(e,a,n,t,r,d){const s=U("Outputstock");return p(),m("div",null,[o(I,{modelValue:r.activeTab,"onUpdate:modelValue":a[0]||(a[0]=u=>r.activeTab=u),"show-arrows":""},{default:l(()=>[(p(!0),m(y,null,x(r.tabs,u=>(p(),F(L,{key:u.icon,value:u.tab},{default:l(()=>[o(C,{size:"20",start:"",icon:u.icon},null,8,["icon"]),g(" "+c(u.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),o(T),o(z,{modelValue:r.activeTab,"onUpdate:modelValue":a[1]||(a[1]=u=>r.activeTab=u),class:"mt-5 disable-tab-transition",touch:!1},{default:l(()=>[o(M,{value:"account"},{default:l(()=>[o(s)]),_:1})]),_:1},8,["modelValue"])])}const pe=S(ee,[["render",te]]);export{pe as default};
