import{_ as S,o as i,c as d,g as o,ba as V,b0 as x,w as r,i as h,j as D,k as O,l as b,m,a as l,F as f,s as y,t as p,b as g,n as v,x as q,e as w,u as T,r as F,f as C,v as U}from"./index.f3c5980a.js";import{s as E}from"./Services.8ccc7918.js";import{V as Q}from"./VForm.52f7a6b8.js";import{V as P}from"./VTable.33dcea60.js";import{V as R}from"./VChip.e64011a9.js";import{V as B}from"./VSnackbar.2f3329b3.js";import{V as K,a as N,b as I,c as M}from"./VWindowItem.73a53de7.js";import"./index.2bd8ddc8.js";const z={mixins:[E],props:["so_id"],data(){return{loading:!1,shippedexchange:[t=>t===0||!!t&&`${t}`.trim()!==""||"shippedexchange Quantity Is Required"],shippedquantity:[t=>t===0||!!t&&`${t}`.trim()!==""||"shipped Quantity Is Required"],snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,selectedPurchaseOrder:null,dialog:!1,Soid:"",OutputStockDetails:[],today:this.getFormattedDate(new Date),outputStock:{so_id:"",so_number:"",merchant_id:"",merchant_code:"",merchant_name:"",total_cgst:"",total_sgst:"",sub_total:"",total_margin:"",total_so_amount:"",total_quantity:"",created_date:"",shipped_date:this.getFormattedDate(new Date),so_status:"",products:[{merchant_product_id:"",sku_name:"",hsn_code:"",mrp:"",margin:"",ordered_quantity:"",warehouse_quantity:"",uom:"",price_per_unit:"",taxable_amount:"",cgst:"",sgst:"",amount:"",sgst_percentage:"",cgst_percentage:"",exchange:"",return:"",shipped_ordered:"",shipped_exchange:""}]},outputStockproducts:[],headers:[{text:"SKU Name",value:"sku_name"},{text:"UOM",value:"uom"},{text:"Exchange Quantity",value:"exchange_quantity"},{text:"Ordered Quantity",value:"ordered_quantity"},{text:"Available",value:"warehouse_quantity"},{text:"Shipped Ordered",value:"shipped_ordered"},{text:"Shipped Exchanged",value:"shipped_exchange"}]}},computed:{totalshippedorder(){return this.outputStockproducts.reduce((t,e)=>t+parseFloat(e.shipped_ordered||0),0)},totalshippedexchange(){return this.outputStockproducts.reduce((t,e)=>t+parseFloat(e.shipped_exchange||0),0)},filteredOutputstocks(){return this.outputStockproducts.filter(t=>t.exchange_quantity>0||t.ordered_quantity>0)}},mounted(){this.Soid=this.$route.query.so_id,console.log("Received po_id:",this.Soid),this.getOutputstockdetails(),setTimeout(()=>{this.loading=!1},2e3)},methods:{validateForm(){this.$refs.purchaseOrderForm.validate().then(t=>{console.log("form valid",t.valid),t.valid==!0?this.saveOutputstock():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="error")})},preventPaste(t){const _=(t.clipboardData||window.clipboardData).getData("text");/^[0-9]+$/.test(_)||t.preventDefault()},preventDecimal(t){(t.key==="."||t.key===","||t.key==="+"||t.key==="-"||t.keyCode===189||t.keyCode===109)&&t.preventDefault()},saveOutputstock(){const t={Draft:1,Created:2,Acknowledged:3,Shipped:4,Delivered:5},e={so_id:this.OutputStockDetails.so_id,so_number:this.outputStock.so_number,so_status:t[this.outputStock.so_status],merchant_id:this.OutputStockDetails.merchant_id,merchant_code:this.OutputStockDetails.merchant_code,merchant_name:this.outputStock.merchant_name,total_cgst:this.OutputStockDetails.total_cgst,total_sgst:this.OutputStockDetails.total_sgst,sub_total:this.OutputStockDetails.sub_total,total_margin:this.OutputStockDetails.total_margin,total_so_amount:this.OutputStockDetails.total_so_amount,total_quantity:this.OutputStockDetails.total_quantity,created_date:this.OutputStockDetails.created_date,shipped_date:this.outputStock.shipped_date,total_shipped_ordered:`${this.totalshippedorder}`,total_shipped_exchanged:`${this.totalshippedexchange}`,products:this.outputStockproducts.map((a,u)=>({merchant_product_id:a.merchant_product_id,sku_name:a.sku_name,hsn_code:a.hsn_code,mrp:a.mrp,margin:a.margin,margin_percentage:a.margin_percentage,quantity:a.ordered_quantity,uom:a.uom,price_per_unit:a.price_per_unit,taxable_amount:a.taxable_amount,cgst:a.cgst,sgst:a.sgst,amount:a.amount,sgst_percentage:a.sgst_percentage,cgst_percentage:a.cgst_percentage,exchange:a.exchange,return:a.return,shipped_ordered:`${a.shipped_ordered}`,shipped_exchange:`${a.shipped_exchange}`}))};console.log("check the post data",e),e.products.filter(a=>(console.log("sit",this.isQuantityExceeded(a.shipped_ordered,a.ordered_quantity)),this.isQuantityExceeded(a.shipped_ordered,a.ordered_quantity)||this.isQuantityExceeded2(a.shipped_exchange,a.exchange))).length===0?(this.loading=!0,this.postOutputstock(e).then(a=>{console.log("check the response",a),a.status==1?(this.snackbar=!0,this.color="success",this.formData={},this.snackbarText=a.message,setTimeout(()=>{this.$router.push({name:"Viewsaleshistory"})},1500)):(this.snackbar=!0,this.color="error")})):(this.snackbar=!0,this.color="error",this.snackbarText="your quantities are exceeded")},getFormattedDate(t){const e=t.getFullYear(),_=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${_}-${a}`},getOutputstockdetails(){this.getOutputstock(this.Soid).then(t=>{this.OutputStockDetails=t.data,console.log("check output dtock",this.OutputStockDetails),this.outputStock.so_number=this.OutputStockDetails.so_number,this.outputStock.merchant_name=this.OutputStockDetails.merchant_name,this.outputStock.so_status="Shipped",this.outputStockproducts=this.OutputStockDetails.products})},resolveStatusVariant(t){return t.warehouse_quantity>=t.ordered_quantity?{color:"success"}:{color:"success"}},deleteRow(t){const e=this.desserts.indexOf(t);e!==-1&&this.desserts.splice(e,1)},openproductdialog(){console.log("check the dialog"),this.dialog=!0},closeDialog(){this.dialog=!1},isQuantityExceeded(t,e){t!=="0"&&t>e&&(this.snackbar=!0,this.color="error",this.snackbarText="Shipped quantity cannot exceed orderd quantity.")},isQuantityExceeded2(t,e){t!=="0"&&t>e&&(this.snackbar=!0,this.color="error",this.snackbarText="Shipped quantity cannot exceed orderd quantity.")}}},A={key:0,class:"loading-container"},L={class:"text-center"},W={class:"text-center"},j={class:"text-center"},Y={class:"text-center"},G={class:"text-center"},H={class:"text-center"},J={key:0},X={class:"text-center"},Z={key:0};function $(t,e,_,a,u,c){return i(),d("div",null,[u.loading?(i(),d("div",A,[o(V,{height:"5",color:"primary",indeterminate:"",class:"custom-loader","full-width":""})])):x("",!0),o(b,null,{default:r(()=>[o(h,{cols:"12"},{default:r(()=>[o(D,{title:"Output Stock",class:"mb-4"},{default:r(()=>[o(O,null,{default:r(()=>[o(Q,{class:"mt-6",ref:"purchaseOrderForm"},{default:r(()=>[o(b,null,{default:r(()=>[o(h,{md:"6",cols:"12"},{default:r(()=>[o(m,{modelValue:this.outputStock.so_number,"onUpdate:modelValue":e[0]||(e[0]=s=>this.outputStock.so_number=s),label:"Sales Order",readonly:""},null,8,["modelValue"])]),_:1}),o(h,{cols:"12",md:"6"},{default:r(()=>[o(m,{modelValue:this.outputStock.merchant_name,"onUpdate:modelValue":e[1]||(e[1]=s=>this.outputStock.merchant_name=s),label:"Order From",readonly:""},null,8,["modelValue"])]),_:1}),o(h,{cols:"12",md:"6"},{default:r(()=>[o(m,{modelValue:this.outputStock.shipped_date,"onUpdate:modelValue":e[2]||(e[2]=s=>this.outputStock.shipped_date=s),type:"date",label:"Date",min:u.today},null,8,["modelValue","min"])]),_:1}),o(h,{md:"6",cols:"12"},{default:r(()=>[o(m,{modelValue:this.outputStock.so_status,"onUpdate:modelValue":e[3]||(e[3]=s=>this.outputStock.so_status=s),label:"SO Status",readonly:""},null,8,["modelValue"])]),_:1}),o(h,{cols:"12"},{default:r(()=>[o(P,{headers:u.headers,items:u.OutputStockDetails},{default:r(()=>[l("thead",null,[l("tr",null,[(i(!0),d(f,null,y(u.headers,s=>(i(),d("th",{class:"text-center",key:s},p(s.text),1))),128))])]),l("tbody",null,[(i(!0),d(f,null,y(this.outputStockproducts,(s,n)=>(i(),d("tr",{key:n},[l("td",L,p(s.sku_name),1),l("td",W,p(s.uom),1),l("td",j,p(s.exchange),1),l("td",Y,p(s.ordered_quantity),1),l("td",G,[o(R,{color:c.resolveStatusVariant(s).color,class:"font-weight-medium",size:"small"},{default:r(()=>[g(p(s.warehouse_quantity),1)]),_:2},1032,["color"])]),l("td",H,[o(m,{onKeydown:c.preventDecimal,onPaste:c.preventPaste,type:"number",min:"0",max:"20000",rules:u.shippedquantity,modelValue:s.shipped_ordered,"onUpdate:modelValue":k=>s.shipped_ordered=k,outlined:"",dense:""},null,8,["onKeydown","onPaste","rules","modelValue","onUpdate:modelValue"])]),c.isQuantityExceeded(s.shipped_ordered,s.ordered_quantity)?(i(),d("span",J)):x("",!0),l("td",X,[o(m,{onKeydown:c.preventDecimal,onPaste:c.preventPaste,type:"number",min:"0",max:"20000",rules:u.shippedexchange,modelValue:s.shipped_exchange,"onUpdate:modelValue":k=>s.shipped_exchange=k,outlined:"",dense:""},null,8,["onKeydown","onPaste","rules","modelValue","onUpdate:modelValue"]),c.isQuantityExceeded2(s.shipped_exchange,s.exchange)?(i(),d("span",Z)):x("",!0)])]))),128))])]),_:1},8,["headers","items"])]),_:1}),o(h,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:r(()=>[o(v,{onClick:e[4]||(e[4]=s=>c.validateForm())},{default:r(()=>[g("Save")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),o(B,{modelValue:u.snackbar,"onUpdate:modelValue":e[5]||(e[5]=s=>u.snackbar=s),timeout:3e3,color:u.color},{default:r(()=>[g(p(u.snackbarText),1)]),_:1},8,["modelValue","color"])])}const tt=S(z,[["render",$]]),et={components:{Outputstock:tt},data(){return{currentroute:"",activeTab:"",tabs:[{title:"Create Output Stock",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=q(),this.activeTab=w(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function at(t,e,_,a,u,c){const s=F("Outputstock");return i(),d("div",null,[o(K,{modelValue:u.activeTab,"onUpdate:modelValue":e[0]||(e[0]=n=>u.activeTab=n),"show-arrows":""},{default:r(()=>[(i(!0),d(f,null,y(u.tabs,n=>(i(),C(M,{key:n.icon,value:n.tab},{default:r(()=>[o(U,{size:"20",start:"",icon:n.icon},null,8,["icon"]),g(" "+p(n.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),o(T),o(I,{modelValue:u.activeTab,"onUpdate:modelValue":e[1]||(e[1]=n=>u.activeTab=n),class:"mt-5 disable-tab-transition",touch:!1},{default:r(()=>[o(N,{value:"account"},{default:r(()=>[o(s)]),_:1})]),_:1},8,["modelValue"])])}const ct=S(et,[["render",at]]);export{ct as default};
