import{_ as S,o as n,c as l,g as o,ba as V,b0 as x,w as r,i as p,j as D,k as O,l as b,m,a as c,F as f,s as y,t as h,b as g,n as v,x as q,e as w,u as T,r as C,f as F,v as E}from"./index.f15db3c3.js";import{s as U}from"./Services.8ccc7918.js";import{V as Q}from"./VForm.0268b04b.js";import{V as P}from"./VTable.901375f2.js";import{V as R}from"./VChip.634aa2cd.js";import{V as B}from"./VSnackbar.fb9cc45a.js";import{V as K,a as N,b as I,c as z}from"./VWindowItem.f7810676.js";import"./index.2bd8ddc8.js";const A={mixins:[U],props:["so_id"],data(){return{loading:!1,shippedexchange:[t=>t===0||!!t&&`${t}`.trim()!==""||"shippedexchange Quantity Is Required"],shippedquantity:[t=>t===0||!!t&&`${t}`.trim()!==""||"shipped Quantity Is Required"],snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,selectedPurchaseOrder:null,dialog:!1,Soid:"",OutputStockDetails:[],today:this.getFormattedDate(new Date),outputStock:{so_id:"",so_number:"",merchant_id:"",merchant_code:"",merchant_name:"",total_cgst:"",total_sgst:"",sub_total:"",total_margin:"",total_so_amount:"",total_quantity:"",created_date:"",shipped_date:this.getFormattedDate(new Date),so_status:"",products:[{merchant_product_id:"",sku_name:"",hsn_code:"",mrp:"",margin:"",ordered_quantity:"",warehouse_quantity:"",uom:"",price_per_unit:"",taxable_amount:"",cgst:"",sgst:"",amount:"",sgst_percentage:"",cgst_percentage:"",exchange:"",return:"",shipped_ordered:"",shipped_exchange:""}]},outputStockproducts:[],headers:[{text:"SKU Name",value:"sku_name"},{text:"Exchange Quantity",value:"exchange_quantity"},{text:"Ordered Quantity",value:"ordered_quantity"},{text:"Available",value:"warehouse_quantity"},{text:"Shipped Ordered",value:"shipped_ordered"},{text:"Shipped Exchanged",value:"shipped_exchange"}]}},computed:{filteredOutputstocks(){return this.outputStockproducts.filter(t=>t.exchange_quantity>0||t.ordered_quantity>0)}},mounted(){this.Soid=this.$route.query.so_id,console.log("Received po_id:",this.Soid),this.getOutputstockdetails(),setTimeout(()=>{this.loading=!1},2e3)},methods:{validateForm(){this.$refs.purchaseOrderForm.validate().then(t=>{console.log("form valid",t.valid),t.valid==!0?this.saveOutputstock():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="error")})},preventPaste(t){const _=(t.clipboardData||window.clipboardData).getData("text");/^[0-9]+$/.test(_)||t.preventDefault()},preventDecimal(t){(t.key==="."||t.key===","||t.key==="+"||t.key==="-"||t.keyCode===189||t.keyCode===109)&&t.preventDefault()},saveOutputstock(){const t={Draft:1,Created:2,Acknowledged:3,Shipped:4,Delivered:5},a={so_id:this.OutputStockDetails.so_id,so_number:this.outputStock.so_number,so_status:t[this.outputStock.so_status],merchant_id:this.OutputStockDetails.merchant_id,merchant_code:this.OutputStockDetails.merchant_code,merchant_name:this.outputStock.merchant_name,total_cgst:this.OutputStockDetails.total_cgst,total_sgst:this.OutputStockDetails.total_sgst,sub_total:this.OutputStockDetails.sub_total,total_margin:this.OutputStockDetails.total_margin,total_so_amount:this.OutputStockDetails.total_so_amount,total_quantity:this.OutputStockDetails.total_quantity,created_date:this.OutputStockDetails.created_date,shipped_date:this.outputStock.shipped_date,products:this.outputStockproducts.map((e,u)=>({merchant_product_id:e.merchant_product_id,sku_name:e.sku_name,hsn_code:e.hsn_code,mrp:e.mrp,margin:e.margin,margin_percentage:e.margin_percentage,quantity:e.ordered_quantity,uom:e.uom,price_per_unit:e.price_per_unit,taxable_amount:e.taxable_amount,cgst:e.cgst,sgst:e.sgst,amount:e.amount,sgst_percentage:e.sgst_percentage,cgst_percentage:e.cgst_percentage,exchange:e.exchange,return:e.return,shipped_ordered:`${e.shipped_ordered}`,shipped_exchange:`${e.shipped_exchange}`}))};console.log("check the post data",a),a.products.filter(e=>(console.log("sit",this.isQuantityExceeded(e.shipped_ordered,e.ordered_quantity)),this.isQuantityExceeded(e.shipped_ordered,e.ordered_quantity)||this.isQuantityExceeded2(e.shipped_exchange,e.exchange))).length===0?(this.loading=!0,this.postOutputstock(a).then(e=>{console.log("check the response",e),e.status==1?(this.snackbar=!0,this.color="success",this.formData={},this.snackbarText=e.message,setTimeout(()=>{this.$router.push({name:"Viewsaleshistory"})},1500)):(this.snackbar=!0,this.color="error")})):(this.snackbar=!0,this.color="error",this.snackbarText="your quantities are exceeded")},getFormattedDate(t){const a=t.getFullYear(),_=String(t.getMonth()+1).padStart(2,"0"),e=String(t.getDate()).padStart(2,"0");return`${a}-${_}-${e}`},getOutputstockdetails(){this.getOutputstock(this.Soid).then(t=>{this.OutputStockDetails=t.data,console.log("check output dtock",this.OutputStockDetails),this.outputStock.so_number=this.OutputStockDetails.so_number,this.outputStock.merchant_name=this.OutputStockDetails.merchant_name,this.outputStock.so_status="Shipped",this.outputStockproducts=this.OutputStockDetails.products})},resolveStatusVariant(t){return console.log("check quan",t.warehouse_quantity>t.ordered_quantity),t.warehouse_quantity>t.ordered_quantity?{color:"success"}:{color:"error"}},deleteRow(t){const a=this.desserts.indexOf(t);a!==-1&&this.desserts.splice(a,1)},openproductdialog(){console.log("check the dialog"),this.dialog=!0},closeDialog(){this.dialog=!1},isQuantityExceeded(t,a){t!=="0"&&t>a&&(this.snackbar=!0,this.color="error",this.snackbarText="Shipped quantity cannot exceed orderd quantity.")},isQuantityExceeded2(t,a){t!=="0"&&t>a&&(this.snackbar=!0,this.color="error",this.snackbarText="Shipped quantity cannot exceed orderd quantity.")}}},L={key:0,class:"loading-container"},M={class:"text-center"},W={class:"text-center"},j={class:"text-center"},Y={class:"text-center"},G={class:"text-center"},H={key:0},J={class:"text-center"},X={key:0};function Z(t,a,_,e,u,d){return n(),l("div",null,[u.loading?(n(),l("div",L,[o(V,{height:"5",color:"primary",indeterminate:"",class:"custom-loader","full-width":""})])):x("",!0),o(b,null,{default:r(()=>[o(p,{cols:"12"},{default:r(()=>[o(D,{title:"Output Stock",class:"mb-4"},{default:r(()=>[o(O,null,{default:r(()=>[o(Q,{class:"mt-6",ref:"purchaseOrderForm"},{default:r(()=>[o(b,null,{default:r(()=>[o(p,{md:"6",cols:"12"},{default:r(()=>[o(m,{modelValue:this.outputStock.so_number,"onUpdate:modelValue":a[0]||(a[0]=s=>this.outputStock.so_number=s),label:"Sales Order",readonly:""},null,8,["modelValue"])]),_:1}),o(p,{cols:"12",md:"6"},{default:r(()=>[o(m,{modelValue:this.outputStock.merchant_name,"onUpdate:modelValue":a[1]||(a[1]=s=>this.outputStock.merchant_name=s),label:"Order From",readonly:""},null,8,["modelValue"])]),_:1}),o(p,{cols:"12",md:"6"},{default:r(()=>[o(m,{modelValue:this.outputStock.shipped_date,"onUpdate:modelValue":a[2]||(a[2]=s=>this.outputStock.shipped_date=s),type:"date",label:"Date",min:u.today},null,8,["modelValue","min"])]),_:1}),o(p,{md:"6",cols:"12"},{default:r(()=>[o(m,{modelValue:this.outputStock.so_status,"onUpdate:modelValue":a[3]||(a[3]=s=>this.outputStock.so_status=s),label:"SO Status",readonly:""},null,8,["modelValue"])]),_:1}),o(p,{cols:"12"},{default:r(()=>[o(P,{headers:u.headers,items:u.OutputStockDetails},{default:r(()=>[c("thead",null,[c("tr",null,[(n(!0),l(f,null,y(u.headers,s=>(n(),l("th",{class:"text-center",key:s},h(s.text),1))),128))])]),c("tbody",null,[(n(!0),l(f,null,y(this.outputStockproducts,(s,i)=>(n(),l("tr",{key:i},[c("td",M,h(s.sku_name),1),c("td",W,h(s.exchange),1),c("td",j,h(s.ordered_quantity),1),c("td",Y,[o(R,{color:d.resolveStatusVariant(s).color,class:"font-weight-medium",size:"small"},{default:r(()=>[g(h(s.warehouse_quantity),1)]),_:2},1032,["color"])]),c("td",G,[o(m,{onKeydown:d.preventDecimal,onPaste:d.preventPaste,type:"number",min:"0",max:"20000",rules:u.shippedquantity,modelValue:s.shipped_ordered,"onUpdate:modelValue":k=>s.shipped_ordered=k,outlined:"",dense:""},null,8,["onKeydown","onPaste","rules","modelValue","onUpdate:modelValue"])]),d.isQuantityExceeded(s.shipped_ordered,s.ordered_quantity)?(n(),l("span",H)):x("",!0),c("td",J,[o(m,{onKeydown:d.preventDecimal,onPaste:d.preventPaste,type:"number",min:"0",max:"20000",rules:u.shippedexchange,modelValue:s.shipped_exchange,"onUpdate:modelValue":k=>s.shipped_exchange=k,outlined:"",dense:""},null,8,["onKeydown","onPaste","rules","modelValue","onUpdate:modelValue"]),d.isQuantityExceeded2(s.shipped_exchange,s.exchange)?(n(),l("span",X)):x("",!0)])]))),128))])]),_:1},8,["headers","items"])]),_:1}),o(p,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:r(()=>[o(v,{onClick:a[4]||(a[4]=s=>d.validateForm())},{default:r(()=>[g("Save")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),o(B,{modelValue:u.snackbar,"onUpdate:modelValue":a[5]||(a[5]=s=>u.snackbar=s),timeout:3e3,color:u.color},{default:r(()=>[g(h(u.snackbarText),1)]),_:1},8,["modelValue","color"])])}const $=S(A,[["render",Z]]),tt={components:{Outputstock:$},data(){return{currentroute:"",activeTab:"",tabs:[{title:"Create Output Stock",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=q(),this.activeTab=w(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function et(t,a,_,e,u,d){const s=C("Outputstock");return n(),l("div",null,[o(K,{modelValue:u.activeTab,"onUpdate:modelValue":a[0]||(a[0]=i=>u.activeTab=i),"show-arrows":""},{default:r(()=>[(n(!0),l(f,null,y(u.tabs,i=>(n(),F(z,{key:i.icon,value:i.tab},{default:r(()=>[o(E,{size:"20",start:"",icon:i.icon},null,8,["icon"]),g(" "+h(i.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),o(T),o(I,{modelValue:u.activeTab,"onUpdate:modelValue":a[1]||(a[1]=i=>u.activeTab=i),class:"mt-5 disable-tab-transition",touch:!1},{default:r(()=>[o(N,{value:"account"},{default:r(()=>[o(s)]),_:1})]),_:1},8,["modelValue"])])}const dt=S(tt,[["render",et]]);export{dt as default};
