import{s as v}from"./Services.7c8f92fc.js";import{_ as x,o as d,c as u,b7 as y,a as i,g as o,w as l,l as V,i as p,F as _,q as f,t as c,m as k,b as P,a4 as D,b9 as S,ac as q,bE as w,bo as C}from"./index.c6e55d50.js";import{V as g}from"./VTextField.a33c464e.js";import{V as I}from"./VTable.b8e8adce.js";import{V as Q}from"./VCheckbox.52196f20.js";import{V as F}from"./VForm.17d95907.js";import{V as O}from"./VPagination.501d14dc.js";const N={mixins:[v],data(){return{quotesdata:[],maxPaginationPages:5,storerules:[e=>!!e||"Store Address is required"],mrprules:[e=>!!e||"MRP is required"],namerules:[e=>!!e||"Name is required"],uomRules:[e=>!!e||"UOM is required"],pinrules:[e=>!!e||"PIN is required"],phonerules:[e=>!!e||" Mobile  is required",e=>/^[0-9]+$/.test(e)||"only number are accepted",e=>e&&e.length<=10&&e.length>=10||"Mobile must be  10 number"],snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,dialog:!1,loading:!0,searchQuery:"",page:1,pageSize:10,products:[],saveProduct:{merchant_uid:"",brand_name:"",sku_name:"",uom:"",hsn_code:"",mrp:"",status:"",brand_id:"",brand_product_id:"",total_given_margin:"",sgst:"",cgst:"",pitch_from:"",final_retail_cp:"",final_ret:"",bk_profit:"",bizkingz_cp_final:"",bc_margin_amt:"",bc_margin:""},salesdata:[],BrandNames:[],CreatedDate:null,today:this.getFormattedDate(new Date),OpportunityProductid:null,selectedBrand:null,userRole:"",createdby:"",loading:!0,OppertunityID:null,isProgress:!1,dateRules:[e=>!!e||"Date is required"],headers:[{text:"Select",value:"actions"},{text:"Brand Name",value:"brand_name"},{text:"Product Name",value:"sku_name"},{text:"UOM",value:"uom"},{text:"Final Retails",value:"final_ret"},{text:"Pitch From",value:"pitch_from"},{text:"Margin",value:"inputs"}]}},computed:{selectedItem(){return this.$store.state.selectedItem},filteredProducts(){const e=this.searchQuery.toLowerCase().trim();return this.quotesdata.filter(a=>a.brand_name&&a.brand_name.toLowerCase().includes(e)||a.sku_name&&a.sku_name.toLowerCase().includes(e)||a.uom&&a.uom.toLowerCase().includes(e))},paginatedItems(){const e=(this.page-1)*this.pageSize,a=e+this.pageSize;return this.filteredProducts.slice(e,a)}},mounted(){this.OppertunityID=this.$route.query.opportunity_id,this.getQuotesdata().then(()=>{this.loading=!1}).catch(e=>{console.error("Error fetching merchants:",e)})},methods:{validateForm(){this.$refs.purchaseOrderForm.validate().then(e=>{e.valid==!0?this.saveQuotedata():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="on-background")})},saveQuotedata(){const e=this.quotesdata.filter(t=>t.selected),a={sales_person:this.selectedItem.user_id,opportunity_products_id:this.OpportunityProductid,opportunity_id:this.OppertunityID,created_date:this.CreatedDate,products:e.map(t=>({brand_id:t.brand_id,brand_product_id:t.brand_product_id,margin:t.sa_given_margin,brand_name:t.brand_name,sku_name:t.sku_name,uom:t.uom,created_date:"",update_date:"",selling_price:""}))};console.log("text",a),this.isProgress=!0,this.saveoppQuotesdata(a).then(t=>{this.isProgress=!1,console.log("Saved items:",t),t.data.status==1?(this.snackbarText=t.data.message,this.color="primary",this.snackbar=!0,this.getQuotesdata().then(()=>{this.loading=!1}).catch(n=>{console.error("Error fetching merchants:",n)})):(this.isProgress=!0,this.snackbarText=t.data.message,this.color="on-background",this.snackbar=!0)}).catch(t=>{console.error("Error saving items:",t),this.snackbarText="Error saving items.",this.color="error",this.snackbar=!0})},getFormattedDate(e){const a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${a}-${t}-${n}`},updatePagination(e){this.page=e},getQuotesdata(){return new Promise((e,a)=>{this.getoppQuotesdata(this.OppertunityID).then(t=>{console.log("check",t),this.OpportunityProductid=t.data.opportunity_products_id,this.quotesdata=t.data.data.map(n=>({...n,selected:n.checked==="checked"})),console.log("Quotes data:",this.quotesdata),this.quotesdata.reverse(),e()}).catch(t=>{console.error("Error fetching merchants:",t),a(t)})})}}},U={key:0,id:"app"},M=w('<div id="loading-bg"><div class="loading-logo"><img src="'+C+'" height="60" width="68" alt="Logo"></div><div class="loading"><div class="effect-1 effects"></div><div class="effect-2 effects"></div><div class="effect-3 effects"></div></div></div>',1),T=[M],z={style:{"max-width":"400px"}},B={class:"text-center"},E={class:"text-center"},R={class:"text-center"},L={class:"text-center"},G={class:"text-center"},A={class:"text-center"},Y={class:"text-center"};function j(e,a,t,n,r,m){return d(),u("div",null,[r.loading?(d(),u("div",U,T)):y("",!0),i("div",z,[o(g,{class:"mb-3",modelValue:r.searchQuery,"onUpdate:modelValue":a[0]||(a[0]=s=>r.searchQuery=s),density:"compact",variant:"solo",label:"Search","append-inner-icon":"mdi-magnify","single-line":"","hide-details":""},null,8,["modelValue"])]),o(F,{class:"mt-6",ref:"purchaseOrderForm"},{default:l(()=>[o(V,null,{default:l(()=>[o(p,{cols:"12",md:"6"},{default:l(()=>[o(g,{modelValue:r.CreatedDate,"onUpdate:modelValue":a[1]||(a[1]=s=>r.CreatedDate=s),type:"date",label:"Order Date",min:r.today,rules:r.dateRules},null,8,["modelValue","min","rules"])]),_:1}),o(p,{cols:"12"},{default:l(()=>[o(I,{headers:r.headers,items:e.oppitems,"item-key":"brand_name",class:"table-rounded",height:"500","fixed-header":""},{default:l(()=>[i("thead",null,[i("tr",null,[(d(!0),u(_,null,f(r.headers,s=>(d(),u("th",{class:"text-center",key:s},c(s.text),1))),128))])]),i("tbody",null,[(d(!0),u(_,null,f(m.paginatedItems,(s,b)=>(d(),u("tr",{key:b},[i("td",B,[o(Q,{modelValue:s.selected,"onUpdate:modelValue":h=>s.selected=h,color:"primary"},null,8,["modelValue","onUpdate:modelValue"])]),i("td",E,c(s.brand_name),1),i("td",R,c(s.sku_name),1),i("td",L,c(s.uom),1),i("td",G,c(s.final_ret),1),i("td",A,c(s.pitch_from),1),i("td",Y,[o(g,{modelValue:s.sa_given_margin,"onUpdate:modelValue":h=>s.sa_given_margin=h},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])]),_:1},8,["headers","items"])]),_:1}),o(p,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:l(()=>[o(k,{onClick:a[2]||(a[2]=s=>m.validateForm())},{default:l(()=>[P("Save")]),_:1}),D(o(S,{size:50,color:"primary",indeterminate:""},null,512),[[q,r.isProgress]])]),_:1})]),_:1})]),_:1},512),o(O,{modelValue:r.page,"onUpdate:modelValue":a[3]||(a[3]=s=>r.page=s),length:Math.ceil(m.filteredProducts.length/r.pageSize),onInput:m.updatePagination,max:r.maxPaginationPages},null,8,["modelValue","length","onInput","max"])])}const ee=x(N,[["render",j]]);export{ee as G};
