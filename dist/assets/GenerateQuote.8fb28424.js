import{s as y}from"./Services.d06bbe8b.js";import{_ as V,o as u,c as m,b8 as P,a as i,g as n,w as d,l as S,i as p,F as g,q as _,t as c,a4 as f,m as w,b,ac as x,b9 as I,bE as q,bo as F}from"./index.871767d0.js";import{V as k}from"./VTextField.aaf29b18.js";import{V as Q}from"./VTable.cd435fce.js";import{V as C}from"./VCheckbox.8eeed972.js";import{V as D}from"./VForm.33d3da31.js";import{V as T}from"./VPagination.6a80a0b8.js";import{V as N}from"./VSnackbar.2c6d9b4a.js";const M={mixins:[y],data(){return{snackbar:!1,snackbarText:"",timeout:6e3,color:"",quotesdata:[],maxPaginationPages:5,storerules:[e=>!!e||"Store Address is required"],mrprules:[e=>!!e||"MRP is required"],namerules:[e=>!!e||"Name is required"],uomRules:[e=>!!e||"UOM is required"],pinrules:[e=>!!e||"PIN is required"],phonerules:[e=>!!e||" Mobile  is required",e=>/^[0-9]+$/.test(e)||"only number are accepted",e=>e&&e.length<=10&&e.length>=10||"Mobile must be  10 number"],snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,dialog:!1,loading:!0,searchQuery:"",page:1,pageSize:10,products:[],saveProduct:{merchant_uid:"",brand_name:"",sku_name:"",uom:"",hsn_code:"",mrp:"",status:"",brand_id:"",brand_product_id:"",total_given_margin:"",sgst:"",cgst:"",pitch_from:"",final_retail_cp:"",final_ret:"",bk_profit:"",bizkingz_cp_final:"",bc_margin_amt:"",bc_margin:""},salesdata:[],BrandNames:[],CreatedDate:null,today:this.getFormattedDate(new Date),OpportunityProductid:null,selectedBrand:null,userRole:"",createdby:"",loading:!0,OppertunityID:null,isProgress:!1,dateRules:[e=>!!e||"Date is required"],headers:[{text:"Select",value:"actions"},{text:"Brand Name",value:"brand_name"},{text:"Product Name",value:"sku_name"},{text:"UOM",value:"uom"},{text:"Pitch From",value:"pitch_from"},{text:"Final Retails",value:"final_ret"},{text:"Margin",value:"inputs"}]}},computed:{selectedItem(){return this.$store.state.selectedItem},filteredProducts(){const e=this.searchQuery.toLowerCase().trim();return this.quotesdata.filter(t=>t.brand_name&&t.brand_name.toLowerCase().includes(e)||t.sku_name&&t.sku_name.toLowerCase().includes(e)||t.uom&&t.uom.toLowerCase().includes(e)||t.final_ret&&t.final_ret.toString().includes(e)||t.pitch_from&&t.pitch_from.toString().includes(e))},paginatedItems(){const e=(this.page-1)*this.pageSize,t=e+this.pageSize;return this.filteredProducts.slice(e,t)}},mounted(){this.OppertunityID=this.$route.query.opportunity_id,this.getQuotesdata().then(()=>{this.loading=!1}).catch(e=>{console.error("Error fetching merchants:",e)})},methods:{updatemargin(e){e==="0%"||e==="0"?this.Addbrand.total_given_margin="0%":e.startsWith("0%")?e="0%":e=e},computedRules(e){return e.selected?this.computedmarginRules(e.pitch_from,e.final_ret):[]},computedmarginRules(e,t){const a=o=>parseFloat(o.replace("%",""));return[o=>!!o||"Margin is required",o=>{const r=a(o),l=a(e),s=a(t);return!isNaN(r)&&r>=l&&r<=s?!0:(this.snackbarText=`Margin should be between ${l}% and ${s}%`,this.snackbar=!0,this.color="on-background","Give Margin Correctly")},o=>o.startsWith("0%")?o==="0%"||"Give numerical value with percentage ":/^(0|([1-9]\d*))(?:\.\d+)?%$/.test(String(o))||"Give numerical value with percentage "]},validateForm(){if(!this.quotesdata.some(t=>t.selected)){this.snackbarText="Please select at least one item",this.color="on-background",this.snackbar=!0;return}this.$refs.purchaseOrderForm.validate().then(t=>{t.valid?this.saveQuotedata():(this.snackbar=!0,this.snackbarText="Please fill out all mandatory fields",this.color="on-background")})},saveQuotedata(){const e=this.quotesdata.filter(a=>a.selected),t={sales_person:this.selectedItem.user_id,opportunity_products_id:this.OpportunityProductid,opportunity_id:this.OppertunityID,products:e.map(a=>({brand_id:a.brand_id,brand_product_id:a.brand_product_id,margin:a.sa_given_margin,brand_name:a.brand_name,sku_name:a.sku_name,uom:a.uom,created_date:"",update_date:"",selling_price:""}))};console.log("text",t),this.isProgress=!0,this.saveoppQuotesdata(t).then(a=>{this.isProgress=!1,console.log("Saved items:",a),a.data.status==1?(this.snackbarText=a.data.message,this.color="primary",this.snackbar=!0,this.getQuotesdata().then(()=>{this.loading=!1}).catch(o=>{console.error("Error fetching merchants:",o)}),setTimeout(()=>{window.location.reload(!0)},1300)):(this.isProgress=!0,this.snackbarText=a.data.message,this.color="on-background",this.snackbar=!0)}).catch(a=>{console.error("Error saving items:",a),this.snackbarText="Error saving items.",this.color="error",this.snackbar=!0})},getFormattedDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${o}`},updatePagination(e){this.page=e},getQuotesdata(){return new Promise((e,t)=>{this.getoppQuotesdata(this.OppertunityID).then(a=>{console.log("check",a),this.OpportunityProductid=a.data.opportunity_products_id,this.quotesdata=a.data.data.map(o=>({...o,selected:o.checked==="checked"})),console.log("Quotes data:",this.quotesdata),this.quotesdata.reverse(),e()}).catch(a=>{console.error("Error fetching merchants:",a),t(a)})})}}},O={key:0,id:"app"},R=q('<div id="loading-bg"><div class="loading-logo"><img src="'+F+'" height="60" width="68" alt="Logo"></div><div class="loading"><div class="effect-1 effects"></div><div class="effect-2 effects"></div><div class="effect-3 effects"></div></div></div>',1),U=[R],z={style:{"max-width":"400px"}},B={class:"text-center"},E={class:"text-center"},L={class:"text-center"},G={class:"text-center"},A={class:"text-center"},W={class:"text-center"},Y={class:"text-center"};function j(e,t,a,o,r,l){return u(),m("div",null,[r.loading?(u(),m("div",O,U)):P("",!0),i("div",z,[n(k,{class:"mb-3",modelValue:r.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=s=>r.searchQuery=s),density:"compact",variant:"solo",label:"Search","append-inner-icon":"mdi-magnify","single-line":"","hide-details":""},null,8,["modelValue"])]),n(D,{class:"mt-6",ref:"purchaseOrderForm"},{default:d(()=>[n(S,null,{default:d(()=>[n(p,{cols:"12"},{default:d(()=>[n(Q,{headers:r.headers,items:e.oppitems,"item-key":"brand_name",class:"table-rounded",height:"500","fixed-header":""},{default:d(()=>[i("thead",null,[i("tr",null,[(u(!0),m(g,null,_(r.headers,s=>(u(),m("th",{class:"text-center",key:s},c(s.text),1))),128))])]),i("tbody",null,[(u(!0),m(g,null,_(l.paginatedItems,(s,v)=>(u(),m("tr",{key:v},[i("td",B,[n(C,{modelValue:s.selected,"onUpdate:modelValue":h=>s.selected=h,color:"primary"},null,8,["modelValue","onUpdate:modelValue"])]),i("td",E,c(s.brand_name),1),i("td",L,c(s.sku_name),1),i("td",G,c(s.uom),1),i("td",A,c(s.pitch_from),1),i("td",W,c(s.final_ret),1),i("td",Y,[n(k,{modelValue:s.sa_given_margin,"onUpdate:modelValue":h=>s.sa_given_margin=h,rules:l.computedRules(s)},null,8,["modelValue","onUpdate:modelValue","rules"])])]))),128))])]),_:1},8,["headers","items"])]),_:1}),n(p,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:d(()=>[f(n(w,{onClick:t[1]||(t[1]=s=>l.validateForm())},{default:d(()=>[b("Save")]),_:1},512),[[x,l.selectedItem.status!="close"]]),f(n(I,{size:50,color:"primary",indeterminate:""},null,512),[[x,r.isProgress]])]),_:1})]),_:1})]),_:1},512),n(T,{modelValue:r.page,"onUpdate:modelValue":t[2]||(t[2]=s=>r.page=s),length:Math.ceil(l.filteredProducts.length/r.pageSize),onInput:l.updatePagination,max:r.maxPaginationPages},null,8,["modelValue","length","onInput","max"]),n(N,{modelValue:r.snackbar,"onUpdate:modelValue":t[3]||(t[3]=s=>r.snackbar=s),timeout:3500,color:r.color},{default:d(()=>[b(c(r.snackbarText),1)]),_:1},8,["modelValue","color"])])}const ae=V(M,[["render",j]]);export{ae as G};
