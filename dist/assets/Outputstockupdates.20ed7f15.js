import{_ as T,o as u,c as h,a as n,g as o,b5 as C,b6 as g,f as k,w as l,i as _,j as D,k as w,b as f,l as b,F as x,q as v,t as d,m as S,u as V,bw as O,a4 as U,b8 as F,ac as Q,bD as E,bn as z,v as A,e as I,s as R,r as L}from"./index.5a39e20f.js";import{s as N}from"./Services.e2d1af32.js";import{V as m}from"./VTextField.bb5325ce.js";import{V as B,a as K}from"./VAlert.42dab8ed.js";import{V as q}from"./VChip.5621e32d.js";import{V as P}from"./VTable.7d557717.js";import{V as M}from"./VForm.942de418.js";import{V as H}from"./VSelect.95ce76ae.js";import{V as W}from"./VDialog.c3dd0c2f.js";import{V as j}from"./VSnackbar.4085c87d.js";import{V as Y}from"./VPagination.a8c700b7.js";import{V as G,a as J,b as X,c as Z}from"./VWindowItem.ad182803.js";import"./index.2bd8ddc8.js";import"./VCheckboxBtn.d11ef4c8.js";const $={mixins:[N],data(){return{validquan:!1,PersonRules:[e=>!!e||"Delivery Person is required"],DateRules:[e=>!!e||"Shipped date is required"],loading:!0,shippedexchange:[e=>e===0||!!e&&`${e}`.trim()!==""||"shippedexchange Quantity Is Required"],shippedquantity:[e=>e===0||!!e&&`${e}`.trim()!==""||"shipped Quantity Is Required"],snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,isProgress:!1,selectedPurchaseOrder:null,dialog:!1,Soid:"",OutputStockDetails:[],today:this.getFormattedDate(new Date),outputStock:{so_id:"",so_number:"",merchant_id:"",merchant_code:"",merchant_name:"",total_cgst:"",total_sgst:"",sub_total:"",total_margin:"",total_so_amount:"",total_quantity:"",created_date:"",shipped_date:this.getFormattedDate(new Date),so_status:"",products:[{merchant_product_id:"",sku_name:"",hsn_code:"",mrp:"",margin:"",ordered_quantity:"",warehouse_quantity:"",uom:"",price_per_unit:"",taxable_amount:"",cgst:"",sgst:"",amount:"",sgst_percentage:"",cgst_percentage:"",exchange:"",return:"",shipped_ordered:"",shipped_exchange:""}],delivery_user_details:[{delivery_person:"",name:""}]},outputStockproducts:[],headers2:[{text:"Brand Name",value:"brand_name"},{text:"SKU Name",value:"sku_name"},{text:"UOM",value:"uom"},{text:"Ordered Quantity",value:"quantity"},{text:"Exchange Quantity",value:"exchange_quantity"},{text:"Return",value:"return"},{text:"Available",value:"warehouse_quantity"},{text:"Shipped Ordered",value:"shipped_ordered"},{text:"Shipped Exchanged",value:"shipped_exchange"}],selectedDeliveryPerson:null,deliveryPersons:[],deliveryUserDetails:[],page:1,pageSize:10,loading2:!1,loaded:!1,loading:!0,saleshistory:[],salesdata:{},searchQuery:"",dialog:!1,headers:[{text:"Sales Order",value:"so_number"},{text:"Order Date",value:"created_date"},{text:"Status",value:"so_status"},{text:"Order From",value:"merchant_name"},{text:"Shipped To",value:"merchant_name"},{text:"Order Value",value:"total_so_amount"},{text:"Action",value:"actions",sortable:!1}]}},computed:{totalshippedorder(){return this.outputStockproducts.reduce((e,s)=>e+parseFloat(s.shipped_ordered||0),0)},totalshippedexchange(){return this.outputStockproducts.reduce((e,s)=>e+parseFloat(s.shipped_exchange||0),0)},filteredOutputstocks(){return this.outputStockproducts.filter(e=>e.exchange_quantity>0||e.quantity>0)},filteredSalesHistory(){const e=this.searchQuery.toLowerCase().trim();return this.saleshistory.filter(s=>s.so_number&&s.so_number.toLowerCase().includes(e)||s.created_date&&s.created_date.toLowerCase().includes(e)||s.so_status&&s.so_status.toLowerCase().includes(e)||s.merchant_name&&s.merchant_name.toLowerCase().includes(e)||s.total_so_amount&&s.total_so_amount.toString().includes(e))},paginatedItems(){const e=(this.page-1)*this.pageSize,s=e+this.pageSize;return this.filteredSalesHistory.slice(e,s)},showNoSalesAlert(){return!this.saleshistory.some(e=>e.so_status==="Acknowledged"||e.so_status==="On Hold")}},mounted(){this.Soid=this.$route.query.so_id,this.getSalesorderdetails().then(()=>{this.loading=!1}).catch(e=>{console.error("Error fetching merchants:",e)})},methods:{validateForm(){this.$refs.purchaseOrderForm.validate().then(e=>{e.valid==!0?this.saveOutputstock():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="on-background")})},preventPaste(e){const i=(e.clipboardData||window.clipboardData).getData("text");/^[0-9]+$/.test(i)||e.preventDefault()},preventDecimal(e){(e.key==="."||e.key===","||e.key==="+"||e.key==="-"||e.keyCode===189||e.keyCode===109)&&e.preventDefault()},saveOutputstock(){const e={Draft:1,Created:2,Acknowledged:3,Shipped:4,Delivered:5},s={so_id:this.OutputStockDetails.so_id,so_number:this.outputStock.so_number,so_status:e[this.outputStock.so_status],merchant_id:this.OutputStockDetails.merchant_id,merchant_code:this.OutputStockDetails.merchant_code,merchant_name:this.outputStock.merchant_name,total_cgst:this.OutputStockDetails.total_cgst,total_sgst:this.OutputStockDetails.total_sgst,sub_total:this.OutputStockDetails.sub_total,total_margin:this.OutputStockDetails.total_margin,total_so_amount:this.OutputStockDetails.total_so_amount,total_quantity:this.OutputStockDetails.total_quantity,created_date:this.OutputStockDetails.created_date,shipped_date:this.outputStock.shipped_date,total_shipped_ordered:`${this.totalshippedorder}`,total_shipped_exchanged:`${this.totalshippedexchange}`,products:this.outputStockproducts.map((a,r)=>({merchant_product_id:a.merchant_product_id,sku_name:a.sku_name,hsn_code:a.hsn_code,mrp:a.mrp,margin:a.margin,margin_percentage:a.margin_percentage,brand_name:a.brand_name,quantity:a.quantity,uom:a.uom,price_per_unit:a.price_per_unit,taxable_amount:a.taxable_amount,cgst:a.cgst,sgst:a.sgst,amount:a.amount,sgst_percentage:a.sgst_percentage,cgst_percentage:a.cgst_percentage,exchange:a.exchange,return:a.return,rtv_reason:a.rtv_reason,shipped_ordered:`${a.shipped_ordered}`,shipped_exchange:`${a.shipped_exchange}`})),delivery_person:this.selectedDeliveryPerson},i=this.outputStockproducts.map(a=>(console.log("Shipped quan",a.shipped_ordered," Ordered Quan",a.quantity," Warehouse Quan",a.warehouse_quantity),this.isQuantityExceeded(a.shipped_ordered,a.quantity,a.warehouse_quantity)||this.isQuantityExceeded2(a.shipped_exchange,a.exchange)));console.log("check",i.length),console.log("Validation Error Length:",i.filter(a=>a).length),console.log("Validation Error :",i.filter(a=>a)),i.filter(a=>a).length===0?(this.loading=!0,this.isProgress=!0,this.postOutputstock(s).then(a=>{a.status==1?(this.snackbar=!0,this.color="primary",this.formData={},this.isProgress=!1,this.snackbarText=a.message,this.dialog=!1,this.selectedDeliveryPerson=null,this.outputStockproducts=[],this.getSalesorderdetails().then(()=>{this.loading=!1}).catch(r=>{console.error("Error fetching merchants:",r)})):(this.snackbar=!0,this.color="on-background",this.snackbarText="Please give proper data")})):(this.snackbar=!0,this.color="on-background",this.snackbarText="your quantities are exceeded")},getFormattedDate(e){const s=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${s}-${i}-${a}`},resolveStatusVariant2(e){return e.warehouse_quantity>=e.quantity?{color:"success"}:{color:"success"}},deleteRow(e){const s=this.desserts.indexOf(e);s!==-1&&this.desserts.splice(s,1)},openproductdialog(){this.dialog=!0},closeDialog(){this.dialog=!1},isQuantityExceeded(e,s,i){const a=Math.min(s,i);return e>a&&e!==0?(this.snackbar=!0,this.color="on-background",this.snackbarText="Shipped quantity cannot exceed ordered or warehouse quantity",!0):!1},isQuantityExceeded2(e,s){return e!=="0"&&e>s?(this.snackbar=!0,this.color="on-background",this.snackbarText="Shipped quantity cannot exceed orderd quantity.",!0):!1},updatePagination(e){this.page=e},getPDFupdate(e){this.loading2=!0,window.open(e,"_blank"),this.loading2=!1},closedialog(){this.dialog=!1,this.outputStockproducts=[],this.outputStock={}},outputstock(e){console.log("check the detials",e),this.dialog=!0,this.outputStock.so_number=e.so_number,this.outputStock.merchant_name=e.merchant_name,this.outputStock.so_status="Shipped",this.outputStockproducts=e.products,console.log("check ",this.outputStockproducts),this.getOutputstock(e.so_id).then(s=>{this.OutputStockDetails=s.data,this.deliveryUserDetails=s.delivery_user_details,this.deliveryPersons=this.deliveryUserDetails.map(i=>({value:i.delivery_person,text:i.name}))})},resolveStatusVariant(e){return e=="Acknowledged"?{color:"warning"}:{color:"error"}},getSalesorderdetails(){return new Promise((e,s)=>{this.getOutputSalesorders().then(i=>{console.log("check sales res",i),this.saleshistory=i.data||[],this.saleshistory.reverse(),e()}).catch(i=>{console.error("Error fetching merchants:",i),s(i)})})}}},ee={style:{"max-width":"400px"}},te={key:0,class:"loading-container"},se=n("p",{class:"mb-0"},' The system is trying to retrieving the Orders. Please ensure that you have "Acknowledged" and "Onhold" Output Stock Orders ! ',-1),ae={key:2,id:"app"},oe=E('<div id="loading-bg"><div class="loading-logo"><img src="'+z+'" height="60" width="68" alt="Logo"></div><div class="loading"><div class="effect-1 effects"></div><div class="effect-2 effects"></div><div class="effect-3 effects"></div></div></div>',1),re=[oe],le={class:"text-center"},ne={class:"text-center"},ie={class:"text-center"},ue={class:"text-center"},de={class:"text-center"},ce={class:"text-center"},he={class:"text-center"},pe={class:"text-center"},_e={class:"text-center"},me={class:"text-center"},ge={class:"text-center"},fe={class:"text-center"},ye={class:"text-center"},ke={class:"text-center"};function xe(e,s,i,a,r,c){return u(),h("div",null,[n("div",ee,[o(m,{class:"mb-3",modelValue:r.searchQuery,"onUpdate:modelValue":s[0]||(s[0]=t=>r.searchQuery=t),density:"compact",variant:"solo",label:"Search","append-inner-icon":"mdi-magnify","single-line":"","hide-details":""},null,8,["modelValue"])]),r.loading2?(u(),h("div",te,[o(C,{height:"5",color:"primary",indeterminate:"",class:"custom-loader","full-width":""})])):g("",!0),!r.saleshistory||r.saleshistory.length===0?(u(),k(b,{key:1},{default:l(()=>[o(_,{cols:"12"},{default:l(()=>[o(D,{title:"Output Stocks View"},{default:l(()=>[o(w,null,{default:l(()=>[o(B,{color:"warning",variant:"tonal",class:"mb-4",border:"top"},{default:l(()=>[o(K,{class:"mb-1"},{default:l(()=>[f(" Are you sure you have Output Stocks? ")]),_:1}),se]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0),r.loading?(u(),h("div",ae,re)):g("",!0),this.saleshistory!=""?(u(),k(P,{key:3,headers:r.headers,items:c.paginatedItems,class:"table-rounded",height:"500","fixed-header":""},{default:l(()=>[n("thead",null,[n("tr",null,[(u(!0),h(x,null,v(r.headers,t=>(u(),h("th",{class:"text-center",key:t},d(t.text),1))),128))])]),n("tbody",null,[(u(!0),h(x,null,v(this.paginatedItems,(t,p)=>(u(),h("tr",{key:p},[n("td",le,d(t.so_number),1),n("td",ne,d(t.created_date),1),n("td",ie,[o(q,{color:c.resolveStatusVariant(t.so_status).color,class:"font-weight-medium",size:"small"},{default:l(()=>[f(d(t.so_status),1)]),_:2},1032,["color"])]),n("td",ue,d(t.merchant_name),1),n("td",de,d(t.merchant_name),1),n("td",ce,d(t.total_so_amount),1),n("td",he,[t.so_status!="Shipped"&&t.so_status!="Delivered"?(u(),k(S,{key:0,icon:"",variant:"text",color:"success",class:"me-2",size:"small"},{default:l(()=>[o(V,{icon:"mdi-invoice-receive-outline",color:"success",size:"30",onClick:y=>c.outputstock(t)},null,8,["onClick"])]),_:2},1024)):g("",!0),t.so_status=="Shipped"||t.so_status=="Delivered"?(u(),k(S,{key:1,icon:"",variant:"text",color:"default",class:"me-2",size:"x-small",onClick:y=>c.getPDFupdate(t.delivery_challan_file)},{default:l(()=>[o(V,{color:"error",icon:"iwwa:file-pdf",size:"26"})]),_:2},1032,["onClick"])):g("",!0)])]))),128))])]),_:1},8,["headers","items"])):g("",!0),o(W,{modelValue:r.dialog,"onUpdate:modelValue":s[7]||(s[7]=t=>r.dialog=t),"max-width":"1000"},{default:l(()=>[o(D,{title:"Proceed To Ship Sales Orders",class:"mb-2"},{default:l(()=>[o(w,null,{default:l(()=>[o(b,null,{default:l(()=>[o(_,{cols:"12"},{default:l(()=>[o(M,{class:"mt-6",ref:"purchaseOrderForm"},{default:l(()=>[o(b,null,{default:l(()=>[o(_,{md:"6",cols:"12"},{default:l(()=>[o(m,{modelValue:this.outputStock.so_number,"onUpdate:modelValue":s[1]||(s[1]=t=>this.outputStock.so_number=t),label:"Sales Order",readonly:""},null,8,["modelValue"])]),_:1}),o(_,{cols:"12",md:"6"},{default:l(()=>[o(m,{modelValue:this.outputStock.merchant_name,"onUpdate:modelValue":s[2]||(s[2]=t=>this.outputStock.merchant_name=t),label:"Order From",readonly:""},null,8,["modelValue"])]),_:1}),o(_,{cols:"12",md:"6"},{default:l(()=>[o(m,{modelValue:this.outputStock.shipped_date,"onUpdate:modelValue":s[3]||(s[3]=t=>this.outputStock.shipped_date=t),type:"date",label:"Date",min:r.today,rules:r.DateRules},null,8,["modelValue","min","rules"])]),_:1}),o(_,{md:"6",cols:"12"},{default:l(()=>[o(m,{modelValue:this.outputStock.so_status,"onUpdate:modelValue":s[4]||(s[4]=t=>this.outputStock.so_status=t),label:"SO Status",readonly:""},null,8,["modelValue"])]),_:1}),o(_,{md:"6",cols:"12"},{default:l(()=>[o(H,{modelValue:r.selectedDeliveryPerson,"onUpdate:modelValue":s[5]||(s[5]=t=>r.selectedDeliveryPerson=t),label:"Select Delivery Person",items:this.deliveryPersons,"item-value":"value","item-title":"text",rules:r.PersonRules},null,8,["modelValue","items","rules"])]),_:1}),o(_,{cols:"12"},{default:l(()=>[o(P,{headers:r.headers,items:r.OutputStockDetails},{default:l(()=>[n("thead",null,[n("tr",null,[(u(!0),h(x,null,v(r.headers2,t=>(u(),h("th",{class:"text-center",key:t},d(t.text),1))),128))])]),n("tbody",null,[(u(!0),h(x,null,v(this.outputStockproducts,(t,p)=>(u(),h("tr",{key:p},[n("td",pe,d(t.brand_name),1),n("td",_e,d(t.sku_name),1),n("td",me,d(t.uom),1),n("td",ge,d(t.quantity),1),n("td",fe,d(t.exchange==""?0:t.exchange),1),n("td",ye,d(t.return),1),n("td",ke,[o(q,{color:c.resolveStatusVariant2(t).color,class:"font-weight-medium",size:"small"},{default:l(()=>[f(d(t.warehouse_quantity>=0?t.warehouse_quantity:0),1)]),_:2},1032,["color"])]),n("td",{class:O(["text-center",{"has-error":c.isQuantityExceeded(t.shipped_ordered,t.quantity,t.warehouse_quantity)}])},[o(m,{onKeydown:c.preventDecimal,onPaste:c.preventPaste,type:"number",min:"0",max:"20000",rules:r.shippedquantity,modelValue:t.shipped_ordered,"onUpdate:modelValue":y=>t.shipped_ordered=y,outlined:"",dense:""},null,8,["onKeydown","onPaste","rules","modelValue","onUpdate:modelValue"])],2),n("td",{class:O(["text-center",{"has-error":c.isQuantityExceeded2(t.shipped_exchange,t.exchange)}])},[o(m,{onKeydown:c.preventDecimal,onPaste:c.preventPaste,type:"number",min:"0",max:"20000",rules:r.shippedexchange,modelValue:t.shipped_exchange,"onUpdate:modelValue":y=>t.shipped_exchange=y,outlined:"",dense:""},null,8,["onKeydown","onPaste","rules","modelValue","onUpdate:modelValue"])],2)]))),128))])]),_:1},8,["headers","items"])]),_:1}),o(_,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:l(()=>[o(S,{onClick:s[6]||(s[6]=t=>c.validateForm())},{default:l(()=>[f("Save")]),_:1}),U(o(F,{size:50,color:"primary",indeterminate:""},null,512),[[Q,r.isProgress]])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(j,{modelValue:r.snackbar,"onUpdate:modelValue":s[8]||(s[8]=t=>r.snackbar=t),timeout:3e3,color:r.color},{default:l(()=>[f(d(r.snackbarText),1)]),_:1},8,["modelValue","color"]),o(Y,{modelValue:r.page,"onUpdate:modelValue":s[9]||(s[9]=t=>r.page=t),length:Math.ceil(c.filteredSalesHistory.length/r.pageSize),onInput:c.updatePagination},null,8,["modelValue","length","onInput"])])}const ve=T($,[["render",xe]]),be={components:{Outputstockupdate:ve},data(){return{currentroute:"",activeTab:"",tabs:[{title:"Acknowledged Sales Orders",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=A(),this.activeTab=I(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function Se(e,s,i,a,r,c){const t=L("Outputstockupdate");return u(),h("div",null,[o(G,{modelValue:r.activeTab,"onUpdate:modelValue":s[0]||(s[0]=p=>r.activeTab=p),"show-arrows":""},{default:l(()=>[(u(!0),h(x,null,v(r.tabs,p=>(u(),k(Z,{key:p.icon,value:p.tab},{default:l(()=>[o(V,{size:"20",start:"",icon:p.icon},null,8,["icon"]),f(" "+d(p.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),o(R),o(X,{modelValue:r.activeTab,"onUpdate:modelValue":s[1]||(s[1]=p=>r.activeTab=p),class:"mt-5 disable-tab-transition",touch:!1},{default:l(()=>[o(J,{value:"account"},{default:l(()=>[o(t)]),_:1})]),_:1},8,["modelValue"])])}const Ie=T(be,[["render",Se]]);export{Ie as default};
