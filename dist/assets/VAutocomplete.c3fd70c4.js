import{m as U}from"./VSelect.53493482.js";import{ah as $,D as M,ao as z,al as B,b0 as G,a1 as Q,aj as W,a3 as X,e as x,W as D,aG as Y,H as E,af as R,J as Z,g as s,F as H,aH as q,R as j,aI as ee,aJ as N,aK as te,b as le,ag as ae}from"./index.fe0f4396.js";import{V as ne}from"./VCheckboxBtn.7877dafe.js";import{V as ue}from"./VChip.d98fb3cc.js";import{V as oe}from"./VTextField.a9260b85.js";const se=(e,u,t)=>e==null||u==null?-1:e.toString().toLocaleLowerCase().indexOf(u.toString().toLocaleLowerCase()),re=$({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function ie(e,u,t){var m,p;const y=[],g=(m=t==null?void 0:t.default)!=null?m:se,v=t!=null&&t.filterKeys?B(t.filterKeys):!1,f=Object.keys((p=t==null?void 0:t.customKeyFilter)!=null?p:{}).length;if(!(e!=null&&e.length))return y;e:for(let k=0;k<e.length;k++){const n=e[k],i={},h={};let c=-1;if(u&&!(t!=null&&t.noFilter)){if(typeof n=="object"){const w=v||Object.keys(n);for(const C of w){var o;const L=G(n,C,n),I=t==null||(o=t.customKeyFilter)==null?void 0:o[C];if(c=I?I(L,u,n):g(L,u,n),c!==-1&&c!==!1)I?i[C]=c:h[C]=c;else if((t==null?void 0:t.filterMode)==="every")continue e}}else c=g(n,u,n),c!==-1&&c!==!1&&(h.title=c);const V=Object.keys(h).length,b=Object.keys(i).length;if(!V&&!b||(t==null?void 0:t.filterMode)==="union"&&b!==f&&!V||(t==null?void 0:t.filterMode)==="intersection"&&(b!==f||!V))continue}y.push({index:k,matches:{...h,...i}})}return y}function ce(e,u,t){const y=M(()=>typeof(t==null?void 0:t.value)!="string"&&typeof(t==null?void 0:t.value)!="number"?"":String(t.value));return{filteredItems:M(()=>{const v=z(u);return ie(v,y.value,{customKeyFilter:e.customKeyFilter,default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}).map(o=>{let{index:m,matches:p}=o;return{item:v[m],matches:p}})})}}function fe(e,u,t){if(Array.isArray(u))throw new Error("Multiple matches is not implemented");return typeof u=="number"&&~u?s(H,null,[s("span",{class:"v-autocomplete__unmask"},[e.substr(0,u)]),s("span",{class:"v-autocomplete__mask"},[e.substr(u,t)]),s("span",{class:"v-autocomplete__unmask"},[e.substr(u+t)])]):e}const ge=Q()({name:"VAutocomplete",props:{search:String,...re({filterKeys:["title"]}),...U(),...W({transition:!1})},emits:{"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,u){let{slots:t}=u;const{t:y}=X(),g=x(),v=x(!1),f=x(!0),o=D(e,"menu"),{items:m,transformIn:p,transformOut:k}=Y(e),n=D(e,"search",""),i=D(e,"modelValue",[],l=>p(B(l)),l=>{var a;const r=k(l);return e.multiple?r:(a=r[0])!=null?a:null}),{filteredItems:h}=ce(e,m,M(()=>f.value?void 0:n.value)),c=M(()=>i.value.map(l=>m.value.find(r=>r.value===l.value)||l)),V=M(()=>c.value.map(l=>l.props.value));function b(l){i.value=[],e.openOnClear&&(o.value=!0),n.value=""}function w(){e.hideNoData&&!m.value.length||e.readonly||(o.value=!0)}function C(l){e.readonly||(["Enter","ArrowDown"].includes(l.key)&&(o.value=!0),["Escape"].includes(l.key)&&(o.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(f.value=!0))}function L(l){n.value=l.target.value}function I(){v.value&&(f.value=!0)}const _=x(!1);function S(l){if(e.multiple){const r=V.value.findIndex(a=>a===l.value);if(r===-1)i.value=[...i.value,l],n.value="";else{const a=[...i.value];a.splice(r,1),i.value=a}}else i.value=[l],_.value=!0,n.value=l.title,o.value=!1,f.value=!0,R(()=>_.value=!1)}return E(v,l=>{var a;if(l){var r;_.value=!0,n.value=e.multiple?"":String((a=(r=c.value.at(-1))==null?void 0:r.props.title)!=null?a:""),f.value=!0,R(()=>_.value=!1)}else o.value=!1,n.value=""}),E(n,l=>{!v.value||_.value||(l&&(o.value=!0),f.value=!l)}),Z(()=>{const l=!!(e.chips||t.chip);return s(oe,{ref:g,modelValue:n.value,"onUpdate:modelValue":r=>{r==null&&(i.value=[])},validationValue:i.externalValue,dirty:i.value.length>0,onInput:L,class:["v-autocomplete",{"v-autocomplete--active-menu":o.value,"v-autocomplete--chips":!!e.chips,[`v-autocomplete--${e.multiple?"multiple":"single"}`]:!0}],appendInnerIcon:e.menuIcon,readonly:e.readonly,"onClick:clear":b,"onClick:control":w,"onClick:input":w,onFocus:()=>v.value=!0,onBlur:()=>v.value=!1,onKeydown:C},{...t,default:()=>{var r;return s(H,null,[s(q,j({modelValue:o.value,"onUpdate:modelValue":a=>o.value=a,activator:"parent",contentClass:"v-autocomplete__content",eager:e.eager,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:I},e.menuProps),{default:()=>[s(ee,{selected:V.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:a=>a.preventDefault()},{default:()=>{var a;return[!h.value.length&&!e.hideNoData&&((a=(r=t["no-data"])==null?void 0:r.call(t))!=null?a:s(N,{title:y(e.noDataText)},null)),h.value.map((F,P)=>{var T;var K;let{item:d,matches:J}=F;return(T=(K=t.item)==null?void 0:K.call(t,{item:d,index:P,props:j(d.props,{onClick:()=>S(d)})}))!=null?T:s(N,j({key:P},d.props,{onClick:()=>S(d)}),{prepend:A=>{let{isSelected:O}=A;return e.multiple&&!e.hideSelected?s(ne,{modelValue:O,ripple:!1},null):void 0},title:()=>{var O;var A;return f.value?d.title:fe(d.title,J.title,(O=(A=n.value)==null?void 0:A.length)!=null?O:0)}})})]}})]}),c.value.map((a,F)=>{function P(d){d.stopPropagation(),d.preventDefault(),S(a)}const K={"onClick:close":P,modelValue:!0};return s("div",{key:F,class:"v-autocomplete__selection"},[l?s(te,{defaults:{VChip:{closable:e.closableChips,size:"small",text:a.title}}},{default:()=>[t.chip?t.chip({item:a,index:F,props:K}):s(ue,K,null)]}):t.selection?t.selection({item:a,index:F}):s("span",{class:"v-autocomplete__selection-text"},[a.title,e.multiple&&F<c.value.length-1&&s("span",{class:"v-autocomplete__selection-comma"},[le(",")])])])})])}})}),ae({isFocused:v,isPristine:f,menu:o,search:n,filteredItems:h,select:S},g)}});export{ge as V};
