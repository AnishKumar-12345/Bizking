import{_ as S,o as i,c as d,g as e,b8 as _,f as k,w as a,i as m,j as v,k as b,b as c,l as p,a4 as O,ac as T,a as u,F as x,q as w,t as f,m as g,u as I,bE as P,bo as H,v as F,e as L,s as N,r as z}from"./index.63ed705c.js";import{s as B}from"./Services.d7ada92e.js";import{V as R}from"./VTextField.a8834186.js";import{V as U,a as A}from"./VAlert.6f8f8f4e.js";import{V as y}from"./VForm.befd28a7.js";import{V as E}from"./VAutocomplete.a4d5f8d1.js";import{V as Q}from"./VChip.1a008a36.js";import{V as q}from"./VTable.c39d852b.js";import{V as j}from"./VPagination.5ad69157.js";import{V as C}from"./VDialog.4feaf46f.js";import{V as M}from"./VTextarea.a577205e.js";import{V as W}from"./VSnackbar.97739491.js";import{V as Z,a as G,b as K,c as Y}from"./VWindowItem.ef4f59bf.js";import"./VSelect.9c9b9fcf.js";import"./VCheckboxBtn.17aef2e9.js";const J={mixins:[B],data(){return{snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,cancelOrderdetails:{po_id:"",cancel_reason:"",po_status:6},cancelOrder:{},dialog:!1,dialog2:!1,searchQuery:"",page:1,pageSize:10,userRoles:"",loading:!1,purchaseHistory:[],userIds:"",createdBy:"",workingRules:[s=>!!s||"Cancel Reason is required"],locationID:"",cityID:"",cityLoaction:[],filterlocation:!0,locationdata:"",headers:[{text:"PO Number",value:"po_number"},{text:"Order Date",value:"created_date"},{text:"Status",value:"po_status"},{text:"Order To",value:"brand_name"},{text:"Shipped To",value:"brand_name"},{text:"Action",value:"actions"}]}},computed:{filteredPurchaseHistory(){const s=this.searchQuery.toLowerCase().trim();return this.purchaseHistory.filter(t=>{const n=t.po_number&&t.po_number.toLowerCase().includes(s)||t.created_date&&t.created_date.toLowerCase().includes(s)||t.po_status&&t.po_status.toLowerCase().includes(s)||t.brand_name&&t.brand_name.toLowerCase().includes(s),V=t.po_status==="Acknowledged";return n&&V})},paginatedItems(){const s=(this.page-1)*this.pageSize,t=s+this.pageSize;return this.filteredPurchaseHistory.slice().sort((V,o)=>new Date(o.created_date)-new Date(V.created_date)).slice(s,t)}},mounted(){this.cityID=localStorage.getItem("city_id"),this.locationID=localStorage.getItem("location_id"),this.handleBrandSelection(),this.createdBy=localStorage.getItem("createdby"),this.userIds=localStorage.getItem("userId"),this.userRoles=localStorage.getItem("userRole"),this.getPurchasehistorydetails().then(()=>{this.loading=!1}).catch(s=>{console.error("Error fetching merchants:",s)})},methods:{locationdetails(){this.loading=!0,this.getPurchaseorder(this.cityID,this.locationdata).then(s=>{console.log("check the get res",s),s.status==1?(this.purchaseHistory=s.data,this.purchaseHistory.reverse(),this.loading=!1):this.loading=!1})},handleBrandSelection(){this.getCitylocation(this.cityID).then(s=>{this.cityLoaction=s.data.data.map(t=>({value:t.location_id,text:t.location}))})},validateForm2(){this.$refs.purchaseOrderForm2.validate().then(s=>{s.valid==!0?this.cancelordersata():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="on-background")})},cancelordersata(){console.log("check te data",this.cancelOrder.po_id);const s={po_id:this.cancelOrder.po_id,cancel_reason:this.cancelOrderdetails.cancel_reason,po_status:6};console.log("check the data",s),this.Cancelpurchaseorder(s).then(t=>{console.log("details data",t),t.data.status==1?(this.snackbar=!0,this.color="primary",this.cancelOrderdetails={},this.snackbarText=t.data.message,this.getPurchasehistorydetails().then(()=>{this.loading=!1}).catch(n=>{console.error("Error fetching merchants:",n)}),this.dialog2=!1):(this.snackbar=!0,this.color="on-background")})},closeDialog2(){this.dialog2=!1,this.cancelOrderdetails={}},validateForm(){this.dialog2=!0,this.dialog=!1},closeDialog(){this.dialog=!1},cancelstock(s){this.dialog=!0,console.log("test",s),this.cancelOrder=s},updatePagination(s){this.page=s},inputstock(s){this.$router.push({name:"Createwarehouseinput",query:{po_id:s.po_id}})},getPurchasehistorydetails(){return new Promise((s,t)=>{this.cityID!=""&&this.locationID!==""&&(this.loading=!0,this.filterlocation=!1,this.getPurchaseorder(this.cityID,this.locationID).then(n=>{this.purchaseHistory=n.data,this.purchaseHistory.reverse(),s()}).catch(n=>{console.error("Error fetching merchants:",n),t(n)}))})},resolveStatusVariant(s){return s=="Acknowledged"?{color:"warning"}:s=="Shared"?{color:"info"}:{color:"success"}}}},X={key:0,style:{"max-width":"400px"}},$={key:1,id:"app"},ee=P('<div id="loading-bg"><div class="loading-logo"><img src="'+H+'" height="60" width="68" alt="Logo"></div><div class="loading"><div class="effect-1 effects"></div><div class="effect-2 effects"></div><div class="effect-3 effects"></div></div></div>',1),te=[ee],ae=u("p",{class:"mb-0"}," The system is not retrieving the Purchase Histories from Purchase Orders. Please ensure that you have applied for Purchase Orders !",-1),se={key:0},le=u("td",{colspan:"16",class:"text-center"},[u("h1",null,"No data found !")],-1),oe=[le],re={class:"text-center"},ie={class:"text-center"},ne={class:"text-center"},ce={class:"text-center"},de={class:"text-center"},ue={key:0,class:"text-center",style:{display:"flex","justify-content":"center","align-items":"center"}};function he(s,t,n,V,o,r){return i(),d("div",null,[this.purchaseHistory!=null?(i(),d("div",X,[e(R,{class:"mb-3",modelValue:o.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=l=>o.searchQuery=l),density:"compact",variant:"solo",label:"Search","append-inner-icon":"mdi-magnify","single-line":"","hide-details":""},null,8,["modelValue"])])):_("",!0),o.loading?(i(),d("div",$,te)):_("",!0),this.purchaseHistory==null?(i(),k(p,{key:2},{default:a(()=>[e(m,{cols:"12"},{default:a(()=>[e(v,{title:"Purchase Order View"},{default:a(()=>[e(b,null,{default:a(()=>[e(U,{color:"warning",variant:"tonal",class:"mb-4",border:"top"},{default:a(()=>[e(A,{class:"mb-1"},{default:a(()=>[c(" Are you sure you gave Purchase Orders? ")]),_:1}),ae]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):_("",!0),O(e(v,{class:"mb-2"},{default:a(()=>[e(b,null,{default:a(()=>[e(p,null,{default:a(()=>[e(m,{cols:"12"},{default:a(()=>[e(y,{class:"mt-6"},{default:a(()=>[e(p,null,{default:a(()=>[e(m,{md:"6",cols:"12"},{default:a(()=>[e(E,{modelValue:o.locationdata,"onUpdate:modelValue":[t[1]||(t[1]=l=>o.locationdata=l),t[2]||(t[2]=l=>r.locationdetails())],label:"Location",items:this.cityLoaction,"item-value":"value","item-title":"text","menu-props":{maxHeight:200}},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512),[[T,o.filterlocation]]),this.purchaseHistory!=null?(i(),k(q,{key:3,headers:o.headers,items:r.paginatedItems,"item-key":"dessert",class:"table-rounded",height:"500","fixed-header":""},{default:a(()=>[u("thead",null,[u("tr",null,[(i(!0),d(x,null,w(o.headers,l=>(i(),d("th",{class:"text-center",key:l},f(l.text),1))),128))])]),u("tbody",null,[r.filteredPurchaseHistory.length===0?(i(),d("tr",se,oe)):_("",!0),(i(!0),d(x,null,w(r.paginatedItems,(l,h)=>(i(),d("tr",{key:h},[u("td",re,f(l.po_number),1),u("td",ie,f(l.created_date),1),u("td",ne,[e(Q,{color:r.resolveStatusVariant(l.po_status).color,class:"font-weight-medium",size:"small"},{default:a(()=>[c(f(l.po_status),1)]),_:2},1032,["color"])]),u("td",ce,f(l.brand_name),1),u("td",de,f(l.brand_name==l.brand_name?"Mauriya Spiritual & Naturals(BIZKINGZ)":l.brand_name),1),l.po_status!="Received"?(i(),d("td",ue,[e(g,{icon:"",variant:"text",color:"error",class:"me-2",size:"small"},{default:a(()=>[e(I,{icon:"material-symbols:cancel-outline",color:"error",size:"30",onClick:D=>r.cancelstock(l)},null,8,["onClick"])]),_:2},1024),e(g,{icon:"",variant:"text",color:"success",class:"me-2",size:"small"},{default:a(()=>[e(I,{icon:"mdi-invoice-receive-outline",color:"success",size:"30",onClick:D=>r.inputstock(l)},null,8,["onClick"])]),_:2},1024)])):_("",!0)]))),128))])]),_:1},8,["headers","items"])):_("",!0),e(j,{modelValue:o.page,"onUpdate:modelValue":t[3]||(t[3]=l=>o.page=l),length:Math.ceil(r.filteredPurchaseHistory.length/o.pageSize),onInput:r.updatePagination},null,8,["modelValue","length","onInput"]),e(C,{modelValue:o.dialog,"onUpdate:modelValue":t[5]||(t[5]=l=>o.dialog=l),"max-width":"400",persistent:""},{default:a(()=>[e(v,{title:"Cancel Order",class:"mb-2"},{default:a(()=>[e(b,null,{default:a(()=>[e(p,null,{default:a(()=>[e(m,{cols:"12"},{default:a(()=>[e(y,{class:"mt-4",ref:"purchaseOrderForm"},{default:a(()=>[e(p,null,{default:a(()=>[e(m,{md:"12",cols:"12"},{default:a(()=>[c(" Are you sure want to cancel the order ? ")]),_:1}),e(m,{md:"12",cols:"12"},{default:a(()=>[e(g,{onClick:r.validateForm},{default:a(()=>[c("Yes")]),_:1},8,["onClick"]),c(" \xA0 "),e(g,{color:"secondary",variant:"tonal",onClick:t[4]||(t[4]=l=>r.closeDialog())},{default:a(()=>[c(" No ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(C,{modelValue:o.dialog2,"onUpdate:modelValue":t[8]||(t[8]=l=>o.dialog2=l),"max-width":"500",persistent:""},{default:a(()=>[e(v,{title:"Cancel Order",class:"mb-2"},{default:a(()=>[e(b,null,{default:a(()=>[e(p,null,{default:a(()=>[e(m,{cols:"12"},{default:a(()=>[e(y,{class:"mt-4",ref:"purchaseOrderForm2"},{default:a(()=>[e(p,null,{default:a(()=>[e(m,{md:"12",cols:"12"},{default:a(()=>[e(M,{modelValue:this.cancelOrderdetails.cancel_reason,"onUpdate:modelValue":t[6]||(t[6]=l=>this.cancelOrderdetails.cancel_reason=l),label:"Cancel Reason","row-height":"30",rows:"4",variant:"filled","auto-grow":"",shaped:"",rules:o.workingRules},null,8,["modelValue","rules"])]),_:1}),e(m,{md:"12",cols:"12"},{default:a(()=>[e(g,{onClick:r.validateForm2},{default:a(()=>[c("Save")]),_:1},8,["onClick"]),c(" \xA0 "),e(g,{color:"secondary",variant:"tonal",onClick:t[7]||(t[7]=l=>r.closeDialog2())},{default:a(()=>[c(" No ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(W,{modelValue:o.snackbar,"onUpdate:modelValue":t[9]||(t[9]=l=>o.snackbar=l),timeout:2e3,color:o.color},{default:a(()=>[c(f(o.snackbarText),1)]),_:1},8,["modelValue","color"])])}const me=S(J,[["render",he]]),fe={components:{Viewpurchasehistories:me},data(){return{currentroute:"",activeTab:"",tabs:[{title:"View Input Stocks",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=F(),this.activeTab=L(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function pe(s,t,n,V,o,r){const l=z("Viewpurchasehistories");return i(),d("div",null,[e(Z,{modelValue:o.activeTab,"onUpdate:modelValue":t[0]||(t[0]=h=>o.activeTab=h),"show-arrows":""},{default:a(()=>[(i(!0),d(x,null,w(o.tabs,h=>(i(),k(Y,{key:h.icon,value:h.tab},{default:a(()=>[e(I,{size:"20",start:"",icon:h.icon},null,8,["icon"]),c(" "+f(h.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),e(N),e(K,{modelValue:o.activeTab,"onUpdate:modelValue":t[1]||(t[1]=h=>o.activeTab=h),class:"mt-5 disable-tab-transition",touch:!1},{default:a(()=>[e(G,{value:"account"},{default:a(()=>[e(l)]),_:1})]),_:1},8,["modelValue"])])}const Pe=S(fe,[["render",pe]]);export{Pe as default};
