import{_ as T,o,c as d,g as e,b7 as _,f as y,w as a,i as f,j as b,k as v,b as c,l as V,a as u,F as k,q as x,t as m,m as p,u as w,bE as S,bo as P,v as H,e as D,s as F,r as N}from"./index.c6e55d50.js";import{s as R}from"./Services.7c8f92fc.js";import{V as z}from"./VTextField.a33c464e.js";import{V as B,a as U}from"./VAlert.65989a9a.js";import{V as A}from"./VChip.7976f28d.js";import{V as L}from"./VTable.b8e8adce.js";import{V as E}from"./VPagination.501d14dc.js";import{V as C}from"./VForm.17d95907.js";import{V as O}from"./VDialog.2ac72160.js";import{V as Q}from"./VTextarea.bf02336c.js";import{V as q}from"./VSnackbar.2d72e322.js";import{V as j,a as M,b as W,c as Z}from"./VWindowItem.42eb66e9.js";const G={mixins:[R],data(){return{snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,cancelOrderdetails:{po_id:"",cancel_reason:"",po_status:6},cancelOrder:{},dialog:!1,dialog2:!1,searchQuery:"",page:1,pageSize:10,userRoles:"",loading:!0,purchaseHistory:[],userIds:"",createdBy:"",workingRules:[s=>!!s||"Cancel Reason is required"],headers:[{text:"PO Number",value:"po_number"},{text:"Order Date",value:"created_date"},{text:"Status",value:"po_status"},{text:"Order To",value:"brand_name"},{text:"Shipped To",value:"brand_name"},{text:"Action",value:"actions"}]}},computed:{filteredPurchaseHistory(){const s=this.searchQuery.toLowerCase().trim();return this.purchaseHistory.filter(t=>{const n=t.po_number&&t.po_number.toLowerCase().includes(s)||t.created_date&&t.created_date.toLowerCase().includes(s)||t.po_status&&t.po_status.toLowerCase().includes(s)||t.brand_name&&t.brand_name.toLowerCase().includes(s),g=t.po_status==="Acknowledged";return n&&g})},paginatedItems(){const s=(this.page-1)*this.pageSize,t=s+this.pageSize;return this.filteredPurchaseHistory.slice().sort((g,l)=>new Date(l.created_date)-new Date(g.created_date)).slice(s,t)}},mounted(){this.createdBy=localStorage.getItem("createdby"),this.userIds=localStorage.getItem("userId"),this.userRoles=localStorage.getItem("userRole"),this.getPurchasehistorydetails().then(()=>{this.loading=!1}).catch(s=>{console.error("Error fetching merchants:",s)})},methods:{validateForm2(){this.$refs.purchaseOrderForm2.validate().then(s=>{s.valid==!0?this.cancelordersata():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="on-background")})},cancelordersata(){console.log("check te data",this.cancelOrder.po_id);const s={po_id:this.cancelOrder.po_id,cancel_reason:this.cancelOrderdetails.cancel_reason,po_status:6};console.log("check the data",s),this.Cancelpurchaseorder(s).then(t=>{console.log("details data",t),t.data.status==1?(this.snackbar=!0,this.color="primary",this.cancelOrderdetails={},this.snackbarText=t.data.message,this.getPurchasehistorydetails().then(()=>{this.loading=!1}).catch(n=>{console.error("Error fetching merchants:",n)}),this.dialog2=!1):(this.snackbar=!0,this.color="on-background")})},closeDialog2(){this.dialog2=!1,this.cancelOrderdetails={}},validateForm(){this.dialog2=!0,this.dialog=!1},closeDialog(){this.dialog=!1},cancelstock(s){this.dialog=!0,console.log("test",s),this.cancelOrder=s},updatePagination(s){this.page=s},inputstock(s){this.$router.push({name:"Createwarehouseinput",query:{po_id:s.po_id}})},getPurchasehistorydetails(){return new Promise((s,t)=>{this.getPurchaseorder(this.userIds,this.userRoles).then(n=>{this.purchaseHistory=n.data,this.purchaseHistory.reverse(),s()}).catch(n=>{console.error("Error fetching merchants:",n),t(n)})})},resolveStatusVariant(s){return s=="Acknowledged"?{color:"warning"}:s=="Shared"?{color:"info"}:{color:"success"}}}},K={key:0,style:{"max-width":"400px"}},Y={key:1,id:"app"},J=S('<div id="loading-bg"><div class="loading-logo"><img src="'+P+'" height="60" width="68" alt="Logo"></div><div class="loading"><div class="effect-1 effects"></div><div class="effect-2 effects"></div><div class="effect-3 effects"></div></div></div>',1),X=[J],$=u("p",{class:"mb-0"}," The system is not retrieving the Purchase Histories from Purchase Orders. Please ensure that you have applied for Purchase Orders !",-1),ee={key:0},te=u("td",{colspan:"16",class:"text-center"},[u("h1",null,"No data found !")],-1),ae=[te],se={class:"text-center"},re={class:"text-center"},le={class:"text-center"},oe={class:"text-center"},ie={class:"text-center"},ne={key:0,class:"text-center",style:{display:"flex","justify-content":"center","align-items":"center"}};function ce(s,t,n,g,l,i){return o(),d("div",null,[this.purchaseHistory!=null?(o(),d("div",K,[e(z,{class:"mb-3",modelValue:l.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=r=>l.searchQuery=r),density:"compact",variant:"solo",label:"Search","append-inner-icon":"mdi-magnify","single-line":"","hide-details":""},null,8,["modelValue"])])):_("",!0),l.loading?(o(),d("div",Y,X)):_("",!0),this.purchaseHistory==null?(o(),y(V,{key:2},{default:a(()=>[e(f,{cols:"12"},{default:a(()=>[e(b,{title:"Purchase Order View"},{default:a(()=>[e(v,null,{default:a(()=>[e(B,{color:"warning",variant:"tonal",class:"mb-4",border:"top"},{default:a(()=>[e(U,{class:"mb-1"},{default:a(()=>[c(" Are you sure you gave Purchase Orders? ")]),_:1}),$]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):_("",!0),this.purchaseHistory!=null?(o(),y(L,{key:3,headers:l.headers,items:i.paginatedItems,"item-key":"dessert",class:"table-rounded",height:"500","fixed-header":""},{default:a(()=>[u("thead",null,[u("tr",null,[(o(!0),d(k,null,x(l.headers,r=>(o(),d("th",{class:"text-center",key:r},m(r.text),1))),128))])]),u("tbody",null,[i.filteredPurchaseHistory.length===0?(o(),d("tr",ee,ae)):_("",!0),(o(!0),d(k,null,x(i.paginatedItems,(r,h)=>(o(),d("tr",{key:h},[u("td",se,m(r.po_number),1),u("td",re,m(r.created_date),1),u("td",le,[e(A,{color:i.resolveStatusVariant(r.po_status).color,class:"font-weight-medium",size:"small"},{default:a(()=>[c(m(r.po_status),1)]),_:2},1032,["color"])]),u("td",oe,m(r.brand_name),1),u("td",ie,m(r.brand_name==r.brand_name?"Mauriya Spiritual & Naturals(BIZKINGZ)":r.brand_name),1),r.po_status!="Received"?(o(),d("td",ne,[e(p,{icon:"",variant:"text",color:"error",class:"me-2",size:"small"},{default:a(()=>[e(w,{icon:"material-symbols:cancel-outline",color:"error",size:"30",onClick:I=>i.cancelstock(r)},null,8,["onClick"])]),_:2},1024),e(p,{icon:"",variant:"text",color:"success",class:"me-2",size:"small"},{default:a(()=>[e(w,{icon:"mdi-invoice-receive-outline",color:"success",size:"30",onClick:I=>i.inputstock(r)},null,8,["onClick"])]),_:2},1024)])):_("",!0)]))),128))])]),_:1},8,["headers","items"])):_("",!0),e(E,{modelValue:l.page,"onUpdate:modelValue":t[1]||(t[1]=r=>l.page=r),length:Math.ceil(i.filteredPurchaseHistory.length/l.pageSize),onInput:i.updatePagination},null,8,["modelValue","length","onInput"]),e(O,{modelValue:l.dialog,"onUpdate:modelValue":t[3]||(t[3]=r=>l.dialog=r),"max-width":"400",persistent:""},{default:a(()=>[e(b,{title:"Cancel Order",class:"mb-2"},{default:a(()=>[e(v,null,{default:a(()=>[e(V,null,{default:a(()=>[e(f,{cols:"12"},{default:a(()=>[e(C,{class:"mt-4",ref:"purchaseOrderForm"},{default:a(()=>[e(V,null,{default:a(()=>[e(f,{md:"12",cols:"12"},{default:a(()=>[c(" Are you sure want to cancel the order ? ")]),_:1}),e(f,{md:"12",cols:"12"},{default:a(()=>[e(p,{onClick:i.validateForm},{default:a(()=>[c("Yes")]),_:1},8,["onClick"]),c(" \xA0 "),e(p,{color:"secondary",variant:"tonal",onClick:t[2]||(t[2]=r=>i.closeDialog())},{default:a(()=>[c(" No ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(O,{modelValue:l.dialog2,"onUpdate:modelValue":t[6]||(t[6]=r=>l.dialog2=r),"max-width":"500",persistent:""},{default:a(()=>[e(b,{title:"Cancel Order",class:"mb-2"},{default:a(()=>[e(v,null,{default:a(()=>[e(V,null,{default:a(()=>[e(f,{cols:"12"},{default:a(()=>[e(C,{class:"mt-4",ref:"purchaseOrderForm2"},{default:a(()=>[e(V,null,{default:a(()=>[e(f,{md:"12",cols:"12"},{default:a(()=>[e(Q,{modelValue:this.cancelOrderdetails.cancel_reason,"onUpdate:modelValue":t[4]||(t[4]=r=>this.cancelOrderdetails.cancel_reason=r),label:"Cancel Reason","row-height":"30",rows:"4",variant:"filled","auto-grow":"",shaped:"",rules:l.workingRules},null,8,["modelValue","rules"])]),_:1}),e(f,{md:"12",cols:"12"},{default:a(()=>[e(p,{onClick:i.validateForm2},{default:a(()=>[c("Save")]),_:1},8,["onClick"]),c(" \xA0 "),e(p,{color:"secondary",variant:"tonal",onClick:t[5]||(t[5]=r=>i.closeDialog2())},{default:a(()=>[c(" No ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(q,{modelValue:l.snackbar,"onUpdate:modelValue":t[7]||(t[7]=r=>l.snackbar=r),timeout:2e3,color:l.color},{default:a(()=>[c(m(l.snackbarText),1)]),_:1},8,["modelValue","color"])])}const de=T(G,[["render",ce]]),ue={components:{Viewpurchasehistories:de},data(){return{currentroute:"",activeTab:"",tabs:[{title:"View Input Stocks",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=H(),this.activeTab=D(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function he(s,t,n,g,l,i){const r=N("Viewpurchasehistories");return o(),d("div",null,[e(j,{modelValue:l.activeTab,"onUpdate:modelValue":t[0]||(t[0]=h=>l.activeTab=h),"show-arrows":""},{default:a(()=>[(o(!0),d(k,null,x(l.tabs,h=>(o(),y(Z,{key:h.icon,value:h.tab},{default:a(()=>[e(w,{size:"20",start:"",icon:h.icon},null,8,["icon"]),c(" "+m(h.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),e(F),e(W,{modelValue:l.activeTab,"onUpdate:modelValue":t[1]||(t[1]=h=>l.activeTab=h),class:"mt-5 disable-tab-transition",touch:!1},{default:a(()=>[e(M,{value:"account"},{default:a(()=>[e(r)]),_:1})]),_:1},8,["modelValue"])])}const Ce=T(ue,[["render",he]]);export{Ce as default};
