import{_ as N,o as r,c as v,g as s,b7 as T,b8 as _,w as l,k as x,l as k,i as c,a4 as R,ac as G,j as V,a as n,F as w,q as I,t as f,b as u,f as g,m as d,u as p,bp as F,bq as z,v as P,e as U,s as H,r as L}from"./index.a69bedf2.js";import{s as A}from"./Services.9aacc6f2.js";import{V as S}from"./VForm.e0766810.js";import{V as O}from"./VAutocomplete.fe4e8b17.js";import{V as B}from"./VSelect.ad083822.js";import{V as D}from"./VTextField.fb4408de.js";import{V as q}from"./VChip.68a1889e.js";import{V as Q}from"./VTable.abd3f669.js";import{V as C}from"./VDialog.9ba47988.js";import{V as j}from"./VFileInput.1009d8e2.js";import{V as M}from"./VSnackbar.13133128.js";import{V as Y}from"./VPagination.1db389a4.js";import{V as W,a as E,b as J,c as K}from"./VWindowItem.7b1d0a98.js";import"./VCounter.1847cb25.js";import"./VCheckboxBtn.8ca5aade.js";const X={mixins:[A],data(){return{filterlocation:!0,today:this.getFormattedDate(new Date),Deliverydata:{so_id:"",shipped_date:"",delivery_person:""},grnno:[t=>!!t||"GRN Number is required"],SOid:null,SOid2:null,SOid3:null,locationdata:"",cityLoaction:[],dialog3:!1,GRNfile:"",GRNno:"",snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,selectsales:null,page:1,pageSize:10,loading2:!1,loaded:!1,loading:!1,saleshistory:[],GRNhistory:[],searchQuery:"",deliveryPerson:[],deliverydata:[],dialog:!1,dater:[t=>!!t||"Date is required"],person:[t=>!!t||"Assign Delivery Person is required"],dialog2:!1,cityID:"",locationID:"",headers:[{text:"Sales Order",value:"so_number"},{text:"Order Date",value:"created_date"},{text:"Status",value:"so_status"},{text:"Delivery Person",value:"delivery_person"},{text:"Order From",value:"merchant_name"},{text:"Shipped To",value:"merchant_name"},{text:"Order Value",value:"total_so_amount"},{text:"POD",value:"pod_image"},{text:"Delivery Challan",value:"delivery_challan_file"},{text:"Invoice",value:"invoice_file"},{text:"GRN No",value:"grn_number"},{text:"GRN Image",value:"grn_image"},{text:"Action",value:"actions",sortable:!1}]}},computed:{computedHeaders(){const t=[...this.headers];if(this.selectsales==="Shipped"){const e=t.findIndex(y=>y.value==="pod_image");e!==-1&&t.splice(e,1);const h=t.findIndex(y=>y.value==="actions");h!==-1&&t.splice(h,1)}return t},filteredSalesHistory(){const t=this.searchQuery.toLowerCase().trim();return this.saleshistory.filter(e=>{const h=e.so_number&&e.so_number.toLowerCase().includes(t)||e.created_date&&e.created_date.toLowerCase().includes(t)||e.so_status&&e.so_status.toLowerCase().includes(t)||e.merchant_name&&e.merchant_name.toLowerCase().includes(t)||e.total_so_amount&&e.total_so_amount.toString().includes(t)||e.delivery_person&&e.delivery_person.toLowerCase().includes(t),y=e.so_status==="Delivered"||e.so_status==="Shipped"||e.so_status==="On Hold"||e.so_status==="Cancelled";return h&&y})},paginatedItems(){const t=(this.page-1)*this.pageSize,e=t+this.pageSize;return this.filteredSalesHistory.slice(t,e)},showNoSalesAlert(){return!this.saleshistory.some(t=>t.so_status==="Delivered"||t.so_status==="Shipped"||t.so_status==="On Hold"||t.so_status==="Cancelled")},combinedData(){return{locationdata:this.locationdata,selectsales:this.selectsales}}},watch:{combinedData(t){t.locationdata&&t.selectsales?this.locationdetails():this.getSalesorderdetails()}},mounted(){this.cityID=localStorage.getItem("city_id"),this.locationID=localStorage.getItem("location_id"),this.cityID!==""&&this.locationID!==""&&(this.filterlocation=!1),this.handleBrandSelection()},methods:{handleFileChange(t){t.target.files.length>0?this.GRNfile=t.target.files[0]:this.GRNfile=null},uploadrow(t){this.SOid3=t.so_id,this.dialog3=!0},validateForm3(){this.$refs.purchaseOrderForm3.validate().then(t=>{t.valid==!0?this.Uploaddeliverfile():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="on-background")})},Uploaddeliverfile(){const t=new FormData;this.GRNfile&&t.append("grn_file",this.GRNfile),t.append("grn_number",this.GRNno),t.append("so_id",this.SOid3),this.Deliveredfileupload(t).then(e=>{e.data.status==1?(this.snackbar=!0,this.snackbarText=e.data.message,this.color="primary",this.GRNfile="",this.SOid3="",this.GRNno="",this.dialog3=!1,this.locationdetails(),this.getSalesorderdetails()):e.data.status==0?(this.snackbar=!0,this.snackbarText=e.data.message,this.color="on-background"):(this.snackbar=!0,this.color="on-background",this.snackbarText="Image Is Mandatory")}).catch(e=>{})},closeDeliver(){this.dialog3=!1,this.GRNfile="",this.GRNno=""},genaratePDFinvoice(t){this.createInvoice(t).then(e=>{window.location.reload(!0)})},handleBrandSelection(){this.getCitylocation(this.cityID).then(t=>{this.cityLoaction=t.data.data.map(e=>({value:e.location_id,text:e.location}))})},locationdetails(){const t={All:"all",Shipped:"4",Delivered:"5",Onhold:"7",Cancelled:"0"};this.selectsales!=="GRN Sales Orders"&&this.locationdata?(this.loading=!0,this.getSalesorders(t[this.selectsales],this.cityID,this.locationdata).then(e=>{console.log("response",e),e.status==1?(this.loading=!1,this.snackbarText=e.message,this.saleshistory=e.data,this.saleshistory.reverse(),this.color="primary",this.snackbar=!0):(this.snackbar=!0,this.color="on-background",this.loading=!1,this.saleshistory=[],this.snackbarText=e.message)})):(this.loading=!0,this.getGRN(this.cityID,this.locationdata).then(e=>{e.data.status==1?(this.loading=!1,this.saleshistory=e.data.data,this.saleshistory.reverse(),this.snackbarText=e.data.message,this.color="primary",this.snackbar=!0):(this.snackbar=!0,this.color="on-background",this.loading=!1,this.saleshistory=[],this.snackbarText="Select the status")}))},closeUnhold(){this.dialog2=!1},getFormattedDate(t){const e=t.getFullYear(),h=String(t.getMonth()+1).padStart(2,"0"),y=String(t.getDate()).padStart(2,"0");return`${e}-${h}-${y}`},deleteRow(t){this.SOid2=t.so_id,this.dialog2=!0},cancelunhold(){this.CancelUnholddata(this.SOid2).then(t=>{t.data.status==1?(this.dialog2=!1,this.snackbar=!0,this.color="primary",this.snackbarText=t.data.message,this.getSalesorderdetails()):(this.dialog2=!1,this.snackbar=!0,this.color="on-background",this.snackbarText=t.data.message)})},validateForm(){this.$refs.purchaseOrderForm.validate().then(t=>{t.valid==!0?this.updateOnhold():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="on-background")})},updateOnhold(){const t={so_id:this.SOid,shipped_date:this.Deliverydata.shipped_date,delivery_person:this.Deliverydata.delivery_person};this.UpdateUnholddata(t).then(e=>{e.data.status==1?(this.dialog=!1,this.snackbar=!0,this.color="primary",this.Deliverydata={},this.snackbarText=e.data.message,this.getSalesorderdetails(),this.locationdetails()):(this.dialog=!1,this.snackbar=!0,this.color="on-background",this.Deliverydata={},this.snackbarText=e.data.message)})},closeDialog(){this.dialog=!1,this.Deliverydata={}},editrow(t){this.Getsalesperson(this.cityID,this.locationdata).then(e=>{e.data.status==1?(this.deliveryPerson=e.data.data.map(h=>({value:h.delivery_person,text:h.name})),this.dialog=!0,this.SOid=t.so_id):(this.deliveryPerson=[],this.dialog=!1)})},updatePagination(t){this.page=t},getImageupdate(t){this.loading2=!0,window.open(t,"_blank"),this.loading2=!1},getPDFinvoice(t){this.loading2=!0,window.open(t,"_blank"),this.loading2=!1},getGRNImage(t){this.loading2=!0,window.open(t,"_blank"),this.loading2=!1},getPDFupdate(t){this.loading2=!0,window.open(t,"_blank"),this.loading2=!1},outputstock(t){this.$router.push({name:"Createwarehouseoutput",query:{so_id:t.so_id}})},resolveStatusVariant(t){return t=="Acknowledged"?{color:"warning"}:t=="On Hold"?{color:"warning"}:t=="Cancelled"?{color:"error"}:{color:"success"}},getSalesorderdetails(){const t={All:"all",Shipped:"4",Delivered:"5",Onhold:"7",Cancelled:"0"};this.cityID!==""&&this.locationID!==""&&this.selectsales!=="GRN Sales Orders"?(this.loading=!0,this.getSalesorders(t[this.selectsales],this.cityID,this.locationID).then(e=>{console.log("response",e),e.status==1?(this.loading=!1,this.snackbarText=e.message,this.color="primary",this.saleshistory=e.data,this.saleshistory.reverse(),this.snackbar=!0):(this.snackbar=!0,this.color="on-background",this.loading=!1,this.saleshistory=[],this.snackbarText=e.message)})):(this.loading=!0,this.getGRN(this.cityID,this.locationID).then(e=>{e.data.status==1?(this.loading=!1,this.saleshistory=e.data.data,this.saleshistory.reverse(),this.snackbarText=e.data.message,this.color="primary",this.snackbar=!0):(this.snackbar=!0,this.color="on-background",this.loading=!1,this.snackbarText="Select the status")}))}}},Z={key:0,class:"loading-container"},$={style:{"max-width":"400px"}},ee={key:1,id:"app"},te=F('<div id="loading-bg"><div class="loading-logo"><img src="'+z+'" height="60" width="68" alt="Logo"></div><div class="loading"><div class="effect-1 effects"></div><div class="effect-2 effects"></div><div class="effect-3 effects"></div></div></div>',1),se=[te],ae={key:0},le=n("td",{colspan:"16",class:"text-center"},[n("h1",null,"No data found !")],-1),oe=[le],ie={class:"text-center"},re={class:"text-center"},ne={class:"text-center"},de={class:"text-center"},ce={class:"text-center"},ue={class:"text-center"},he={class:"text-center"},fe={class:"text-center"},me={class:"text-center"},_e={class:"text-center"},ge={class:"text-center"},pe={class:"text-center"},ve={class:"text-center"};function ye(t,e,h,y,o,i){return r(),v("div",null,[o.loading2?(r(),v("div",Z,[s(T,{height:"5",color:"primary",indeterminate:"",class:"custom-loader","full-width":""})])):_("",!0),s(V,{class:"mb-2"},{default:l(()=>[s(x,null,{default:l(()=>[s(k,null,{default:l(()=>[s(c,{cols:"12"},{default:l(()=>[s(S,{class:"mt-6",ref:"purchaseOrderForm8"},{default:l(()=>[s(k,null,{default:l(()=>[R(s(c,{md:"6",cols:"12"},{default:l(()=>[s(O,{modelValue:o.locationdata,"onUpdate:modelValue":e[0]||(e[0]=a=>o.locationdata=a),label:"Location",items:this.cityLoaction,"item-value":"value","item-title":"text","menu-props":{maxHeight:200}},null,8,["modelValue","items"])]),_:1},512),[[G,o.filterlocation]]),s(c,{md:"6",cols:"12"},{default:l(()=>[s(B,{modelValue:o.selectsales,"onUpdate:modelValue":e[1]||(e[1]=a=>o.selectsales=a),items:["Shipped","Delivered","Onhold","Cancelled","GRN Sales Orders"],label:"Please Select The Status"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),n("div",$,[s(D,{class:"mb-3",modelValue:o.searchQuery,"onUpdate:modelValue":e[2]||(e[2]=a=>o.searchQuery=a),density:"compact",variant:"solo",label:"Search","append-inner-icon":"mdi-magnify","single-line":"","hide-details":""},null,8,["modelValue"])]),o.loading?(r(),v("div",ee,se)):_("",!0),s(Q,{headers:i.computedHeaders,items:i.paginatedItems,class:"table-rounded",height:"500","fixed-header":""},{default:l(()=>[n("thead",null,[n("tr",null,[(r(!0),v(w,null,I(o.headers,a=>(r(),v("th",{class:"text-center",key:a},f(a.text),1))),128))])]),n("tbody",null,[this.saleshistory.length===0?(r(),v("tr",ae,oe)):_("",!0),(r(!0),v(w,null,I(this.paginatedItems,(a,m)=>(r(),v("tr",{key:m},[n("td",ie,f(a.so_number),1),n("td",re,f(a.created_date),1),n("td",ne,[s(q,{color:i.resolveStatusVariant(a.so_status).color,class:"font-weight-medium",size:"small"},{default:l(()=>[u(f(a.so_status),1)]),_:2},1032,["color"])]),n("td",de,f(a.delivery_person),1),n("td",ce,f(a.merchant_name),1),n("td",ue,f(a.merchant_name),1),n("td",he,f(a.total_so_amount),1),n("td",fe,[a.so_status=="Delivered"?(r(),g(d,{key:0,icon:"",variant:"text",color:"default",class:"me-2",size:"x-small",onClick:b=>i.getImageupdate(a.pod_image)},{default:l(()=>[s(p,{color:"success",icon:"ic:twotone-photo-camera-back",size:"26"})]),_:2},1032,["onClick"])):_("",!0)]),n("td",me,[(a.so_status=="Shipped"||a.so_status=="Delivered"||a.so_status=="On Hold"||a.so_status=="Cancelled")&&o.selectsales!=="GRN Sales Orders"?(r(),g(d,{key:0,icon:"",variant:"text",color:"default",class:"me-2",size:"x-small",onClick:b=>i.getPDFupdate(a.delivery_challan_file)},{default:l(()=>[s(p,{color:"error",icon:"iwwa:file-pdf",size:"26"})]),_:2},1032,["onClick"])):_("",!0)]),n("td",_e,[(a.so_status==="Shipped"||a.so_status==="Delivered"||a.so_status==="On Hold"||a.so_status==="Cancelled")&&a.invoice_file!==""?(r(),g(d,{key:0,icon:"",variant:"text",color:"default",class:"me-2",size:"x-small",onClick:b=>i.getPDFinvoice(a.invoice_file)},{default:l(()=>[s(p,{color:"error",icon:"iwwa:file-pdf",size:"26"})]),_:2},1032,["onClick"])):(r(),g(d,{key:1,icon:"",variant:"text",color:"default",class:"me-2",size:"x-small"},{default:l(()=>[s(p,{left:"",color:"error",icon:"wpf:create-new",size:"26",onClick:b=>i.genaratePDFinvoice(a.so_id)},null,8,["onClick"])]),_:2},1024))]),n("td",ge,f(a.grn_number),1),n("td",pe,[o.selectsales=="GRN Sales Orders"||a.so_status=="Delivered"?(r(),g(d,{key:0,icon:"",variant:"text",color:"default",class:"me-2",size:"x-small",onClick:b=>i.getGRNImage(a.grn_image)},{default:l(()=>[s(p,{color:"success",icon:"ic:twotone-photo-camera-back",size:"26"})]),_:2},1032,["onClick"])):_("",!0)]),n("td",ve,[a.so_status!="Shipped"&&a.so_status!="Delivered"&&a.so_status!="On Hold"&&a.so_status!="Cancelled"?(r(),g(d,{key:0,icon:"",variant:"text",color:"success",class:"me-2",size:"small"},{default:l(()=>[s(p,{icon:"mdi-invoice-receive-outline",color:"success",size:"30",onClick:b=>i.outputstock(a)},null,8,["onClick"])]),_:2},1024)):_("",!0),a.so_status=="On Hold"?(r(),g(d,{key:1,icon:"",variant:"text",color:"error",class:"me-2",size:"x-small"},{default:l(()=>[s(p,{icon:"ri-pencil-line",size:"30",color:"primary",onClick:b=>i.editrow(a)},null,8,["onClick"])]),_:2},1024)):_("",!0),a.so_status=="On Hold"?(r(),g(d,{key:2,icon:"",variant:"text",color:"error",class:"me-2",size:"x-small"},{default:l(()=>[s(p,{icon:"material-symbols:cancel-outline",size:"30",color:"error",onClick:b=>i.deleteRow(a)},null,8,["onClick"])]),_:2},1024)):_("",!0),a.so_status=="Delivered"?(r(),g(d,{key:3,icon:"",variant:"text",color:"error",class:"me-2",size:"x-small"},{default:l(()=>[s(p,{icon:"humbleicons:upload",size:"30",color:"success",onClick:b=>i.uploadrow(a)},null,8,["onClick"])]),_:2},1024)):_("",!0)])]))),128))])]),_:1},8,["headers","items"]),s(C,{modelValue:o.dialog,"onUpdate:modelValue":e[6]||(e[6]=a=>o.dialog=a),"max-width":"400",persistent:""},{default:l(()=>[s(V,{title:"Assign Delivery Person",class:"mb-2"},{default:l(()=>[s(x,null,{default:l(()=>[s(k,null,{default:l(()=>[s(c,{cols:"12"},{default:l(()=>[s(S,{class:"mt-4",ref:"purchaseOrderForm"},{default:l(()=>[s(k,null,{default:l(()=>[s(c,{md:"12",cols:"12"},{default:l(()=>[s(O,{modelValue:o.Deliverydata.delivery_person,"onUpdate:modelValue":e[3]||(e[3]=a=>o.Deliverydata.delivery_person=a),items:this.deliveryPerson,"item-value":"value","item-title":"text",label:"Assign Delivery Person",rules:o.person,"menu-props":{maxHeight:200}},null,8,["modelValue","items","rules"])]),_:1}),s(c,{md:"12",cols:"12"},{default:l(()=>[s(D,{modelValue:o.Deliverydata.shipped_date,"onUpdate:modelValue":e[4]||(e[4]=a=>o.Deliverydata.shipped_date=a),type:"date",label:"Start Date",min:o.today,rules:o.dater},null,8,["modelValue","min","rules"])]),_:1}),s(c,{md:"12",cols:"12"},{default:l(()=>[s(d,{onClick:i.validateForm},{default:l(()=>[u("Save")]),_:1},8,["onClick"]),u(" \xA0 "),s(d,{color:"secondary",variant:"tonal",onClick:e[5]||(e[5]=a=>i.closeDialog())},{default:l(()=>[u(" Close ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(C,{modelValue:o.dialog2,"onUpdate:modelValue":e[7]||(e[7]=a=>o.dialog2=a),"max-width":"400",persistent:""},{default:l(()=>[s(V,{title:"Cancel Onhold",class:"mb-2"},{default:l(()=>[s(x,null,{default:l(()=>[s(k,null,{default:l(()=>[s(c,{cols:"12"},{default:l(()=>[s(S,{class:"mt-4",ref:"purchaseOrderForm2"},{default:l(()=>[s(k,null,{default:l(()=>[s(c,{md:"12",cols:"12"},{default:l(()=>[u(" Are you sure want to cancel the Onhold Sales Order ? ")]),_:1}),s(c,{md:"12",cols:"12"},{default:l(()=>[s(d,{onClick:i.cancelunhold},{default:l(()=>[u("Yes")]),_:1},8,["onClick"]),u(" \xA0 "),s(d,{color:"secondary",variant:"tonal",onClick:i.closeUnhold},{default:l(()=>[u(" No ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(C,{modelValue:o.dialog3,"onUpdate:modelValue":e[10]||(e[10]=a=>o.dialog3=a),"max-width":"800",persistent:""},{default:l(()=>[s(V,{title:"Upload File",class:"mb-2"},{default:l(()=>[s(x,null,{default:l(()=>[s(k,null,{default:l(()=>[s(c,{cols:"12"},{default:l(()=>[s(S,{class:"mt-4",ref:"purchaseOrderForm3"},{default:l(()=>[s(k,null,{default:l(()=>[s(c,{cols:"12",md:"6"},{default:l(()=>[s(D,{modelValue:o.GRNno,"onUpdate:modelValue":e[8]||(e[8]=a=>o.GRNno=a),label:"GRN Number",rules:o.grnno},null,8,["modelValue","rules"])]),_:1}),s(c,{md:"6",cols:"12"},{default:l(()=>[s(j,{file:o.GRNfile,"onUpdate:file":e[9]||(e[9]=a=>o.GRNfile=a),label:"Image Browse",accept:".jpg, .png, .jpeg",onInput:i.handleFileChange,multiple:""},null,8,["file","onInput"])]),_:1}),s(c,{md:"12",cols:"12"},{default:l(()=>[s(d,{onClick:i.validateForm3},{default:l(()=>[u("Yes")]),_:1},8,["onClick"]),u(" \xA0 "),s(d,{color:"secondary",variant:"tonal",onClick:i.closeDeliver},{default:l(()=>[u(" No ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(M,{modelValue:o.snackbar,"onUpdate:modelValue":e[11]||(e[11]=a=>o.snackbar=a),timeout:2e3,color:o.color},{default:l(()=>[u(f(o.snackbarText),1)]),_:1},8,["modelValue","color"]),s(Y,{modelValue:o.page,"onUpdate:modelValue":e[12]||(e[12]=a=>o.page=a),length:Math.ceil(i.filteredSalesHistory.length/o.pageSize),onInput:i.updatePagination},null,8,["modelValue","length","onInput"])])}const be=N(X,[["render",ye]]),ke={components:{Saleshistory:be},data(){return{currentroute:"",activeTab:"",tabs:[{title:"View Sales History",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=P(),this.activeTab=U(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function xe(t,e,h,y,o,i){const a=L("Saleshistory");return r(),v("div",null,[s(W,{modelValue:o.activeTab,"onUpdate:modelValue":e[0]||(e[0]=m=>o.activeTab=m),"show-arrows":""},{default:l(()=>[(r(!0),v(w,null,I(o.tabs,m=>(r(),g(K,{key:m.icon,value:m.tab},{default:l(()=>[s(p,{size:"20",start:"",icon:m.icon},null,8,["icon"]),u(" "+f(m.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),s(H),s(J,{modelValue:o.activeTab,"onUpdate:modelValue":e[1]||(e[1]=m=>o.activeTab=m),class:"mt-5 disable-tab-transition",touch:!1},{default:l(()=>[s(E,{value:"account"},{default:l(()=>[s(a)]),_:1})]),_:1},8,["modelValue"])])}const He=N(ke,[["render",xe]]);export{He as default};
