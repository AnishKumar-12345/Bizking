import{_ as T,o as i,c,g as l,b6 as P,b7 as d,w as a,k,l as V,i as g,j as x,f as v,a as n,F as w,q as C,t as f,b as m,m as _,u as y,bE as z,bo as F,v as H,e as I,s as U,r as A}from"./index.c6e55d50.js";import{s as N}from"./Services.7c8f92fc.js";import{V as S}from"./VForm.17d95907.js";import{V as L}from"./VSelect.1d65e8f3.js";import{V as D}from"./VTextField.a33c464e.js";import{V as B}from"./VChip.7976f28d.js";import{V as Q}from"./VTable.b8e8adce.js";import{V as q}from"./VAutocomplete.22e22519.js";import{V as O}from"./VDialog.2ac72160.js";import{V as R}from"./VSnackbar.2d72e322.js";import{V as j}from"./VPagination.501d14dc.js";import{V as E,a as M,b as W,c as Y}from"./VWindowItem.42eb66e9.js";import"./VCheckboxBtn.4fa636ac.js";const G={mixins:[N],data(){return{today:this.getFormattedDate(new Date),Deliverydata:{so_id:"",shipped_date:"",delivery_person:""},SOid:null,SOid2:null,snackbar:!1,snackbarText:"",timeout:6e3,color:"",top:!1,bottom:!0,left:!1,right:!1,selectsales:null,page:1,pageSize:10,loading2:!1,loaded:!1,loading:!1,saleshistory:[],searchQuery:"",deliveryPerson:[],dialog:!1,dater:[e=>!!e||"Date is required"],person:[e=>!!e||"Assign Delivery Person is required"],dialog2:!1,headers:[{text:"Sales Order",value:"so_number"},{text:"Order Date",value:"created_date"},{text:"Status",value:"so_status"},{text:"Delivery Person",value:"delivery_person"},{text:"Order From",value:"merchant_name"},{text:"Shipped To",value:"merchant_name"},{text:"Order Value",value:"total_so_amount"},{text:"POD",value:"pod_image"},{text:"Delivery Challan",value:"delivery_challan_file"},{text:"Invoice",value:"invoice_file"},{text:"Action",value:"actions",sortable:!1}]}},computed:{computedHeaders(){const e=[...this.headers];if(this.selectsales==="Shipped"){const t=e.findIndex(p=>p.value==="pod_image");t!==-1&&e.splice(t,1);const u=e.findIndex(p=>p.value==="actions");u!==-1&&e.splice(u,1)}return e},filteredSalesHistory(){const e=this.searchQuery.toLowerCase().trim();return this.saleshistory.filter(t=>{const u=t.so_number&&t.so_number.toLowerCase().includes(e)||t.created_date&&t.created_date.toLowerCase().includes(e)||t.so_status&&t.so_status.toLowerCase().includes(e)||t.merchant_name&&t.merchant_name.toLowerCase().includes(e)||t.total_so_amount&&t.total_so_amount.toString().includes(e)||t.delivery_person&&t.delivery_person.toLowerCase().includes(e),p=t.so_status==="Delivered"||t.so_status==="Shipped"||t.so_status==="On Hold"||t.so_status==="Cancelled";return u&&p})},paginatedItems(){const e=(this.page-1)*this.pageSize,t=e+this.pageSize;return this.filteredSalesHistory.slice(e,t)},showNoSalesAlert(){return!this.saleshistory.some(e=>e.so_status==="Delivered"||e.so_status==="Shipped"||e.so_status==="On Hold"||e.so_status==="Cancelled")}},mounted(){},methods:{closeUnhold(){this.dialog2=!1},getFormattedDate(e){const t=e.getFullYear(),u=String(e.getMonth()+1).padStart(2,"0"),p=String(e.getDate()).padStart(2,"0");return`${t}-${u}-${p}`},deleteRow(e){console.log("perk",e.so_id),this.SOid2=e.so_id,this.dialog2=!0},cancelunhold(){console.log("SOid2",this.SOid2),this.CancelUnholddata(this.SOid2).then(e=>{e.data.status==1?(this.dialog2=!1,this.snackbar=!0,this.color="primary",this.snackbarText=e.data.message,this.getSalesorderdetails()):(this.dialog2=!1,this.snackbar=!0,this.color="on-background",this.snackbarText=e.data.message)})},validateForm(){this.$refs.purchaseOrderForm.validate().then(e=>{e.valid==!0?this.updateOnhold():(this.snackbar=!0,this.snackbarText="Please give all mandatory fields",this.color="on-background")})},updateOnhold(){const e={so_id:this.SOid,shipped_date:this.Deliverydata.shipped_date,delivery_person:this.Deliverydata.delivery_person};console.log("po",e),this.UpdateUnholddata(e).then(t=>{console.log("set",t),t.data.status==1?(this.dialog=!1,this.snackbar=!0,this.color="primary",this.Deliverydata={},this.snackbarText=t.data.message,this.getSalesorderdetails()):(this.dialog=!1,this.snackbar=!0,this.color="on-background",this.Deliverydata={},this.snackbarText=t.data.message)})},closeDialog(){this.dialog=!1,this.Deliverydata={}},editrow(e){console.log("ids",e.so_id),this.Getsalesperson().then(t=>{console.log("getperson",t),t.data.status==1?(this.deliveryPerson=t.data.data.map(u=>({value:u.delivery_person,text:u.name})),this.dialog=!0,this.SOid=e.so_id):(this.deliveryPerson=[],this.dialog=!1)})},updatePagination(e){this.page=e},getImageupdate(e){this.loading2=!0,window.open(e,"_blank"),this.loading2=!1},getPDFinvoice(e){this.loading2=!0,window.open(e,"_blank"),this.loading2=!1},getPDFupdate(e){this.loading2=!0,window.open(e,"_blank"),this.loading2=!1},outputstock(e){this.$router.push({name:"Createwarehouseoutput",query:{so_id:e.so_id}})},resolveStatusVariant(e){return e=="Acknowledged"?{color:"warning"}:e=="On Hold"?{color:"warning"}:e=="Cancelled"?{color:"error"}:{color:"success"}},getSalesorderdetails(){const e={All:"all",Shipped:"4",Delivered:"5",Onhold:"7",Cancelled:"0"};this.loading=!0,this.getSalesorders(e[this.selectsales]).then(t=>{console.log("response",t),t.status==1?(this.loading=!1,this.saleshistory=t.data,this.saleshistory.reverse()):(this.snackbar=!0,this.color="on-background",this.loading=!1,this.saleshistory=[],this.snackbarText=t.message)})}}},J={key:0,class:"loading-container"},K={key:1,style:{"max-width":"400px"}},X={key:2,id:"app"},Z=z('<div id="loading-bg"><div class="loading-logo"><img src="'+F+'" height="60" width="68" alt="Logo"></div><div class="loading"><div class="effect-1 effects"></div><div class="effect-2 effects"></div><div class="effect-3 effects"></div></div></div>',1),$=[Z],ee={key:0},te=n("td",{colspan:"16",class:"text-center"},[n("h1",null,"No data found !")],-1),se=[te],le={key:1},ae=n("td",{colspan:"16",class:"text-center"},[n("h1",null,"No data found !")],-1),oe=[ae],re={class:"text-center"},ie={class:"text-center"},ne={class:"text-center"},de={class:"text-center"},ce={class:"text-center"},ue={class:"text-center"},he={class:"text-center"},_e={class:"text-center"},fe={class:"text-center"},me={class:"text-center"},pe={class:"text-center",style:{display:"flex","justify-content":"center","align-items":"center"}};function ge(e,t,u,p,o,r){return i(),c("div",null,[o.loading2?(i(),c("div",J,[l(P,{height:"5",color:"primary",indeterminate:"",class:"custom-loader","full-width":""})])):d("",!0),l(x,{class:"mb-2"},{default:a(()=>[l(k,null,{default:a(()=>[l(V,null,{default:a(()=>[l(g,{cols:"12"},{default:a(()=>[l(S,{class:"mt-6",ref:"purchaseOrderForm8"},{default:a(()=>[l(V,null,{default:a(()=>[l(g,{md:"6",cols:"12"},{default:a(()=>[l(L,{modelValue:o.selectsales,"onUpdate:modelValue":[t[0]||(t[0]=s=>o.selectsales=s),r.getSalesorderdetails],items:["Shipped","Delivered","Onhold","Cancelled"],label:"Please Select The Status"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1}),r.showNoSalesAlert?d("",!0):(i(),c("div",K,[l(D,{class:"mb-3",modelValue:o.searchQuery,"onUpdate:modelValue":t[1]||(t[1]=s=>o.searchQuery=s),density:"compact",variant:"solo",label:"Search","append-inner-icon":"mdi-magnify","single-line":"","hide-details":""},null,8,["modelValue"])])),o.loading?(i(),c("div",X,$)):d("",!0),r.showNoSalesAlert?d("",!0):(i(),v(Q,{key:3,headers:r.computedHeaders,items:r.paginatedItems,class:"table-rounded",height:"500","fixed-header":""},{default:a(()=>[n("thead",null,[n("tr",null,[(i(!0),c(w,null,C(o.headers,s=>(i(),c("th",{class:"text-center",key:s},f(s.text),1))),128))])]),n("tbody",null,[r.filteredSalesHistory.length===0?(i(),c("tr",ee,se)):d("",!0),this.saleshistory.length===0?(i(),c("tr",le,oe)):d("",!0),(i(!0),c(w,null,C(this.paginatedItems,(s,h)=>(i(),c("tr",{key:h},[n("td",re,f(s.so_number),1),n("td",ie,f(s.created_date),1),n("td",ne,[l(B,{color:r.resolveStatusVariant(s.so_status).color,class:"font-weight-medium",size:"small"},{default:a(()=>[m(f(s.so_status),1)]),_:2},1032,["color"])]),n("td",de,f(s.delivery_person),1),n("td",ce,f(s.merchant_name),1),n("td",ue,f(s.merchant_name),1),n("td",he,f(s.total_so_amount),1),n("td",_e,[s.so_status=="Delivered"?(i(),v(_,{key:0,icon:"",variant:"text",color:"default",class:"me-2",size:"x-small",onClick:b=>r.getImageupdate(s.pod_image)},{default:a(()=>[l(y,{color:"success",icon:"ic:twotone-photo-camera-back",size:"26"})]),_:2},1032,["onClick"])):d("",!0)]),n("td",fe,[s.so_status=="Shipped"||s.so_status=="Delivered"||s.so_status=="On Hold"||s.so_status==="Cancelled"?(i(),v(_,{key:0,icon:"",variant:"text",color:"default",class:"me-2",size:"x-small",onClick:b=>r.getPDFupdate(s.delivery_challan_file)},{default:a(()=>[l(y,{color:"error",icon:"iwwa:file-pdf",size:"26"})]),_:2},1032,["onClick"])):d("",!0)]),n("td",me,[s.so_status=="Shipped"||s.so_status=="Delivered"||s.so_status=="On Hold"||s.so_status==="Cancelled"?(i(),v(_,{key:0,icon:"",variant:"text",color:"default",class:"me-2",size:"x-small",onClick:b=>r.getPDFinvoice(s.invoice_file)},{default:a(()=>[l(y,{color:"error",icon:"iwwa:file-pdf",size:"26"})]),_:2},1032,["onClick"])):d("",!0)]),n("td",pe,[s.so_status!="Shipped"&&s.so_status!="Delivered"&&s.so_status!="On Hold"&&s.so_status!="Cancelled"?(i(),v(_,{key:0,icon:"",variant:"text",color:"success",class:"me-2",size:"small"},{default:a(()=>[l(y,{icon:"mdi-invoice-receive-outline",color:"success",size:"30",onClick:b=>r.outputstock(s)},null,8,["onClick"])]),_:2},1024)):d("",!0),s.so_status=="On Hold"?(i(),v(_,{key:1,icon:"",variant:"text",color:"error",class:"me-2",size:"x-small"},{default:a(()=>[l(y,{icon:"ri-pencil-line",size:"30",color:"primary",onClick:b=>r.editrow(s)},null,8,["onClick"])]),_:2},1024)):d("",!0),s.so_status=="On Hold"?(i(),v(_,{key:2,icon:"",variant:"text",color:"error",class:"me-2",size:"x-small"},{default:a(()=>[l(y,{icon:"material-symbols:cancel-outline",size:"30",color:"error",onClick:b=>r.deleteRow(s)},null,8,["onClick"])]),_:2},1024)):d("",!0)])]))),128))])]),_:1},8,["headers","items"])),l(O,{modelValue:o.dialog,"onUpdate:modelValue":t[5]||(t[5]=s=>o.dialog=s),"max-width":"400",persistent:""},{default:a(()=>[l(x,{title:"Assign Delivery Person",class:"mb-2"},{default:a(()=>[l(k,null,{default:a(()=>[l(V,null,{default:a(()=>[l(g,{cols:"12"},{default:a(()=>[l(S,{class:"mt-4",ref:"purchaseOrderForm"},{default:a(()=>[l(V,null,{default:a(()=>[l(g,{md:"12",cols:"12"},{default:a(()=>[l(q,{modelValue:o.Deliverydata.delivery_person,"onUpdate:modelValue":t[2]||(t[2]=s=>o.Deliverydata.delivery_person=s),items:this.deliveryPerson,"item-value":"value","item-title":"text",label:"Assign Delivery Person",rules:o.person},null,8,["modelValue","items","rules"])]),_:1}),l(g,{md:"12",cols:"12"},{default:a(()=>[l(D,{modelValue:o.Deliverydata.shipped_date,"onUpdate:modelValue":t[3]||(t[3]=s=>o.Deliverydata.shipped_date=s),type:"date",label:"Start Date",min:o.today,rules:o.dater},null,8,["modelValue","min","rules"])]),_:1}),l(g,{md:"12",cols:"12"},{default:a(()=>[l(_,{onClick:r.validateForm},{default:a(()=>[m("Save")]),_:1},8,["onClick"]),m(" \xA0 "),l(_,{color:"secondary",variant:"tonal",onClick:t[4]||(t[4]=s=>r.closeDialog())},{default:a(()=>[m(" Close ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(O,{modelValue:o.dialog2,"onUpdate:modelValue":t[6]||(t[6]=s=>o.dialog2=s),"max-width":"400",persistent:""},{default:a(()=>[l(x,{title:"Cancel Onhold",class:"mb-2"},{default:a(()=>[l(k,null,{default:a(()=>[l(V,null,{default:a(()=>[l(g,{cols:"12"},{default:a(()=>[l(S,{class:"mt-4",ref:"purchaseOrderForm2"},{default:a(()=>[l(V,null,{default:a(()=>[l(g,{md:"12",cols:"12"},{default:a(()=>[m(" Are you sure want to cancel the Onhold Sales Order ? ")]),_:1}),l(g,{md:"12",cols:"12"},{default:a(()=>[l(_,{onClick:r.cancelunhold},{default:a(()=>[m("Yes")]),_:1},8,["onClick"]),m(" \xA0 "),l(_,{color:"secondary",variant:"tonal",onClick:r.closeUnhold},{default:a(()=>[m(" No ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(R,{modelValue:o.snackbar,"onUpdate:modelValue":t[7]||(t[7]=s=>o.snackbar=s),timeout:2e3,color:o.color},{default:a(()=>[m(f(o.snackbarText),1)]),_:1},8,["modelValue","color"]),l(j,{modelValue:o.page,"onUpdate:modelValue":t[8]||(t[8]=s=>o.page=s),length:Math.ceil(r.filteredSalesHistory.length/o.pageSize),onInput:r.updatePagination},null,8,["modelValue","length","onInput"])])}const ve=T(G,[["render",ge]]),ye={components:{Saleshistory:ve},data(){return{currentroute:"",activeTab:"",tabs:[{title:"View Sales History",icon:"mdi-account-outline",tab:"account"}]}},mounted(){this.currentroute=H(),this.activeTab=I(this.currentroute.params.tab),this.activeTab=this.tabs[0].tab}};function Ve(e,t,u,p,o,r){const s=A("Saleshistory");return i(),c("div",null,[l(E,{modelValue:o.activeTab,"onUpdate:modelValue":t[0]||(t[0]=h=>o.activeTab=h),"show-arrows":""},{default:a(()=>[(i(!0),c(w,null,C(o.tabs,h=>(i(),v(Y,{key:h.icon,value:h.tab},{default:a(()=>[l(y,{size:"20",start:"",icon:h.icon},null,8,["icon"]),m(" "+f(h.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),l(U),l(W,{modelValue:o.activeTab,"onUpdate:modelValue":t[1]||(t[1]=h=>o.activeTab=h),class:"mt-5 disable-tab-transition",touch:!1},{default:a(()=>[l(M,{value:"account"},{default:a(()=>[l(s)]),_:1})]),_:1},8,["modelValue"])])}const Ie=T(ye,[["render",Ve]]);export{Ie as default};
